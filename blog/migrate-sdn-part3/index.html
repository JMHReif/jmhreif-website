<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 3 | Jennifer Reif</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Photo credit  You may have heard quite a bit of buzz around reactive programming or reactive principles in recent months or years. Some people say it is the future, while others prefer their existing monoliths. So what is all the fuss actually about? What is reactive? Is it beneficial?
 As with all things in life, it depends. :) Remember, that technical decisions are often large investments of time - resources to create it and/or maintain for lengths of time."><meta name=generator content="Hugo 0.85.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 3"><meta property="og:description" content="Photo credit  You may have heard quite a bit of buzz around reactive programming or reactive principles in recent months or years. Some people say it is the future, while others prefer their existing monoliths. So what is all the fuss actually about? What is reactive? Is it beneficial?
 As with all things in life, it depends. :) Remember, that technical decisions are often large investments of time - resources to create it and/or maintain for lengths of time."><meta property="og:type" content="article"><meta property="og:url" content="https://jmhreif.com/blog/migrate-sdn-part3/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-09-22T09:00:00-06:00"><meta property="article:modified_time" content="2021-09-22T09:00:00-06:00"><meta itemprop=name content="Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 3"><meta itemprop=description content="Photo credit  You may have heard quite a bit of buzz around reactive programming or reactive principles in recent months or years. Some people say it is the future, while others prefer their existing monoliths. So what is all the fuss actually about? What is reactive? Is it beneficial?
 As with all things in life, it depends. :) Remember, that technical decisions are often large investments of time - resources to create it and/or maintain for lengths of time."><meta itemprop=datePublished content="2021-09-22T09:00:00-06:00"><meta itemprop=dateModified content="2021-09-22T09:00:00-06:00"><meta itemprop=wordCount content="1568"><meta itemprop=keywords content="spring,neo4j,applications,development,migration,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 3"><meta name=twitter:description content="Photo credit  You may have heard quite a bit of buzz around reactive programming or reactive principles in recent months or years. Some people say it is the future, while others prefer their existing monoliths. So what is all the fuss actually about? What is reactive? Is it beneficial?
 As with all things in life, it depends. :) Remember, that technical decisions are often large investments of time - resources to create it and/or maintain for lengths of time."></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://jmhreif.com/img/sdn-migration/migrate-golden-gate-bridge.jpeg)><div class="pb3-m pb6-l bg-black-60"><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Jennifer Reif</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/ title="Home page">Home</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blog/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/abstracts/ title="Abstracts page">Abstracts</a></li></ul><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">BLOG</aside><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/share?url=https://jmhreif.com/blog/migrate-sdn-part3/&text=Winter%20to%20Spring:%20Migrating%20from%20Spring%20Data%20Neo4j%205%20to%206,%20Part%203" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://jmhreif.com/blog/migrate-sdn-part3/&title=Winter%20to%20Spring:%20Migrating%20from%20Spring%20Data%20Neo4j%205%20to%206,%20Part%203" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div><h1 class="f1 athelas mt3 mb1">Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 3</h1><time class="f6 mv4 dib tracked" datetime=2021-09-22T09:00:00-06:00>September 22, 2021</time>
<span class="f6 mv4 dib tracked">- 8 minutes read</span>
<span class="f6 mv4 dib tracked">- 1568 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><div class=paragraph><small><i><a href="https://unsplash.com/photos/_dwwHrYRWcM?utm_source=unsplash&utm_medium=referral&utm_content=creditShareLink">Photo credit</a></i></small></div><div class=paragraph><p>You may have heard quite a bit of buzz around reactive programming or reactive principles in recent months or years. Some people say it is the future, while others prefer their existing monoliths. So what is all the fuss actually about? What is reactive? Is it beneficial?</p></div><div class=paragraph><p>As with all things in life, it depends. :) Remember, that technical decisions are often large investments of time - resources to create it and/or maintain for lengths of time. We should evaluate whether a technology or methodology fits the business need and existing resource (time, people, budget) constraints. Would you be the only one supporting or willing to learn the new technology? Then, probably not a wise decision (for you or the company).</p></div><div class=paragraph><p>Ok, let’s talk a bit more about what reactive is and how it can help.</p></div><div class=sect1><h2 id=_reactive_principles>Reactive principles</h2><div class=sectionbody><div class=paragraph><p>Reactive programming was built upon the principles outlined in the <a href=https://www.reactivemanifesto.org/ target=_blank rel=noopener>reactive manifesto</a>. There are several implementations of the reactive manifesto, but one of the more popular ones is <a href=https://projectreactor.io/ target=_blank rel=noopener>Project Reactor</a>, which is used in <a href=https://spring.io/reactive target=_blank rel=noopener>Spring</a>.</p></div><div class=paragraph><p>The principles of the manifesto attempt to solve problems in the data pipe by allowing participants in a system (such as clients and servers) the ability to reduce or expand capacity of the data flow based on each component’s needs. Reactive development can prevent overload for a particular device that causes failures or collapses, maintaining better availability and reliability of systems.</p></div><div class=paragraph><p>Note the word <span class=underline>can</span> from that last sentence. As with all things, there is no "one-size-fits-all", and it doesn’t cure underlying issues. However, in situations where issues exist or there are unstable environments, reactive might provide the stability needed for a better-performing system.</p></div></div></div><div class=sect1><h2 id=_current_application_overview>Current application overview</h2><div class=sectionbody><div class=paragraph><p>As with our previous posts on this topic, the code for today’s migration is a <a href=https://github.com/neo4j-examples/sdn-migration/blob/step2_sdn_imperative/pom.xml target=_blank rel=noopener>specific branch in the migration Github repository</a>. Today, we can begin in the <code>step2</code> branch with SDN6 imperative and will be updating the code to make it match the <code>step3</code> branch. So, <code>step3</code> is our goal! You are welcome to check out the <code>step2</code> code and follow along - or, if you joined me in the last post, you can use your completed code from the first part of the migration.</p></div><div class=paragraph><p>Let’s get started!</p></div></div></div><div class=sect1><h2 id=_dependencies_and_pom_xml>Dependencies and pom.xml</h2><div class=sectionbody><div class=paragraph><p>Just as we did before, we will start with the <code>pom.xml</code> file to see any dependency changes.</p></div><div class=listingblock><div class=content><pre class=highlight><code>&lt;!-- ADD --&gt;
&lt;dependency&gt;
	&lt;groupId&gt;io.projectreactor&lt;/groupId&gt;
	&lt;artifactId&gt;reactor-core&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
	&lt;groupId&gt;io.projectreactor&lt;/groupId&gt;
	&lt;artifactId&gt;reactor-test&lt;/artifactId&gt;
	&lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre></div></div><div class=paragraph><p>In our code block above, we have only added two dependencies - both for reactive support. One dependency provides reactive functionality for application code, and one handles testing support. We don’t need to change our <code>spring-boot-starter-data-neo4j</code> dependency because the Neo4j driver in that package supports both imperative and reactive communications.</p></div><div class=paragraph><p>There aren’t any changes required in the <code>application.properties</code> file for connecting to the database (since SDN6 supports both imperative and reactive to/from the database). We also do not need to change anything in our domain classes (<code>MovieEntity</code>, <code>Tagline</code>, <code>Person</code>, <code>Actor</code>, <code>ActedInMovieProjection</code>, <code>ReviewRelationship</code>). This is because we’re not altering how the data is stored or how it is mapped between the database and application. Reactive programming is all about data <em>flow</em>, so we only need to adjust the capacity of the pipe…​.which means making changes to our repositories for this project.</p></div></div></div><div class=sect1><h2 id=_repositories>Repositories</h2><div class=sectionbody><div class=paragraph><p>This round, let us start with the <code>MovieRepository</code> interface before moving to the <code>PersonRepository</code> interface. There are not very many changes in either case, but let’s take a look at each of the updates individually.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>//FROM
public interface MovieRepository extends Neo4jRepository&lt;MovieEntity, String&gt; {
}

//TO
public interface MovieRepository extends ReactiveNeo4jRepository&lt;MovieEntity, String&gt; {
}</code></pre></div></div><div class=paragraph><p>The difference here is in the extended class. The imperative version of the code uses the standard <code>Neo4jRepository&lt;></code>, where the reactive rendition of the code uses the <code>ReactiveNeo4jRepository&lt;></code>. The reactive repository gives us access to reactive methods, which include the capability to control and limit the amount of passing data for intervals of time.</p></div><div class=paragraph><p>Our next changes in the repository are to the return types on the methods.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>//FROM
MovieEntity findByTitle(String movieTitle);

//TO
Mono&lt;MovieEntity&gt; findByTitle(String movieTitle);</code></pre></div></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>//FROM
@Query(&#34;MATCH (m:Movie)&lt;-[:ACTED_IN]-(p:Person) WHERE p.name = $actorName RETURN m&#34;)
List&lt;MovieEntity&gt; findMoviesByActorNameWithCypherPlaceholder(String actorName);

//TO
@Query(&#34;MATCH (m:Movie)&lt;-[:ACTED_IN]-(p:Person) WHERE p.name = $actorName RETURN m&#34;)
Flux&lt;MovieEntity&gt; findMoviesByActorNameWithCypherPlaceholder(String actorName);</code></pre></div></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>//FROM
@Query(&#34;MATCH (m:Movie)&lt;-[:ACTED_IN]-(p:Person) WHERE p.name = ?#{[0]} RETURN m&#34;)
List&lt;MovieEntity&gt; findMoviesByActorNameWithSpElIndexPlaceholder(String actorName);

//TO
@Query(&#34;MATCH (m:Movie)&lt;-[:ACTED_IN]-(p:Person) WHERE p.name = ?#{[0]} RETURN m&#34;)
Flux&lt;MovieEntity&gt; findMoviesByActorNameWithSpElIndexPlaceholder(String actorName);</code></pre></div></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>//FROM
@Query(&#34;MATCH (m:Movie)&lt;-[:ACTED_IN]-(p:Person) WHERE p.name = :#{[0]} RETURN m&#34;)
List&lt;MovieEntity&gt; findMoviesByActorNameWithSpElIndexColonPlaceholder(String actorName);

//TO
@Query(&#34;MATCH (m:Movie)&lt;-[:ACTED_IN]-(p:Person) WHERE p.name = :#{[0]} RETURN m&#34;)
Flux&lt;MovieEntity&gt; findMoviesByActorNameWithSpElIndexColonPlaceholder(String actorName);</code></pre></div></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>//FROM
@Query(&#34;MATCH (m:Movie)&lt;-[:ACTED_IN]-(p:Person) WHERE p.name = :#{#actorName} RETURN m&#34;)
List&lt;MovieEntity&gt; findMoviesByActorNameWithSpElNamedPlaceholder(@Param(&#34;actorName&#34;) String actorName);

//TO
@Query(&#34;MATCH (m:Movie)&lt;-[:ACTED_IN]-(p:Person) WHERE p.name = :#{#actorName} RETURN m&#34;)
Flux&lt;MovieEntity&gt; findMoviesByActorNameWithSpElNamedPlaceholder(@Param(&#34;actorName&#34;) String actorName);</code></pre></div></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>//FROM
@Query(&#34;MATCH (m:Movie)&lt;-[:ACTED_IN]-(p:Person) WHERE p.name = :#{#actor.name} RETURN m&#34;)
List&lt;MovieEntity&gt; findMoviesByActorNameWithSpElSearchObjectPlaceholder(@Param(&#34;actor&#34;) Actor actor);

//TO
@Query(&#34;MATCH (m:Movie)&lt;-[:ACTED_IN]-(p:Person) WHERE p.name = :#{#actor.name} RETURN m&#34;)
Flux&lt;MovieEntity&gt; findMoviesByActorNameWithSpElSearchObjectPlaceholder(@Param(&#34;actor&#34;) Actor actor);</code></pre></div></div><div class=paragraph><p>In each of the cases, we have a one-word change for the return type. The reactive code either returns a <code>Mono&lt;></code> or a <code>Flux&lt;></code> type. The <code>Mono&lt;></code> says we are only expecting 0 or 1 values to return, where the <code>Flux&lt;></code> tells us we can expect 0 to n values to return.</p></div><div class=paragraph><p>For instance, if we query for a very popular actor, we could get quite a few titles back. If our bandwidth is low or busy, then the return results could easily overwhelm the pipeline and cause failures. Knowing this, we could add some guidelines to that specific method to apply <a href=https://www.reactivemanifesto.org/glossary#Back-Pressure target=_blank rel=noopener>back pressure</a> (combined with a rate of speed) in order to specify how much of the return results to feed at intervals. As an example, we may want to return four movies every two seconds, or we could tell the system to give us five movies every second. We can control how much data is fed back and how often.</p></div><div class=paragraph><p>The data feed stops when all of the results have been returned. So, no matter how many queries are sent to the system, if back pressure is in place, we ensure the receiving end does not reach a point of overwhelm and failure. It may take time to receive everything, but we will not have a crash, causing things to get further behind.</p></div><div class=paragraph><p>The same changes are going to exist for our <code>PersonRepository</code> interface, and just like before, we will separate them to make alterations easier to spot.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>//FROM
public interface PersonRepository extends Neo4jRepository&lt;Person, Long&gt; {
}

//TO
public interface PersonRepository extends ReactiveNeo4jRepository&lt;Person, Long&gt; {
}</code></pre></div></div><div class=paragraph><p>Just as before, we need access to the reactive methods to be able to manipulate data flow.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>//FROM
List&lt;Person&gt; findByReviewedMoviesMovieTitle(String reviewedMovieTitle);

//TO
Flux&lt;Person&gt; findByReviewedMoviesMovieEntityTitle(String reviewedMovieTitle);</code></pre></div></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>//FROM
List&lt;Person&gt; findByDirectedMoviesTitle(String directedMovieTitle);

//TO
Flux&lt;Person&gt; findByDirectedMoviesTitle(String directedMovieTitle);</code></pre></div></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>//FROM
@Query(&#34;MATCH (m:Movie {title: $title})-[r:ACTED_IN]-(p:Person) RETURN m, r, p ORDER BY p.name&#34;)
List&lt;ActedInMovieProjection&gt; findByActedInMovieTitle(String title);

//TO
@Query(&#34;MATCH (m:Movie {title: $title})-[r:ACTED_IN]-(p:Person) RETURN m, r, p ORDER BY p.name&#34;)
Flux&lt;ActedInMovieProjection&gt; findByActedInMovieTitle(String title);</code></pre></div></div><div class=paragraph><p>We see the same as we saw in our <code>MovieRepository</code> where our return type for each method has changed to either <code>Mono&lt;></code> or <code>Flux&lt;></code> in order to be able to handle data flow rates, if necessary. You might also note that the <code>tomHanksCareer()</code> method is not listed in the SDN6 reactive version. There isn’t any specific reason for this, as we can include it in reactive and update the return type, just as we did with the other methods.</p></div></div></div><div class=sect1><h2 id=_quick_note_changes_to_test_class>Quick note: Changes to test class</h2><div class=sectionbody><div class=paragraph><p>There aren’t any other changes that need to be made to our project code. However, if you take a look at the <a href=https://github.com/neo4j-examples/sdn-migration/blob/step3_sdn_reactive/src/test/java/org/neo4j/sdnlegacy/SdnLegacyApplicationTests.java target=_blank rel=noopener>test class</a>, you will notice a few more.</p></div><div class=paragraph><p>They are mostly out-of-scope for this post, but there is a different template being used (<code>ReactiveNeo4jTemplate</code>), and the results of each test are checked using <code>StepVerifier</code>, rather than <code>assert</code> statements.</p></div></div></div><div class=sect1><h2 id=_wrapping_up>Wrapping up!</h2><div class=sectionbody><div class=paragraph><p>As we review this post’s migration, reactive might provide gains in stability and consistency in technology systems, but it may also decrease performance in some cases. Thorough evaluation of the costs and benefits will help stakeholders decide whether the value fits the business need and outweighs any costs.</p></div><div class=paragraph><p>This post might have seemed lighter on the changes, but we altered quite a bit of our functionality through reactive method access. There were minor additions to the <code>pom.xml</code> file for reactive dependencies, then we skipped right over to the repositories to extend the <code>ReactiveNeo4jRepository&lt;></code> and modify the return type of the methods to either <code>Mono&lt;></code> or <code>Flux&lt;></code>. Finally, we breezed through a couple of the switches in logic from the test class for how we handle tests in an imperative versus reactive environment.</p></div><div class=paragraph><p>This completes our migration from Spring Data Neo4j 5 and OGM to Spring Data Neo4j 6! If your application is still using SDN5/OGM, now you have a couple of options for migration - to SDN6 imperative, or on up to SDN6 reactive. Our migration path made this process simpler by handling changes in a 2-step process (SDN5 → SDN6 imperative → SDN6 reactive). In my mind, at least, taking the whole migration at once would be a lot trickier and more error-prone. This way, it also allows you to choose where you want to land, whether that’s still with the imperative model or to the reactive model. Thanks for following along, and feel free to reach out via <a href=https://stackoverflow.com/questions/tagged/spring-data-neo4j target=_blank rel=noopener>StackOverflow</a>, the <a href=https://community.neo4j.com/ target=_blank rel=noopener>Neo4j forum</a>, or on the <a href=https://github.com/spring-projects/spring-data-neo4j target=_blank rel=noopener>Github project</a> itself if you have any questions!</p></div><div class=paragraph><p>Happy coding!</p></div></div></div><div class=sect1><h2 id=_resources>Resources</h2><div class=sectionbody><div class=ulist><ul><li><p>Github project: <a href=https://github.com/neo4j-examples/sdn-migration target=_blank rel=noopener>SDN5 to SDN6 migration</a></p></li><li><p>Developer guide: <a href=https://neo4j.com/developer/spring-data-neo4j/ target=_blank rel=noopener>Spring Data Neo4j</a></p></li><li><p>Documentation: <a href=https://docs.spring.io/spring-data/neo4j/docs/current/reference/html/#reference target=_blank rel=noopener>Spring Data Neo4j</a></p></li><li><p>SDN docs: <a href=https://docs.spring.io/spring-data/neo4j/docs/current/reference/html/#Migrating target=_blank rel=noopener>Migration FAQ section</a></p></li><li><p>Github project: <a href=https://github.com/spring-projects/spring-data-neo4j target=_blank rel=noopener>Spring Data Neo4j</a></p></li></ul></div></div></div><ul class=pa0><li class="list di"><a href=/tags/spring class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">spring</a></li><li class="list di"><a href=/tags/neo4j class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">neo4j</a></li><li class="list di"><a href=/tags/applications class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">applications</a></li><li class="list di"><a href=/tags/development class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">development</a></li><li class="list di"><a href=/tags/migration class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">migration</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/blog/migrate-sdn-part2/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 2</a></li><li class=mb2><a href=/blog/migrate-sdn-part1/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 1</a></li><li class=mb2><a href=/blog/create-data-marvel-sdn/>Create a Data Marvel with Spring Data Neo4j</a></li><li class=mb2><a href=/blog/java17-graph-explore/>Java 17: Explore the newly-released Java version in a graph database!</a></li></ul></div></aside></article></main><footer class="bg-dark-green bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://jmhreif.com/>&copy; Jennifer Reif 2023</a><div><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>