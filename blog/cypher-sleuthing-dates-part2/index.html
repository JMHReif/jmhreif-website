<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Cypher Sleuthing: Dealing with Dates, Part 2 | Jennifer Reif</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="*Updated Dec 9, 2021
My previous part 1 post on this topic introduced Cypher dates and translated a few other date formats to the Cypher-supported ISO 8601 format. If you read that, then this post is the next step with Cypher dates that covers durations and more. If you haven’t seen part 1, feel free to catch up - though this part 2 doesn’t necessarily require reading part 1. :)"><meta name=generator content="Hugo 0.119.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><link rel=canonical href=https://jmhreif.com/blog/cypher-sleuthing-dates-part2/><meta property="og:title" content="Cypher Sleuthing: Dealing with Dates, Part 2"><meta property="og:description" content="*Updated Dec 9, 2021
My previous part 1 post on this topic introduced Cypher dates and translated a few other date formats to the Cypher-supported ISO 8601 format. If you read that, then this post is the next step with Cypher dates that covers durations and more. If you haven’t seen part 1, feel free to catch up - though this part 2 doesn’t necessarily require reading part 1. :)"><meta property="og:type" content="article"><meta property="og:url" content="https://jmhreif.com/blog/cypher-sleuthing-dates-part2/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-04-26T12:00:00-06:00"><meta property="article:modified_time" content="2021-04-26T12:00:00-06:00"><meta itemprop=name content="Cypher Sleuthing: Dealing with Dates, Part 2"><meta itemprop=description content="*Updated Dec 9, 2021
My previous part 1 post on this topic introduced Cypher dates and translated a few other date formats to the Cypher-supported ISO 8601 format. If you read that, then this post is the next step with Cypher dates that covers durations and more. If you haven’t seen part 1, feel free to catch up - though this part 2 doesn’t necessarily require reading part 1. :)"><meta itemprop=datePublished content="2021-04-26T12:00:00-06:00"><meta itemprop=dateModified content="2021-04-26T12:00:00-06:00"><meta itemprop=wordCount content="1572"><meta itemprop=keywords content="cypher,query language,dates,temporal,programming,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Cypher Sleuthing: Dealing with Dates, Part 2"><meta name=twitter:description content="*Updated Dec 9, 2021
My previous part 1 post on this topic introduced Cypher dates and translated a few other date formats to the Cypher-supported ISO 8601 format. If you read that, then this post is the next step with Cypher dates that covers durations and more. If you haven’t seen part 1, feel free to catch up - though this part 2 doesn’t necessarily require reading part 1. :)"></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://jmhreif.com/img/date-part-2/fingerprint_spyglass.jpeg)><div class=bg-black-60><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Jennifer Reif</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/ title="Home page">Home</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blog/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/abstracts/ title="Abstracts page">Abstracts</a></li></ul><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank rel=noopener class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank rel=noopener class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank rel=noopener class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank rel=noopener class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.podbean.com/ target=_blank rel=noopener class="podcast ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="podcast link" aria-label="follow on podcast——Opens in a new window"><span class=icon><svg width="1200pt" height="1200pt" viewBox="0 0 1200 1200" xmlns="http://www.w3.org/2000/svg"><path d="m6e2 62.484c-296.48.0-537.52 241.03-537.52 537.52s240.98 537.52 537.52 537.52c296.48.0 537.52-240.98 537.52-537.52.0-296.48-241.03-537.52-537.52-537.52zm-155.02 305.02c0-85.5 69.516-155.02 155.02-155.02S755.02 282 755.02 367.504v234.98c0 85.5-69.516 155.02-155.02 155.02s-155.02-69.516-155.02-155.02zm192.52 516.52v66c0 20.484-17.016 37.5-37.5 37.5s-37.5-17.016-37.5-37.5v-66C408 865.508 288 734.024 288 574.504c0-20.484 17.016-37.5 37.5-37.5s37.5 17.016 37.5 37.5c0 130.5 106.5 237 237 237s237-106.5 237-237c0-20.484 17.016-37.5 37.5-37.5s37.5 17.016 37.5 37.5c0 159.52-120 291-274.5 309.52z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked ttu">Blog</aside><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/intent/tweet?url=https://jmhreif.com/blog/cypher-sleuthing-dates-part2/&amp;text=Cypher%20Sleuthing:%20Dealing%20with%20Dates,%20Part%202" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://jmhreif.com/blog/cypher-sleuthing-dates-part2/&amp;title=Cypher%20Sleuthing:%20Dealing%20with%20Dates,%20Part%202" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div><h1 class="f1 athelas mt3 mb1">Cypher Sleuthing: Dealing with Dates, Part 2</h1><time class="f6 mv4 dib tracked" datetime=2021-04-26T12:00:00-06:00>April 26, 2021</time>
<span class="f6 mv4 dib tracked">- 8 minutes read</span>
<span class="f6 mv4 dib tracked">- 1572 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><div class=paragraph><p><em>*Updated Dec 9, 2021</em></p></div><div class=paragraph><p>My previous <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part1/ target=_blank rel=noopener>part 1 post</a> on this topic introduced Cypher dates and translated a few other date formats to the Cypher-supported ISO 8601 format. If you read that, then this post is the next step with Cypher dates that covers durations and more. If you haven’t seen part 1, feel free to catch up - though this part 2 doesn’t necessarily require reading part 1. :)</p></div><div class=paragraph><p>We will continue a bit of the last post by showing how to truncate dates and times. Then we will look at the next area of built-in Cypher date functionality - time distance measurements and difference calculations between dates with durations. We will discuss and see examples of how durations in Cypher work - calculating durations from single dates, adding or subtracting durations from dates, and calculating the distance between 2 dates or times. Time to dive in!</p></div><div class=sect1><h2 id=_date_truncation>Date truncation</h2><div class=sectionbody><div class=paragraph><p>If you read the Cypher documentation on <a href=https://neo4j.com/docs/cypher-manual/current/functions/temporal/#functions-temporal-truncate-overview target=_blank rel=noopener>truncating dates</a>, the wording is accurate but kinda makes my head spin. So let me try to translate it.</p></div><div class=paragraph><p><strong>Cypher manual text:</strong>
A temporal instant value can be created by truncating another temporal instant value at the nearest preceding point in time at a specified component boundary (namely, a truncation unit). A temporal instant value created in this way will have all components which are less significant than the specified truncation unit set to their default values.</p></div><div class=paragraph><p><strong>My version:</strong>
You can trim (truncate) a temporal value at a specific point, which sets any smaller units to default values. For instance, truncating the date <code>2021-04-21</code> to the year means the year value will be preserved, and the month and day values will be defaulted to <code>01</code>, returning a result of <code>2021-01-01</code>.</p></div><div class=paragraph><p>This can be helpful if you want to default a search to generalize all dates by year or month. Note that if you want to completely shorten the date to the desired component (e.g. <code>2021-04-21</code> to just <code>2021</code>), you can do that by accessing the component of the value. This will be covered more in-depth in another post. Let’s look at a few examples of truncating dates.</p></div><div class=paragraph><p>Each of the Neo4j temporal instants (Date, Time, Datetime, LocalDatetime, LocalTime) can use the <code>.truncate()</code> at the end. Just as with the last post, we will stick with the more common Date, Time, and Datetime values. While LocalDatetime and LocalTime are valid and supported, there are very few cases that truly require the use of local, and it is more complex to work with.</p></div><div class=paragraph><p>Example 1: Truncating a datetime at the year</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH datetime.truncate(&#39;year&#39;,datetime()) as truncatedDatetime
MATCH (b:BlogPost)
WHERE b.publishedDatetime &gt;= truncatedDatetime
RETURN b.publishedDatetime, truncatedDatetime;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-2/sleuth_date_part2_1.png alt="sleuth date part2 1"></div></div><div class=paragraph><p>The above example looks for all blog posts published in 2021 (on or after 2021-01-01).</p></div><div class=paragraph><p>Example 2: Truncating a date at the month</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH date.truncate(&#39;month&#39;,date()) as truncatedDate
MATCH (p:Project)
WHERE p.expectedEndDate &gt; truncatedDate
RETURN p.expectedEndDate, truncatedDate;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-2/sleuth_date_part2_2.png alt="sleuth date part2 2"></div></div><div class=paragraph><p>Our example above is searching for projects that are not yet completed - have an expected end date after April 1, 2021.</p></div><div class=paragraph><p>Example 3: Truncating a date at the hour</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH time.truncate(&#39;hour&#39;,time(&#39;09:30:52-06:00&#39;)) as truncatedTime
MATCH (p:Presentation)
WHERE time.truncate(&#39;hour&#39;,p.time) = truncatedTime
RETURN time.truncate(&#39;hour&#39;,p.time), truncatedTime;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-2/sleuth_date_part2_3.png alt="sleuth date part2 3"></div></div><div class=paragraph><p>Example 3 above queries for any presentations that are going on during the <code>9am</code> hour. This could be useful during a conference when you want to see which sessions are going on during a particular hour.</p></div><div class=paragraph><p>We have seen how we can trim dates to create generic dates for use cases like starting points in searches. Now we will transition over to working with lengths of time using durations.</p></div></div></div><div class=sect1><h2 id=_cypher_duration>Cypher Duration</h2><div class=sectionbody><div class=paragraph><p>A duration in Cypher is the amount of time between two temporal instants. Whether we are using the duration itself to capture a length of time or calculating distance between points in time, these values are incredibly useful for time measurements. There are 2 different ways to state durations, listed as follows:</p></div><div class=ulist><ul><li><p>Unit-based amounts (literal <code>'P'</code> and/or <code>'T'</code> + numeric value + component id) - e.g. <code>P1Y3M10D</code> or <code>{hours: 24}</code>.</p></li><li><p>Date and Time instants (literal <code>'P'</code> and/or <code>'T'</code> + date and/or time value) - e.g. <code>P20210419</code> or <code>PT090000</code>.</p></li></ul></div><div class=paragraph><p>Let’s look at some examples.</p></div><div class=paragraph><p>Example 1: Getting a duration value (using unit-based amount)</p></div><div class=listingblock><div class=content><pre class=highlight><code>MERGE (p:Person)-[r:BOOKED]-&gt;(v:Vacation)
SET v.length = duration(&#39;P5D&#39;)
RETURN v.length as vacationDuration;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-2/sleuth_date_part2_4.png alt="sleuth date part2 4"></div></div><div class=paragraph><p>Setting the length for a person’s vacation. We could use this query for lodging planning, out-of-office emails, vacation activity scheduling, or other use cases.</p></div><div class=paragraph><p>Example 2: Set duration as frequency for medicine dosage</p></div><div class=listingblock><div class=content><pre class=highlight><code>MERGE (d:Dose)-[r:PRESCRIBED_AMOUNT]-&gt;(m:Medicine)
SET d.frequency = duration(&#39;PT4H&#39;)
RETURN d.frequency;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-2/sleuth_date_part2_5.png alt="sleuth date part2 5"></div></div><div class=paragraph><p>The example above uses this to calculate how often someone can take a prescribed medication. This value provides a nice way to add or subtract durations later on to calculate next doses and other intervals.</p></div><div class=paragraph><p>Example 3: Calculate a specific date as a duration</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (:Employee)-[rel:ASSIGNED]-(:Project)
RETURN rel.startDate as date, duration(&#39;P&#39;+ rel.startDate) as duration;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-2/sleuth_date_part2_6.png alt="sleuth date part2 6"></div></div><div class=paragraph><p><em>NOTE: Date format cannot include timezone value. A helpful memory key is that a length of time isn’t based on geographic location - only the distance between 2 dates or times. Also, date must be preceded by a literal <code>'P'</code> and time must be preceded by a literal <code>'T'</code>.</em></p></div><div class=paragraph><p>This tells us that we have 2021 years, 2 months, and 15 days from year 0. This has formatted our typical date as a duration (distance in time from some starting point, i.e. month, day, and year 0).</p></div><div class=paragraph><p>Example 3: Calculate specific time as a duration</p></div><div class=listingblock><div class=content><pre class=highlight><code>MERGE (p:Person)-[r:TAKES]-&gt;(d:Dose)
SET d.dose1Time = duration(&#39;PT093000&#39;)
RETURN d.dose1Time;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-2/sleuth_date_part2_7.png alt="sleuth date part2 7"></div></div><div class=paragraph><p>The example above tells us exactly how long after midnight a person took a medication. This could be incredibly critical for determining how close together doses are, as well as for tracking a strict schedule.</p></div></div></div><div class=sect1><h2 id=_calculations_with_dates_and_durations>Calculations with dates and durations</h2><div class=sectionbody><div class=paragraph><p>There are a few ways to go about using durations besides for the plain amounts we saw in the last section - for instance, adding or subtracting temporal amounts and calculating the difference between 2 dates. I would guess that these are probably the most common usages for durations. We will get some examples below of each, starting with adding or subtracting durations from dates.</p></div><div class=paragraph><p>Example 1: Subtract 2.5 months from end date to calculate start date</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (p:Project)
SET p.expectedStartDate = p.expectedEndDate - duration(&#39;P2.5M&#39;)
RETURN p.expectedEndDate, p.expectedStartDate;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-2/sleuth_date_part2_8.png alt="sleuth date part2 8"></div></div><div class=paragraph><p>In the example above, we are using a scheduled end date and an estimated duration of the project to calculate the project start date. I find that adding and subtracting lengths of time can be used for many different uses.</p></div><div class=paragraph><p>Example 2: Add 30 hours to start datetime to calculate end datetime</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (c:Conference)
SET c.endDatetime = c.startDatetime + duration({hours: 30})
RETURN c.startDatetime, c.endDatetime;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-2/sleuth_date_part2_9.png alt="sleuth date part2 9"></div></div><div class=paragraph><p>Above, we are using duration addition to calculate the end date/time for our conference. If we know what time the event plans to start and know the length of content we have, then this tells us what time the event can end.</p></div><div class=paragraph><p>Example 3: Calculate when to take the next medicine dose</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (d:Dose)
 SET d.dose2Time = d.dose1Time + d.frequency
RETURN d.dose2Time;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-2/sleuth_date_part2_10.png alt="sleuth date part2 10"></div></div><div class=paragraph><p>Based on the dose taken in a previous query and the frequency we can take the medication, the above query calculates the time (in hours and minutes from midnight) of our next dosage.</p></div></div></div><div class=sect1><h2 id=_calculate_difference_between_2_dates_with_duration_between>Calculate difference between 2 dates with duration.between</h2><div class=sectionbody><div class=paragraph><p>Now let’s calculate the difference between 2 dates. We will need to use <code>duration.between</code> to compare two dates and find the difference.</p></div><div class=paragraph><p>Example 1: Calculate duration between project start and end dates</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (:Employee)-[rel:ASSIGNED]-(p:Project)
RETURN rel.startDate as assigned, p.expectedEndDate as expectedCompletion, duration.between(rel.startDate, p.expectedEndDate) as lengthAssigned;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-2/sleuth_date_part2_11.png alt="sleuth date part2 11"></div></div><div class=paragraph><p>Our query above tells us how long an employee has been assigned to a project. This could be useful for determining resource usage or the number of hours someone has worked on something.</p></div><div class=paragraph><p>Example 2: Calculate amount of time currently spent on project</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (:Employee)-[rel:ASSIGNED]-(p:Project)
RETURN rel.startDate as assigned, duration.between(rel.startDate, date()) as timeSpent;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-2/sleuth_date_part2_12.png alt="sleuth date part2 12"></div></div><div class=paragraph><p>Using the query above, we can know how long our project has been going on. This tells us how much time has passed, and as with the previous query, can help us understand how many resources have been used on a project at a point in time.</p></div><div class=paragraph><p>Example 3: Calculate duration between differing datetime values</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (b:BlogPost)
RETURN date(&#39;2021-03-22&#39;) as started, b.publishedDatetime as published, duration.between(date(&#39;2021-03-22&#39;), b.publishedDatetime) as amountOfTimeSpent;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-2/sleuth_date_part2_13.png alt="sleuth date part2 13"></div></div><div class=paragraph><p>In our above query, we can find out how long it took to write a blog post. Again, this could be used to determine average time consumption for a person or for planning time needed on future posts. Because the time and timezone exist on the publishedDatetime and not on the start date we set, the duration time values (hours, minutes, seconds, milliseconds) are a little odd-looking, but we’ll see how to format that better in the next post!</p></div></div></div><div class=sect1><h2 id=_wrapping_up>Wrapping up!</h2><div class=sectionbody><div class=paragraph><p>We saw how to use Cypher’s duration to measure distance in time - whether starting from a length like <code>2 days</code>, adding or subtracting an amount from a date or time, or finding the difference between 2 dates/times.</p></div><div class=paragraph><p>In the next post, we will cover formatting and date components. We will see how to transform some of these durations into different formats, as well as how to access components of full date/time values and translate other temporal amounts into different units (i.e. <code>120 seconds</code> into <code>2 minutes</code>, or <code>72 hours</code> into <code>3 days</code>). Tune in next time and happy coding!</p></div></div></div><div class=sect1><h2 id=_resources>Resources</h2><div class=sectionbody><div class=ulist><ul><li><p>Cypher manual: <a href=https://neo4j.com/docs/cypher-manual/current/syntax/temporal/#cypher-temporal-durations target=_blank rel=noopener>Durations</a></p></li><li><p>Cypher manual: Create durations from <a href=https://neo4j.com/docs/cypher-manual/current/functions/temporal/duration/#functions-duration-create-components target=_blank rel=noopener>units</a> or from <a href=https://neo4j.com/docs/cypher-manual/current/functions/temporal/duration/#functions-duration-create-string target=_blank rel=noopener>dates and times</a></p></li><li><p>Cypher manual: <a href=https://neo4j.com/docs/cypher-manual/current/functions/temporal/duration/#functions-duration-computing target=_blank rel=noopener>Compute duration from 2 temporal instants</a></p></li><li><p>Blog post: <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part1 target=_blank rel=noopener>Part 1 of Cypher Sleuthing with Dates</a></p></li></ul></div></div></div><ul class=pa0><li class="list di"><a href=/tags/cypher/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">cypher</a></li><li class="list di"><a href=/tags/query-language/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">query language</a></li><li class="list di"><a href=/tags/dates/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">dates</a></li><li class="list di"><a href=/tags/temporal/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">temporal</a></li><li class="list di"><a href=/tags/programming/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">programming</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/blog/cypher-sleuthing-dates-part1/>Cypher Sleuthing: Dealing with Dates, Part 1</a></li><li class=mb2><a href=/blog/cypher-sleuthing-case-statement/>Cypher Sleuthing: the CASE statement</a></li><li class=mb2><a href=/blog/cypher-sleuthing-eager-operator/>Cypher Sleuthing: the EAGER operator</a></li><li class=mb2><a href=/blog/java-holds-its-own/>In the Language Wars, Java Holds Its Own</a></li></ul></div></aside></article></main><footer class="bg-dark-green bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://jmhreif.com/>&copy; Jennifer Reif 2024</a><div><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank rel=noopener class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank rel=noopener class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank rel=noopener class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank rel=noopener class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.podbean.com/ target=_blank rel=noopener class="podcast ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="podcast link" aria-label="follow on podcast——Opens in a new window"><span class=icon><svg width="1200pt" height="1200pt" viewBox="0 0 1200 1200" xmlns="http://www.w3.org/2000/svg"><path d="m6e2 62.484c-296.48.0-537.52 241.03-537.52 537.52s240.98 537.52 537.52 537.52c296.48.0 537.52-240.98 537.52-537.52.0-296.48-241.03-537.52-537.52-537.52zm-155.02 305.02c0-85.5 69.516-155.02 155.02-155.02S755.02 282 755.02 367.504v234.98c0 85.5-69.516 155.02-155.02 155.02s-155.02-69.516-155.02-155.02zm192.52 516.52v66c0 20.484-17.016 37.5-37.5 37.5s-37.5-17.016-37.5-37.5v-66C408 865.508 288 734.024 288 574.504c0-20.484 17.016-37.5 37.5-37.5s37.5 17.016 37.5 37.5c0 130.5 106.5 237 237 237s237-106.5 237-237c0-20.484 17.016-37.5 37.5-37.5s37.5 17.016 37.5 37.5c0 159.52-120 291-274.5 309.52z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>