<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Journeys in Java, Level 3: Building an Empire of Microservices | Jennifer Reif</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Photo credit We are still in the beginning stages of building microservices with Java, but we have already seen how to send and receive communications between two Spring Boot applications. In the first blog post of this series, our two applications transmitted a message string of &#34;Hello, World!&#34;. In the second blog post, we took it one step further by embedding a MongoDB database into our service1, added a data domain (books) with four pre-populated entries, and transmitted the Book information between the two applications."><meta name=generator content="Hugo 0.119.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><link rel=canonical href=https://jmhreif.com/blog/2022/microservices-level3/><meta property="og:title" content="Journeys in Java, Level 3: Building an Empire of Microservices"><meta property="og:description" content="Photo credit We are still in the beginning stages of building microservices with Java, but we have already seen how to send and receive communications between two Spring Boot applications. In the first blog post of this series, our two applications transmitted a message string of &#34;Hello, World!&#34;. In the second blog post, we took it one step further by embedding a MongoDB database into our service1, added a data domain (books) with four pre-populated entries, and transmitted the Book information between the two applications."><meta property="og:type" content="article"><meta property="og:url" content="https://jmhreif.com/blog/2022/microservices-level3/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-02-11T09:00:00-06:00"><meta property="article:modified_time" content="2022-02-11T09:00:00-06:00"><meta itemprop=name content="Journeys in Java, Level 3: Building an Empire of Microservices"><meta itemprop=description content="Photo credit We are still in the beginning stages of building microservices with Java, but we have already seen how to send and receive communications between two Spring Boot applications. In the first blog post of this series, our two applications transmitted a message string of &#34;Hello, World!&#34;. In the second blog post, we took it one step further by embedding a MongoDB database into our service1, added a data domain (books) with four pre-populated entries, and transmitted the Book information between the two applications."><meta itemprop=datePublished content="2022-02-11T09:00:00-06:00"><meta itemprop=dateModified content="2022-02-11T09:00:00-06:00"><meta itemprop=wordCount content="2040"><meta itemprop=keywords content="java,microservices,applications,development,spring-boot,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Journeys in Java, Level 3: Building an Empire of Microservices"><meta name=twitter:description content="Photo credit We are still in the beginning stages of building microservices with Java, but we have already seen how to send and receive communications between two Spring Boot applications. In the first blog post of this series, our two applications transmitted a message string of &#34;Hello, World!&#34;. In the second blog post, we took it one step further by embedding a MongoDB database into our service1, added a data domain (books) with four pre-populated entries, and transmitted the Book information between the two applications."></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://jmhreif.com/img/microservices-lvl3/unsplash-tall-stone-arch-bridge.jpeg)><div class=bg-black-60><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Jennifer Reif</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/ title="Home page">Home</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blog/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/abstracts/ title="Abstracts page">Abstracts</a></li></ul><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank rel=noopener class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank rel=noopener class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank rel=noopener class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank rel=noopener class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.podbean.com/ target=_blank rel=noopener class="podcast ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="podcast link" aria-label="follow on podcast——Opens in a new window"><span class=icon><svg width="1200pt" height="1200pt" viewBox="0 0 1200 1200" xmlns="http://www.w3.org/2000/svg"><path d="m6e2 62.484c-296.48.0-537.52 241.03-537.52 537.52s240.98 537.52 537.52 537.52c296.48.0 537.52-240.98 537.52-537.52.0-296.48-241.03-537.52-537.52-537.52zm-155.02 305.02c0-85.5 69.516-155.02 155.02-155.02S755.02 282 755.02 367.504v234.98c0 85.5-69.516 155.02-155.02 155.02s-155.02-69.516-155.02-155.02zm192.52 516.52v66c0 20.484-17.016 37.5-37.5 37.5s-37.5-17.016-37.5-37.5v-66C408 865.508 288 734.024 288 574.504c0-20.484 17.016-37.5 37.5-37.5s37.5 17.016 37.5 37.5c0 130.5 106.5 237 237 237s237-106.5 237-237c0-20.484 17.016-37.5 37.5-37.5s37.5 17.016 37.5 37.5c0 159.52-120 291-274.5 309.52z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked ttu">Blog</aside><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/intent/tweet?url=https://jmhreif.com/blog/2022/microservices-level3/&amp;text=Journeys%20in%20Java,%20Level%203:%20Building%20an%20Empire%20of%20Microservices" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://jmhreif.com/blog/2022/microservices-level3/&amp;title=Journeys%20in%20Java,%20Level%203:%20Building%20an%20Empire%20of%20Microservices" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div><h1 class="f1 athelas mt3 mb1">Journeys in Java, Level 3: Building an Empire of Microservices</h1><time class="f6 mv4 dib tracked" datetime=2022-02-11T09:00:00-06:00>February 11, 2022</time>
<span class="f6 mv4 dib tracked">- 10 minutes read</span>
<span class="f6 mv4 dib tracked">- 2040 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><div class=paragraph><small><i><a href="https://unsplash.com/photos/z6QZo6DKt_E?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditShareLink">Photo credit</a></i></small></div><div class=paragraph><p>We are still in the beginning stages of building microservices with Java, but we have already seen how to send and receive communications between two Spring Boot applications. In the <a href=https://jmhreif.com/blog/2021/microservices-level1/ target=_blank rel=noopener>first blog post</a> of this series, our two applications transmitted a message string of <code>"Hello, World!"</code>. In the <a href=https://jmhreif.com/blog/2022/microservices-level2/ target=_blank rel=noopener>second blog post</a>, we took it one step further by embedding a MongoDB database into our <code>service1</code>, added a data domain (books) with four pre-populated entries, and transmitted the <code>Book</code> information between the two applications.</p></div><div class=paragraph><p>This post will advance once again by upgrading our embedded MongoDB instance to a full-fledged database running in a Docker container. Under official terms, we probably wouldn’t classify the container as a separate microservice. What actually would classify it as a microservice might vary depending on who you talked to. For now, since our database container only connects to the backend API service to provide the data for it, we will simply consider this a backing service, or even a supporting component of the <code>service1</code>.</p></div><div class=paragraph><p>I like to think of it like a restaurant kitchen. It is usually walled off separately and hidden (though still part of the same building), but the kitchen is the heart and a critical component of the restaurant. However you want to think of it, let’s get started building it!</p></div><div class=sect1><h2 id=_architecture>Architecture</h2><div class=sectionbody><div class=paragraph><p>Our architecture from the previous couple of blog posts started with two Spring Boot applications communicating to one another via HTTP. The project goal is to slowly assemble microservices in manageable pieces to improve understanding (yours and mine). :)</p></div><div class=paragraph><p>With this in mind, this third installment of the microservices project will migrate our "test environment" embedded database to a MongoDB instance in a Docker container with imported external data.</p></div><div class=paragraph><p>Here is the updated architecture:</p></div><div class=imageblock><div class=content><img src=/img/microservices-lvl3/microservices-level3.png alt="microservices level3"></div></div><div class=paragraph><p>We decided on a data domain of books in the previous blog post, so we can load Kaggle’s existing <a href=https://www.kaggle.com/jealousleopard/goodreadsbooks target=_blank rel=noopener>Goodreads</a> data set as a starting source.</p></div><div class=paragraph><p>That means we need to spin up a Docker container with MongoDB first, then load the data into it second before we can move to our interacting applications.</p></div></div></div><div class=sect1><h2 id=_docker_container>Docker container</h2><div class=sectionbody><div class=paragraph><p>Many of you are probably familiar with what <a href=https://www.docker.com/resources/what-container target=_blank rel=noopener>Docker</a> is and how to use containers, but let me spend a couple of sentences on background anyway. The term containers actually matches the design of the technology itself. It’s like taking all the required components for running an application (a mini virtual machine, the application, and any other necessary tools) and putting them inside a neatly packaged box (i.e. container). Yes, I like metaphors. :)</p></div><div class=paragraph><p>This architecture makes these containers smaller in size than a full VM counterpart and independent of environment. Containers are composed from a recipe-style file (called a <code>Dockerfile</code>) so that they can be created and destroyed quickly and consistently using the defined recipe.</p></div><div class=paragraph><p>To create a container with MongoDB running in it, we will need to create that recipe <code>Dockerfile</code>. Many companies have eliminated the duplication of creating custom containerized versions of their software by providing <code>base images</code> - a starter recipe that others can run or use as a foundation. We have done just that in our Dockerfile using <a href=https://hub.docker.com/_/mongo target=_blank rel=noopener>MongoDB’s base image</a>.</p></div><div class=paragraph><p>All of the code for our Docker container is available in the related folder of the <a href=https://github.com/JMHReif/microservices-level3/tree/main/docker-mongodb target=_blank rel=noopener>Github project</a>.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-text data-lang=text>#Pull base image
#-----------------
FROM mongo

#Author
#-------
LABEL org.opencontainers.image.authors=&#34;Jennifer Reif,jennifer@thehecklers.org,@JMHReif&#34;

#expose the default port
EXPOSE 27017</code></pre></div></div><div class=paragraph><p>In the first code block, we are pulling that base image (<code>mongo</code>) for MongoDB. The next section tells anyone who might use this Dockerfile who maintains it (me). The last couple of lines expose a port in order to connect to the container using MongoDB’s default port is 27017.</p></div><div class=paragraph><p>If you clone the full <a href=https://github.com/JMHReif/microservices-level3 target=_blank rel=noopener>microservices-level3 repository</a>, you should be able to follow the <a href=https://github.com/JMHReif/microservices-level3/tree/main/docker-mongodb#building-and-running-the-image target=_blank rel=noopener>instructions</a> in the README file in the <code>docker-mongodb</code> folder to build and run the container on your machine.</p></div><div class=paragraph><p><em>Note: If you are particular about file locations, you might want to change the folder paths in the <code>runMongoDB.sh</code> script to be something specific to your preferences. You’re also welcome to use what I’ve defined, if it doesn’t matter. Also, Windows users will need to adjust the syntax to match Windows file syntax and paths.</em></p></div><div class=paragraph><p>Next, we will get the data loaded to our MongoDB instance running in the container.</p></div></div></div><div class=sect1><h2 id=_book_data_import>Book data import</h2><div class=sectionbody><div class=paragraph><p>As mentioned earlier in the architecture section, we are going to load data about books using the <a href=https://www.kaggle.com/jealousleopard/goodreadsbooks target=_blank rel=noopener>Goodreads</a> data set on Kaggle. The spreadsheet-formatted data is free to use, and it includes data such as title, author, reviews, and ratings about each book. There are several fields, but not so many to be unmanageable.</p></div><div class=paragraph><p>The Github repository <a href=https://github.com/JMHReif/microservices-level3/tree/main/docker-mongodb/loadData target=_blank rel=noopener><code>loadData</code> folder</a> already contains the spreadsheet, so if you downloaded the repository, you already have it. A formatted version of the spreadsheet (for better import) is also included, along with the load script.</p></div><div class=paragraph><p>To start the data load, we need to copy the <code>books_quoted.csv</code> and the <code>insert_books.sh</code> files into a folder that the container can reach. Thankfully, in our script to spin up the container (<a href=https://github.com/JMHReif/microservices-level3/blob/main/docker-mongodb/runMongoDB.sh target=_blank rel=noopener><code>runMongoDB.sh</code></a>), we specified a data directory that maps to an external folder on our local machine. So, we can copy the CSV and shell script over to whatever specified there. If you used my defaults, then it would be <code>$HOME/Projects/docker/mongoBooks/data</code>.</p></div><div class=paragraph><p>Then, we need to get into our container to load the data in there. All of the steps for that are outlined in the <a href=https://github.com/JMHReif/microservices-level3/tree/main/docker-mongodb#loading-book-data-into-mongodb-container target=_blank rel=noopener>related section of the README</a> from the repository, along with some tests for checking that the data loaded properly.</p></div><div class=paragraph><p>Back to our microservices applications!</p></div></div></div><div class=sect1><h2 id=_applications_service_1>Applications - Service 1</h2><div class=sectionbody><div class=paragraph><p>Our application code doesn’t change much to go from an embedded to a separate instance of MongoDB. Though our database instance is becoming separate from the application, we aren’t classifying it as a different service because it is the backing/support for <code>service1</code>.</p></div><div class=paragraph><p>The largest amount of work was setting up the database itself, and if you have gotten this far, then the hardest part is already complete! Most of what we change, then, is going to be the connection details to plug in to the datatbase instance. Changes start in our <code>pom.xml</code> file, where we need to update our dependency from the embedded test version to the production-style independent instance.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-xml data-lang=xml>&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-data-mongodb-reactive&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre></div></div><div class=paragraph><p>We are using the official Spring Data MongoDB dependency, which means we get all the goodness of Spring’s functionality interacting with a production-grade database. You may have also noticed the reactive suffix of the artifactId. Spring Data MongoDB provides a separate library for imperative-style code. Since we want to move data and events between applications for microservices as asynchronously as possible, we will use the reactive library.</p></div><div class=paragraph><p>We will also need to make a couple of changes to the <code>application.properties</code> file to connect to the database instance and remove the test instance properties. Our updated property file looks like the one below.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-text data-lang=text>server.port=8081

#database connection
spring.data.mongodb.uri=mongodb://mongoadmin:Testing123@localhost:27017
spring.data.mongodb.database=books</code></pre></div></div><div class=paragraph><p>We removed the MongoDB port and embedded versioning in favor of a full URI property (includes the MongoDB port of <code>27017</code>) along with a database name on the instance. This is because a single MongoDB instance can hold multiple separate data stores with different data sets. I could have a database of books and a database of customers that exist in the same installation, but are organized in separate storage compartments of that installation.</p></div><div class=paragraph><p>On to the Java code!</p></div><div class=sect2><h3 id=_service_1_project_code>Service 1 - project code</h3><div class=paragraph><p>Since we are not really changing much in our project code itself, I left our classes in the main <code>Service1Application</code> Java file. As always, we will start at the bottom of the file and work our way up.</p></div><div class=paragraph><p>First, some of the fields in our spreadsheet that we loaded had slightly different naming. So, our database has different property names than our application. That’s ok, but it means that we will need to map those fields, or Spring won’t know what equals what.</p></div><div class=paragraph><p>We can do this in a couple of different ways. 1) keep our variable names in the application and add the <code>@Property</code> annotation to specify what that field equals in the database, 2) change our variable names. The database fields are sensible and understandable, so in this case, I will just change the variable names in the application to match the database.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@Data
@Document
class Book {
	@Id
	private String bookID;
	@NonNull
	private String title;
	@NonNull
	private String authors;
}</code></pre></div></div><div class=paragraph><p>You might ask what changed? The id field went from <code>bookId</code> to <code>bookID</code>, and the author field went from <code>author</code> to <code>authors</code>. These are very minor differences, but ones that wouldn’t allow the values to be mapped properly if we didn’t match exactly.</p></div><div class=paragraph><p>The <code>BookRepository</code> interface just above the domain class does not change at all and neither does the <code>BookController</code> class above that. However, the <code>Service1Application</code> class does. We actually revert back to what we had in the <a href=https://github.com/JMHReif/microservices-level1/blob/main/service1/src/main/java/com/jmhreif/service1/Service1Application.java target=_blank rel=noopener>Level1</a> rendition of the code with only the <code>main</code> method.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@SpringBootApplication
public class Service1Application {

	public static void main(String[] args) {
		SpringApplication.run(Service1Application.class, args);
	}
}</code></pre></div></div><div class=paragraph><p>The CommandLineRunner bean is no longer needed because we are not populating an embedded database with dummy data, but rather using a separate database with a real data set loaded. Once we remove the bean, that is all for <code>service1</code>! Time to move over to <code>service2</code>.</p></div></div></div></div><div class=sect1><h2 id=_applications_service_2>Applications - Service 2</h2><div class=sectionbody><div class=paragraph><p>This service is our client-side service that calls <code>service1</code> and displays the response. Because we are not changing functionality on the frontend side of the application, we do not need to update the <code>pom.xml</code> or the <code>application.properties</code> file.</p></div><div class=paragraph><p>Let’s see about the class code.</p></div><div class=sect2><h3 id=_service_2_project_code>Service 2 - project code</h3><div class=paragraph><p>Since we changed the domain class in service1, so that means we need to align the domain class in service2, as well.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@Data
class Book {
	private String bookID;
	private String title;
	private String authors;
}</code></pre></div></div><div class=paragraph><p>Just as in service1, we updated the first and last properties to <code>bookID</code> and <code>authors</code>. This maps our data coming from service1 to the correct fields in service2.</p></div><div class=paragraph><p>We do not need to change the way the request is pulling/retrieving the information. However, we did change our data domain, so I will make one minor change to the client url from <code>/hello</code> to <code>/goodreads</code> so that it aligns with our domain better.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@RestController
@AllArgsConstructor
@RequestMapping(&#34;/goodreads&#34;)
class BookController {
	private final WebClient client;

	@GetMapping(&#34;/books&#34;)
	Flux&lt;Book&gt; getBooks() {
		return client.get()
				.uri(&#34;/db/books&#34;)
				.retrieve()
				.bodyToFlux(Book.class);
	}
}</code></pre></div></div><div class=paragraph><p>The mapping annotations are the only lines that has changed, so we will need to go to <code>localhost:8080/goodreads/books</code> now.</p></div><div class=paragraph><p>Let’s test our changes!</p></div></div></div></div><div class=sect1><h2 id=_put_it_to_the_test>Put it to the test</h2><div class=sectionbody><div class=paragraph><p>Just like in updating the code, I like to spin up functionality from the bottom and move up. So, we need to make sure the database is running in our Docker container. You can check whether the container is running with <code>docker ps</code>. If you don’t see anything, you can start the container with <code>docker start mongoBooks</code>. Then we can use <code>docker ps</code> to check it again.</p></div><div class=paragraph><div class=title>Docker ps mongoBooks - not running</div><p><span class=image><img src=/img/microservices-lvl3/dockerpsMongoBooks_notrunning.png alt="dockerpsMongoBooks notrunning"></span></p></div><div class=paragraph><div class=title>Docker start mongoBooks</div><p><span class=image><img src=/img/microservices-lvl3/dockerstartMongoBooks.png alt=dockerstartMongoBooks></span></p></div><div class=paragraph><p>Next, we can start the service1 and service2 applications, either through an IDE or the command line. Once both are running, open a browser and go to <code>localhost:8080/goodreads/books</code>. Alternatively, you can run this at the command line with <code>curl localhost:8080/goodreads/books</code> or (if you have <a href=https://httpie.io/ target=_blank rel=noopener>httpie</a> tool installed) <code>http :8080/goodreads/books</code>.</p></div><div class=paragraph><p>And here is the resulting output!</p></div><div class=imageblock><div class=content><img src=/img/microservices-lvl3/microservices-lvl3-results.png alt="microservices lvl3 results"></div></div></div></div><div class=sect1><h2 id=_wrapping_up>Wrapping up!</h2><div class=sectionbody><div class=paragraph><p>This step in our microservices project took us from an embedded instance of MongoDB to a standalone database running in a Docker container. The <code>service1</code> and <code>service2</code> application code may not have changed much, but it puts us in a production-ready layout.</p></div><div class=paragraph><p>We saw how to create and run MongoDB database in a Docker container using a Dockerfile as our recipe, and we imported external data from a spreadsheet. We kept our two Spring Boot applications passing book data, with service1 now connecting to the MongoDB backing database to retrieve the loaded books.</p></div><div class=paragraph><p>As always, there is much more to learn and many more steps to a large system of services, but we are on our way to building and understanding microservices one small step at a time.</p></div><div class=paragraph><p>Happy coding!</p></div></div></div><div class=sect1><h2 id=_resources>Resources</h2><div class=sectionbody><div class=ulist><ul><li><p>Github: <a href=https://github.com/JMHReif/microservices-level3 target=_blank rel=noopener>microservices-level3</a> repository</p></li><li><p>Documentation: <a href=https://spring.io/projects/spring-data-mongodb target=_blank rel=noopener>Spring Data MongoDB</a></p></li><li><p>Previous blog posts: <a href=https://jmhreif.com/blog/2021/microservices-level1/ target=_blank rel=noopener>Microservices Level 1</a>, <a href=https://jmhreif.com/blog/2022/microservices-level2/ target=_blank rel=noopener>Microservices Level 2</a></p></li><li><p>Containers: <a href=https://www.docker.com/ target=_blank rel=noopener>Docker</a></p></li></ul></div></div></div><ul class=pa0><li class="list di"><a href=/tags/java/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">java</a></li><li class="list di"><a href=/tags/microservices/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">microservices</a></li><li class="list di"><a href=/tags/applications/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">applications</a></li><li class="list di"><a href=/tags/development/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">development</a></li><li class="list di"><a href=/tags/spring-boot/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">spring-boot</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/blog/2022/microservices-level2/>Journeys in Java, Level 2: Building an Empire of Microservices</a></li><li class=mb2><a href=/blog/2021/microservices-level1/>Journeys in Java, Level 1: Building an Empire of Microservices</a></li><li class=mb2><a href=/blog/2021/migrate-sdn-part3/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 3</a></li><li class=mb2><a href=/blog/2021/migrate-sdn-part2/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 2</a></li><li class=mb2><a href=/blog/2021/migrate-sdn-part1/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 1</a></li><li class=mb2><a href=/blog/2021/create-data-marvel-sdn/>Create a Data Marvel with Spring Data Neo4j</a></li><li class=mb2><a href=/blog/2021/java17-graph-explore/>Java 17: Explore the newly-released Java version in a graph database!</a></li><li class=mb2><a href=/blog/2019/java-holds-its-own/>In the Language Wars, Java Holds Its Own</a></li></ul></div></aside></article></main><footer class="bg-dark-green bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://jmhreif.com/>&copy; Jennifer Reif 2024</a><div><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank rel=noopener class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank rel=noopener class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank rel=noopener class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank rel=noopener class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.podbean.com/ target=_blank rel=noopener class="podcast ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="podcast link" aria-label="follow on podcast——Opens in a new window"><span class=icon><svg width="1200pt" height="1200pt" viewBox="0 0 1200 1200" xmlns="http://www.w3.org/2000/svg"><path d="m6e2 62.484c-296.48.0-537.52 241.03-537.52 537.52s240.98 537.52 537.52 537.52c296.48.0 537.52-240.98 537.52-537.52.0-296.48-241.03-537.52-537.52-537.52zm-155.02 305.02c0-85.5 69.516-155.02 155.02-155.02S755.02 282 755.02 367.504v234.98c0 85.5-69.516 155.02-155.02 155.02s-155.02-69.516-155.02-155.02zm192.52 516.52v66c0 20.484-17.016 37.5-37.5 37.5s-37.5-17.016-37.5-37.5v-66C408 865.508 288 734.024 288 574.504c0-20.484 17.016-37.5 37.5-37.5s37.5 17.016 37.5 37.5c0 130.5 106.5 237 237 237s237-106.5 237-237c0-20.484 17.016-37.5 37.5-37.5s37.5 17.016 37.5 37.5c0 159.52-120 291-274.5 309.52z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>