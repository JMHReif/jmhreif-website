<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>GenAI blood, sweat, and tears: Loading data to Pinecone | Jennifer Reif</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Photo credit As someone who is pretty familiar with relational and graph databases, I wanted to dig a little deeper into vector databases and understand the strengths and quirks they bring to the database table. I put together a conference abstract on vector RAG versus GraphRAG which got picked up, so I went to work building a demo and learning all I could.
I pivoted a few times along the way, but ended up with a Spring AI application that connects to both Pinecone (vector database) and Neo4j (graph database)."><meta name=generator content="Hugo 0.119.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><link rel=canonical href=https://jmhreif.com/blog/2025/vector-graph-rag/><meta property="og:title" content="GenAI blood, sweat, and tears: Loading data to Pinecone"><meta property="og:description" content="Photo credit As someone who is pretty familiar with relational and graph databases, I wanted to dig a little deeper into vector databases and understand the strengths and quirks they bring to the database table. I put together a conference abstract on vector RAG versus GraphRAG which got picked up, so I went to work building a demo and learning all I could.
I pivoted a few times along the way, but ended up with a Spring AI application that connects to both Pinecone (vector database) and Neo4j (graph database)."><meta property="og:type" content="article"><meta property="og:url" content="https://jmhreif.com/blog/2025/vector-graph-rag/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-04-09T09:00:00-06:00"><meta property="article:modified_time" content="2025-04-09T09:00:00-06:00"><meta itemprop=name content="GenAI blood, sweat, and tears: Loading data to Pinecone"><meta itemprop=description content="Photo credit As someone who is pretty familiar with relational and graph databases, I wanted to dig a little deeper into vector databases and understand the strengths and quirks they bring to the database table. I put together a conference abstract on vector RAG versus GraphRAG which got picked up, so I went to work building a demo and learning all I could.
I pivoted a few times along the way, but ended up with a Spring AI application that connects to both Pinecone (vector database) and Neo4j (graph database)."><meta itemprop=datePublished content="2025-04-09T09:00:00-06:00"><meta itemprop=dateModified content="2025-04-09T09:00:00-06:00"><meta itemprop=wordCount content="1745"><meta itemprop=keywords content="rag,vector,data,learning,genai,"><meta name=twitter:card content="summary"><meta name=twitter:title content="GenAI blood, sweat, and tears: Loading data to Pinecone"><meta name=twitter:description content="Photo credit As someone who is pretty familiar with relational and graph databases, I wanted to dig a little deeper into vector databases and understand the strengths and quirks they bring to the database table. I put together a conference abstract on vector RAG versus GraphRAG which got picked up, so I went to work building a demo and learning all I could.
I pivoted a few times along the way, but ended up with a Spring AI application that connects to both Pinecone (vector database) and Neo4j (graph database)."></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://jmhreif.com/img/unsplash-hard-labor.jpg)><div class=bg-black-60><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Jennifer Reif</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/ title="Home page">Home</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blog/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/abstracts/ title="Abstracts page">Abstracts</a></li></ul><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank rel=noopener class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank rel=noopener class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank rel=noopener class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank rel=noopener class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.podbean.com/ target=_blank rel=noopener class="podcast ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="podcast link" aria-label="follow on podcast——Opens in a new window"><span class=icon><svg width="1200pt" height="1200pt" viewBox="0 0 1200 1200" xmlns="http://www.w3.org/2000/svg"><path d="m6e2 62.484c-296.48.0-537.52 241.03-537.52 537.52s240.98 537.52 537.52 537.52c296.48.0 537.52-240.98 537.52-537.52.0-296.48-241.03-537.52-537.52-537.52zm-155.02 305.02c0-85.5 69.516-155.02 155.02-155.02S755.02 282 755.02 367.504v234.98c0 85.5-69.516 155.02-155.02 155.02s-155.02-69.516-155.02-155.02zm192.52 516.52v66c0 20.484-17.016 37.5-37.5 37.5s-37.5-17.016-37.5-37.5v-66C408 865.508 288 734.024 288 574.504c0-20.484 17.016-37.5 37.5-37.5s37.5 17.016 37.5 37.5c0 130.5 106.5 237 237 237s237-106.5 237-237c0-20.484 17.016-37.5 37.5-37.5s37.5 17.016 37.5 37.5c0 159.52-120 291-274.5 309.52z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked ttu">Blog</aside><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/intent/tweet?url=https://jmhreif.com/blog/2025/vector-graph-rag/&amp;text=GenAI%20blood,%20sweat,%20and%20tears:%20Loading%20data%20to%20Pinecone" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://jmhreif.com/blog/2025/vector-graph-rag/&amp;title=GenAI%20blood,%20sweat,%20and%20tears:%20Loading%20data%20to%20Pinecone" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div><h1 class="f1 athelas mt3 mb1">GenAI blood, sweat, and tears: Loading data to Pinecone</h1><time class="f6 mv4 dib tracked" datetime=2025-04-09T09:00:00-06:00>April 9, 2025</time>
<span class="f6 mv4 dib tracked">- 9 minutes read</span>
<span class="f6 mv4 dib tracked">- 1745 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><div class=paragraph><small><i><a href="https://unsplash.com/photos/a-man-with-his-hands-covered-with-mud-IdjxBF_StBk?utm_content=creditShareLink&amp;utm_medium=referral&amp;utm_source=unsplash">Photo credit</a></i></small></div><div class=paragraph><p>As someone who is pretty familiar with relational and graph databases, I wanted to dig a little deeper into vector databases and understand the strengths and quirks they bring to the database table. I put together a conference abstract on vector RAG versus GraphRAG which got picked up, so I went to work building a demo and learning all I could.</p></div><div class=paragraph><p>I pivoted a few times along the way, but ended up with a Spring AI application that connects to both Pinecone (vector database) and Neo4j (graph database). There were a few surprises throughout, which I’ll be sure to mention. Let’s get started!</p></div><div class=sect1><h2 id=_getting_started>Getting started</h2><div class=sectionbody><div class=paragraph><p>The first decision I had to tackle was how to get data into Pinecone. My final Pinecone data load solution is available in the <a href=https://github.com/JMHReif/vectordb-data-load target=_blank rel=noopener>vectordb-data-load code repository in Github</a>.</p></div><div class=paragraph><p>I previously played with a <a href=https://github.com/JMHReif/graph-demo-datasets/tree/main/goodreadsUCSD target=_blank rel=noopener>book recommendations data set</a> for a GenAI application, so that seemed a solid starting point.</p></div><div class=paragraph><p>After spending a bit of time exporting a smaller set of that data from Neo4j to JSON files, I started looking at how to get that data into Pinecone. I spun up a free tier instance on Pinecone’s cloud database-as-a-service, which was pretty easy and painless.</p></div><div class=paragraph><p>Here’s where the "fun" began. The first surprising hurdle was simply connecting to Pinecone.</p></div></div></div><div class=sect1><h2 id=_issue_1_apis_sdks_and_rapid_change>Issue #1: APIs, SDKs, and rapid change</h2><div class=sectionbody><div class=paragraph><p>Many of the issues and hours spent troubleshooting arose from a recent API change in Pinecone and lack of documentation updates across the board (integrations for Spring AI and Neo4j APOC). The process went something like this:</p></div><div class="olist arabic"><ol class=arabic><li><p>I started with the Pinecone documentation, which I found has a <a href=https://docs.pinecone.io/reference/java-sdk target=_blank rel=noopener>Java SDK</a>! I worked on a JBang script that uses the Pinecone Java SDK to create an index and load data. But…​the Pinecone Java SDK does not have near the functionality of the Python SDK. The biggest missing pieces are that the Java one doesn’t support <a href=https://docs.pinecone.io/reference/api/2025-01/control-plane/create_for_model target=_blank rel=noopener>creating an integrated index</a> (creates vectors with Pinecone-hosted model) nor <a href=https://docs.pinecone.io/reference/api/2025-01/data-plane/upsert_records target=_blank rel=noopener>upserting text</a> (intake text, create the vector, and insert it). I’d have to create the vector, save it somewhere, and upsert the data.</p></li><li><p>Next was Spring Boot, which integrates with Pinecone and should give me more flexibility. But, I struggled to get the app to connect. Pinecone recently updated their console to show only the instance URI, which didn’t match the Spring AI documentation nor Pinecone docs. I couldn’t find any content that reflected the latest requirements, but found out the Neo4j APOC library can interact with Pinecone! That seemed a simpler approach.</p></li><li><p>The Neo4j APOC library contains several procedures for connecting to Pinecone, but I struggled with similar issues in aligning the expectations of Pinecone and APOC connection config. It wasn’t clear how to provide the API key (<strong>p.s.</strong> it’s provided as a <code>header</code> key in config param), but then the API path has changed from what was implemented in APOC. After digging through APOC’s code (<a href=https://github.com/neo4j-contrib/neo4j-apoc-procedures target=_blank rel=noopener>open source repo</a>), I couldn’t customize the connection string without rewriting the source code.</p></li></ol></div><div class=paragraph><p>Since I didn’t immediately have time for making library changes, submitting PRs, and waiting for approvals/release, I pivoted back to Spring AI. The next step was to figure out the config pieces and assemble them.</p></div></div></div><div class=sect1><h2 id=_issue_2_config>Issue #2: Config</h2><div class=sectionbody><div class=paragraph><p>I was back to sorting out the connection string components. Pinecone shows a URI in the console, but Spring AI uses an assembly of index name, environment, and region. I had to reference a few pieces of old Pinecone docs, older community forum posts, and old-fashioned trial and error before I finally discovered the correct arrangement of puzzle pieces I needed to connect the app to Pinecone. The format is as follows: <code><a href="https://<indexName>-<projectId>.svc.<environment>.pinecone.io" class=bare>https://&lt;indexName>-&lt;projectId>.svc.&lt;environment>.pinecone.io</a></code>.</p></div><div class=paragraph><p>What was so confusing about this is that Pinecone uses generated text for each bit, so it isn’t clear what the index name, project ID, and environment are just from looking at the string. You had to know what to look for. As an example, the URI might look like this: <code><a href=https://example-index-ljwer.svc.nre-4520-jknw.pinecone.io class=bare>https://example-index-ljwer.svc.nre-4520-jknw.pinecone.io</a></code>. The index name is <code>example-index</code>, the project ID is <code>ljwer</code>, and the environment is <code>nre-4520-jknw</code>.</p></div><div class=paragraph><p>Then I had to map those pieces to the Spring AI config shown below:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-properties data-lang=properties>spring.ai.vectorstore.pinecone.index-name=example-index
spring.ai.vectorstore.pinecone.project-id=ljwer
spring.ai.vectorstore.pinecone.environment=nre-4520-jknw
spring.ai.vectorstore.pinecone.api-key=&lt;VALUE_HERE&gt;</code></pre></div></div><div class=paragraph><p>Now that I was connected, I tackled the next challenge: loading data into Pinecone.</p></div></div></div><div class=sect1><h2 id=_issue_3_json_format>Issue #3: JSON format</h2><div class=sectionbody><div class=paragraph><p>Another confusion was understanding how to work with data in a valid, but unusual, format called <a href=https://jsonlines.org/ target=_blank rel=noopener>JSON lines</a>. Instead of placing items of a list in brackets and each separated by a comma, JSON lines uses a newline character to separate each item.</p></div><div class=paragraph><p>Here is a sample:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-json data-lang=json>{&#34;rating&#34;:5,&#34;book_id&#34;:&#34;676924&#34;,&#34;id&#34;:&#34;853d3b4f5c9e8aa57a65c2ccc2e7328c&#34;,&#34;text&#34;:&#34;LOVED IT!&#34;}
{&#34;rating&#34;:5,&#34;book_id&#34;:&#34;29780253&#34;,&#34;id&#34;:&#34;8a3aaef2c2a7b3c5202046d4ce0f633d&#34;,&#34;text&#34;:&#34;Trevor Noah is basically the best person ever. So touching and motivating; and always funny.&#34;}
{&#34;rating&#34;:3,&#34;book_id&#34;:&#34;20613518&#34;,&#34;id&#34;:&#34;3ab7d51c2e977169b0bc1deeeb7e7db7&#34;,&#34;text&#34;:&#34;Great premise; poor execution.&#34;}</code></pre></div></div><div class=paragraph><p>I ended up with this because I exported a portion of the data from a Neo4j database, and that’s the format it streams. I had to use some regex magic to strip out escape characters using this command: <code>sed 's/\\"/"/g'</code> and get the data shown above.</p></div><div class=paragraph><p>Many forums have responses that say this is invalid JSON, though after finding the official JSON lines site and documentation, I know that’s inaccurate. The helpful thing with this format is that reading the JSON does not try to suck up a large array and blow up application memory. The downside is that you have to read each line separately and operate on it, which adds a bit more processing logic than what I had hoped.</p></div><div class=paragraph><p>You can follow some of the debugging steps I took by looking at my <a href=https://github.com/JMHReif/vectordb-data-load/blob/main/src/main/java/com/jmhreif/vectordb_data_load/ReviewController.java#L33 target=_blank rel=noopener><code>/json-limit1</code></a> and <a href=https://github.com/JMHReif/vectordb-data-load/blob/main/src/main/java/com/jmhreif/vectordb_data_load/ReviewController.java#L42 target=_blank rel=noopener><code>/json-limit3</code></a> endpoints in the code repo’s <code>ReviewController</code> class. I tested a few different formats before figuring out what worked and why.</p></div><div class=paragraph><p>Here is how I ended up reading the JSON lines in Java (<a href=https://github.com/JMHReif/vectordb-data-load/blob/main/src/main/java/com/jmhreif/vectordb_data_load/ReviewController.java#L50 target=_blank rel=noopener><code>/load</code> endpoint</a>):</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@GetMapping(&#34;/load&#34;)
public String load() throws IOException {
    BufferedReader br = new BufferedReader(
        new InputStreamReader(
            new ClassPathResource(&#34;goodreads-reviews-demo.json&#34;)
                .getInputStream()));

    String currentLine;
    List&lt;Document&gt; documents = new ArrayList&lt;&gt;();

    while ((currentLine = br.readLine()) != null) {
        Review review = objectMapper
            .readValue(currentLine, Review.class);

        if (review.text() != null) {
            //decide which keys are the metadata
            //add review to list of documents
        }
    }
    br.close();
    //upsert to Pinecone
    return &#34;Documents read&#34;;
}</code></pre></div></div><div class=paragraph><p>With the JSON format understood and readable in the Spring Boot app, I could move on to manipulating the data into the format I needed to upsert to Pinecone!</p></div></div></div><div class=sect1><h2 id=_issue_4_loading_data_to_pinecone>Issue #4: Loading data to Pinecone</h2><div class=sectionbody><div class=paragraph><p>There were a couple of puzzles to solve for this part. 1. Determining how the JSON should map to data for Pinecone. 2. Figuring out how to split and batch such a large amount of data. 3. Adjusting configuration for longer timeout.</p></div><div class=paragraph><p>For this section, the <a href=https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html target=_blank rel=noopener>ETL pipeline page of the Spring AI documentation</a> was super helpful in understanding what I needed and what it should look like.</p></div><div class=sect2><h3 id=_1_metadata_keys>1. Metadata keys</h3><div class=paragraph><p>Vector databases were new, and I knew that they optimize for the vector embedding plus a bit of metadata (in key/value pairs). I had to decide which keys in the JSON should be metadata and which were irrelevant for my use case.</p></div><div class=paragraph><p>Because I want embeddings for the review text, I need the text value. Any other values need to be nested into a <code>metadata</code> key. Since the embedding is on the reviews but my use case is book recommendations (input of reviews, output of books), I need the <code>book_id</code> to know which book to recommend, and <code>rating</code> could also be helpful for filtering out low-rated books. The <code>book_id</code> and <code>rating</code> values are what will be the nested map for metadata.</p></div><div class=paragraph><p>I ended up with the following data mapping as a list of documents:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@GetMapping(&#34;/load&#34;)
public String load() throws IOException {
    //reader code
    List&lt;Document&gt; documents = new ArrayList&lt;&gt;();

    while ((currentLine = br.readLine()) != null) {
        Review review = objectMapper.readValue(currentLine, Review.class);

        if (review.text() != null) {
            documents.add(new Document(review.text(),
                        Map.of(&#34;book_id&#34;, review.book_id(),
                            &#34;rating&#34;, review.rating())));
        }
    }
    br.close();
    //upsert to Pinecone
    return &#34;Documents read&#34;;
}</code></pre></div></div><div class=paragraph><p>Next, I needed to upsert the documents to Pinecone. I started by just trying to upload as-is, but quickly figured out that some of the reviews were too long and needed to be split up (text larger than context window of embedding model).</p></div><div class=paragraph><p>Thankfully, there were several examples of this, though I had add batching because I have so many reviews being loaded (almost 70k)!</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@GetMapping(&#34;/load&#34;)
public String load() throws IOException {
    //code to read and format documents
    br.close();

    TokenTextSplitter tokenTextSplitter = new TokenTextSplitter();
    List&lt;Document&gt; splitDocuments = tokenTextSplitter.apply(documents);

    int batchSize = 100;
    List&lt;List&lt;Document&gt;&gt; batches = Lists.partition(
            splitDocuments, batchSize);
    int i = 1;
    for (List&lt;Document&gt; batch : batches) {
        vectorStore.add(batch);
        System.out.println(&#34;Batch &#34; + i + &#34; of &#34; + batches.size());
        i++;
    }
    return &#34;Documents loaded&#34;;
}</code></pre></div></div><div class=paragraph><p>I fired up the application, and it started processing, but errored out close to the end. *sigh* After some digging, I found that the default timeout for Pinecone is 30 seconds, and I probably exceeded that. I modified a <a href=https://github.com/JMHReif/vectordb-data-load/blob/main/src/main/resources/application.properties#L10 target=_blank rel=noopener>property in the <code>application.properties</code> file</a> to increase the timeout to 60 seconds, and that did the trick.</p></div><div class=paragraph><p>Running again took a bit of time, but completed successfully, and I was able to check the Pinecone console to see that the data was loaded!</p></div></div></div></div><div class=sect1><h2 id=_alternative_embeddings_book_descriptions>Alternative embeddings - Book descriptions</h2><div class=sectionbody><div class=paragraph><p>I also toyed with loading the book descriptions as a separate index (see <a href=https://github.com/JMHReif/vectordb-data-load/blob/main/src/main/java/com/jmhreif/vectordb_data_load/BookController.java target=_blank rel=noopener><code>BookController</code> class</a>). I haven’t played with that in an application yet, but I did get the data loaded. I used the same process as above, but had to do a bit fancier mapping strategy because some of the <code>isbn</code> and <code>isbn13</code> values were null in the JSON file, and a regular map doesn’t allow nulls.</p></div><div class=paragraph><p>Here is the code I used to map the book JSON to Spring AI documents:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>Map metadata = Maps.newHashMap();

if (book.text() != null) {
    metadata.put(&#34;title&#34;, book.title());
    metadata.put(&#34;rating&#34;, book.average_rating());
    metadata.computeIfAbsent(&#34;isbn&#34;, k -&gt; book.isbn());
    metadata.computeIfAbsent(&#34;isbn13&#34;, k -&gt; book.isbn13());

    documents.add(new Document(book.title()+book.text(), metadata));
}</code></pre></div></div><div class=paragraph><p>The <a href=https://www.baeldung.com/java-map-putifabsent-computeifabsent target=_blank rel=noopener><code>computeIfAbsent</code> method</a> is a nice way to only add the key when the value is not null (when it exists).</p></div></div></div><div class=sect1><h2 id=_wrapping_up>Wrapping up!</h2><div class=sectionbody><div class=paragraph><p>The task to load some JSON data to Pinecone was much more arduous than I had anticipated, but I learned a lot along the way. I also realized that, no matter what database you choose, the data import steps can be complicated.</p></div><div class=paragraph><p>My ultimate solution was a Spring AI application that reads a JSON file, creates vector embeddings, and upserts data to Pinecone.</p></div><div class=paragraph><p>Happy coding!</p></div></div></div><div class=sect1><h2 id=_resources>Resources</h2><div class=sectionbody><div class=ulist><ul><li><p>Github repository: <a href=https://github.com/JMHReif/vectordb-data-load target=_blank rel=noopener>Accompanying code for this blog post</a></p></li><li><p>Documentation: <a href=https://docs.pinecone.io/reference/java-sdk target=_blank rel=noopener>Pinecone Java SDK</a></p></li><li><p>Guide: <a href=https://docs.pinecone.io/guides/data/upsert-data target=_blank rel=noopener>Pinecone upsert data</a></p></li><li><p>API Reference: <a href=https://docs.pinecone.io/reference/api/2025-01/data-plane/upsert_records target=_blank rel=noopener>Pinecone upsert text</a></p></li><li><p>Documentation: <a href=https://docs.spring.io/spring-ai/reference/api/vectordbs/pinecone.html#_configuration_properties target=_blank rel=noopener>Spring AI Pinecone configuration properties</a></p></li><li><p>Documentation: <a href=https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html target=_blank rel=noopener>Spring AI ETL pipeline</a></p></li></ul></div></div></div><ul class=pa0><li class="list di"><a href=/tags/rag/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">rag</a></li><li class="list di"><a href=/tags/vector/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">vector</a></li><li class="list di"><a href=/tags/data/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">data</a></li><li class="list di"><a href=/tags/learning/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">learning</a></li><li class="list di"><a href=/tags/genai/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">genai</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/blog/2024/spring-ai-update-10/>Spring AI Upgrade: Changes for Applications from 0.8 to 1.0</a></li><li class=mb2><a href=/blog/2024/spring-ai-starter-kit/>GenAI Starter Kit: Everything You Need to Build an Application with Spring AI in Java</a></li><li class=mb2><a href=/blog/2024/spring-ai-app/>Spring AI: How to Write GenAI Applications with Java</a></li><li class=mb2><a href=/blog/2024/rag-demo-retrieval/>Implementing RAG: How to write a graph retrieval query in LangChain</a></li><li class=mb2><a href=/blog/2022/data-cleaning-goodreads/>Data Tool Decision Tree: Reduce Data Cleaning Time</a></li><li class=mb2><a href=/blog/2021/docker-intel-to-m1/>What I Learned Going from Intel to Apple Silicon</a></li><li class=mb2><a href=/blog/2019/java-holds-its-own/>In the Language Wars, Java Holds Its Own</a></li></ul></div></aside></article></main><footer class="bg-dark-green bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://jmhreif.com/>&copy; Jennifer Reif 2025</a><div><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank rel=noopener class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank rel=noopener class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank rel=noopener class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank rel=noopener class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.podbean.com/ target=_blank rel=noopener class="podcast ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="podcast link" aria-label="follow on podcast——Opens in a new window"><span class=icon><svg width="1200pt" height="1200pt" viewBox="0 0 1200 1200" xmlns="http://www.w3.org/2000/svg"><path d="m6e2 62.484c-296.48.0-537.52 241.03-537.52 537.52s240.98 537.52 537.52 537.52c296.48.0 537.52-240.98 537.52-537.52.0-296.48-241.03-537.52-537.52-537.52zm-155.02 305.02c0-85.5 69.516-155.02 155.02-155.02S755.02 282 755.02 367.504v234.98c0 85.5-69.516 155.02-155.02 155.02s-155.02-69.516-155.02-155.02zm192.52 516.52v66c0 20.484-17.016 37.5-37.5 37.5s-37.5-17.016-37.5-37.5v-66C408 865.508 288 734.024 288 574.504c0-20.484 17.016-37.5 37.5-37.5s37.5 17.016 37.5 37.5c0 130.5 106.5 237 237 237s237-106.5 237-237c0-20.484 17.016-37.5 37.5-37.5s37.5 17.016 37.5 37.5c0 159.52-120 291-274.5 309.52z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>