<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Journeys in Java, Level 7: Externalize Microservice Configuration | Jennifer Reif</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Photo credit Our decided next step for this project takes us in a new direction by adding externalized configuration for our applications. We already saw how to do something similar with MongoDB database credentials in Docker Compose to access a local database container, but what do we do when the database is hosted on public cloud or contains sensitive data? We probably don’t want to publish our credentials anywhere or even prevent accidental publishing."><meta name=generator content="Hugo 0.119.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="Journeys in Java, Level 7: Externalize Microservice Configuration"><meta property="og:description" content="Photo credit Our decided next step for this project takes us in a new direction by adding externalized configuration for our applications. We already saw how to do something similar with MongoDB database credentials in Docker Compose to access a local database container, but what do we do when the database is hosted on public cloud or contains sensitive data? We probably don’t want to publish our credentials anywhere or even prevent accidental publishing."><meta property="og:type" content="article"><meta property="og:url" content="https://jmhreif.com/blog/microservices-level7/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-07-14T09:00:00-06:00"><meta property="article:modified_time" content="2022-07-14T09:00:00-06:00"><meta itemprop=name content="Journeys in Java, Level 7: Externalize Microservice Configuration"><meta itemprop=description content="Photo credit Our decided next step for this project takes us in a new direction by adding externalized configuration for our applications. We already saw how to do something similar with MongoDB database credentials in Docker Compose to access a local database container, but what do we do when the database is hosted on public cloud or contains sensitive data? We probably don’t want to publish our credentials anywhere or even prevent accidental publishing."><meta itemprop=datePublished content="2022-07-14T09:00:00-06:00"><meta itemprop=dateModified content="2022-07-14T09:00:00-06:00"><meta itemprop=wordCount content="1909"><meta itemprop=keywords content="java,microservices,applications,development,spring-boot,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Journeys in Java, Level 7: Externalize Microservice Configuration"><meta name=twitter:description content="Photo credit Our decided next step for this project takes us in a new direction by adding externalized configuration for our applications. We already saw how to do something similar with MongoDB database credentials in Docker Compose to access a local database container, but what do we do when the database is hosted on public cloud or contains sensitive data? We probably don’t want to publish our credentials anywhere or even prevent accidental publishing."></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://jmhreif.com/img/microservices-lvl7/unsplash-canyon-road-bridge.jpeg)><div class="pb3-m pb6-l bg-black-60"><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Jennifer Reif</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/ title="Home page">Home</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blog/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/abstracts/ title="Abstracts page">Abstracts</a></li></ul><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">BLOG</aside><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/share?url=https://jmhreif.com/blog/microservices-level7/&amp;text=Journeys%20in%20Java,%20Level%207:%20Externalize%20Microservice%20Configuration" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://jmhreif.com/blog/microservices-level7/&amp;title=Journeys%20in%20Java,%20Level%207:%20Externalize%20Microservice%20Configuration" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div><h1 class="f1 athelas mt3 mb1">Journeys in Java, Level 7: Externalize Microservice Configuration</h1><time class="f6 mv4 dib tracked" datetime=2022-07-14T09:00:00-06:00>July 14, 2022</time>
<span class="f6 mv4 dib tracked">- 9 minutes read</span>
<span class="f6 mv4 dib tracked">- 1909 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><div class=paragraph><small><i><a href="https://unsplash.com/photos/Hp5Acad1H0k?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditShareLink">Photo credit</a></i></small></div><div class=paragraph><p>Our decided next step for this project takes us in a new direction by adding externalized configuration for our applications. We already saw how to do something similar with <a href=https://jmhreif.com/blog/microservices-level5/ target=_blank rel=noopener>MongoDB database credentials in Docker Compose</a> to access a local database container, but what do we do when the database is hosted on public cloud or contains sensitive data? We probably don’t want to publish our credentials anywhere or even prevent accidental publishing.</p></div><div class=paragraph><p>This is where solutions such as <a href=https://spring.io/projects/spring-cloud-config target=_blank rel=noopener>Spring Cloud Config</a> come into play. Our <a href=https://dev.neo4j.com/aura-java target=_blank rel=noopener>Neo4j database free instance</a> is hosted by Neo4j on a public cloud, so we can set the credentials in an external location (such as a local file or other system) use Spring Cloud Config to access those keys and pass them to the approved application.</p></div><div class=paragraph><p>In this article, we will walk through how to set up a service that hosts the Spring Cloud Config server and how to wire our existing Neo4j microservice (service4) as the config client service to utilize the credentials for accessing Neo4j.</p></div><div class=paragraph><p>Let’s dive in!</p></div><div class=sect1><h2 id=_architecture>Architecture</h2><div class=sectionbody><div class=paragraph><p>We began this microservices project with minimum functionality explained in the <a href=https://jmhreif.com/blog/microservices-level1/ target=_blank rel=noopener>level 1 blog post</a>. In our last post (<a href=https://jmhreif.com/blog/microservices-level6/ target=_blank rel=noopener>level6</a>), we added a graph database to our microservices system to take advantage of data relationships between books, authors, and reviews.</p></div><div class=paragraph><p>With today’s next step, we will add a new service to host managing the credentials and incorporate pulling credentials from there into our Neo4j service.</p></div><div class=paragraph><p>Here is the updated architecture:</p></div><div class=imageblock><div class=content><img src=/img/microservices-lvl7/microservices-level7.png alt="microservices level7"></div></div><div class=paragraph><p>We haven’t incorporated our Neo4j service to the rest of our Docker Compose system of services because I felt that the configuration was the next logical step to avoid hard-coding database credentials in our application or compose file. The eventual goal is to add the MongoDB database credentials to Spring Cloud Config, as well, and remove all hard-coded credentials from the applications and Docker Compose.</p></div><div class=paragraph><p>Until then, our intermediary step is to add the <code>config-server</code> service and plug that into our existing <code>service4</code> that connects to Neo4j.</p></div></div></div><div class=sect1><h2 id=_spring_cloud_config>Spring Cloud Config</h2><div class=sectionbody><div class=paragraph><p>The <a href=https://spring.io/projects/spring-cloud-config target=_blank rel=noopener>project overview for Spring Cloud Config</a> has a good explanation of design and usage, but I’ll briefly put it into my own words here.</p></div><div class=paragraph><p>Spring Cloud Config gives us a way to externalize configuration, so that individual services can access only the properties they need to operate. Through a config server, we can set up varying environments so that credentials are organized and managed without manipulating values for testing. The project (by default) is set to use Git for the version-controlled properties files, but it can be set up to use other tools or implementations for managing environments and values.</p></div><div class=paragraph><p>Without further ado, let’s start coding!</p></div></div></div><div class=sect1><h2 id=_applications_spring_cloud_config_server>Applications - Spring Cloud Config Server</h2><div class=sectionbody><div class=paragraph><p>As we have done with our previous services, we will use the Spring Initializr at <a href=https://start.spring.io/ target=_blank rel=noopener>start.spring.io</a> to set up the outline for our config server application.</p></div><div class=paragraph><p>On the form, we can leave <code>Project</code>, <code>Language</code>, and <code>Spring Boot</code> version fields defaulted. Under the <code>Project Metadata</code> section, I updated the group name for my personal projects, but you are welcome to leave it defaulted. I named the artifact <code>config-server</code>, though naming is up to you, as long as we map it properly where needed. All other fields in this section can remain as they are. Under the <code>Dependencies</code> section, we need only <code>Config Server (Spring Cloud Config)</code>. Finally, the project template is complete, and we can click the <code>Generate</code> button at the bottom to download the project.</p></div><div class=imageblock><div class=content><img src=/img/microservices-lvl7/springio-configserver.png alt="springio configserver"></div></div><div class=paragraph><p><em>Note: the Spring Initializr displays in dark mode or light mode via the moon or sun icons in the right column of the page.</em></p></div><div class=paragraph><p>Generating will download the project as a zip, so we can unzip it and move it to our project folder with the other services. Open the project in your favorite IDE and let’s get coding!</p></div><div class=paragraph><p>The <code>pom.xml</code> contains the dependencies and software versions we set up on the Spring Initializr, so we can move to the <code>application.properties</code> file in the <code>src/main/resources</code> folder.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-text data-lang=text>server.port=8888
spring.cloud.config.server.git.uri=${HOME}/Projects/config/microservices-java-config</code></pre></div></div><div class=paragraph><p>Just like with our other services, we need to specify a port number for this application to use so that its traffic doesn’t conflict with our other services. The default port for Spring Cloud Config server is <code>8888</code>, so we will use that. Next, we will use <a href=https://git-scm.com/ target=_blank rel=noopener>git</a> to version-track our local configuration file, so we need to specify the folder (or public repository URL, if we had that instead) as the value for the second property.</p></div><div class=paragraph><p>On to the project code!</p></div><div class=sect2><h3 id=_config_server_project_code>Config Server - project code</h3><div class=paragraph><p>There is very little we need to add, since we are using the default setup. We don’t have any big customizations or features required for now. So, there is only one small annotation we need to add to the <code>ConfigServerApplication.java</code> class.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@SpringBootApplication
@EnableConfigServer
public class ConfigServerApplication {

	public static void main(String[] args) {
		SpringApplication.run(ConfigServerApplication.class, args);
	}

}</code></pre></div></div><div class=paragraph><p>The <code>@EnableConfigServer</code> annotation notifies Spring that this application needs to operate as the config server.</p></div><div class=paragraph><p>Now we need to add our configuration file that will contain the database credentials!</p></div></div></div></div><div class=sect1><h2 id=_storing_config_values>Storing config values</h2><div class=sectionbody><div class=paragraph><p>We need an externalized place for our configuration values to reside, i.e. a file with our database credentials for config server to retrieve. Most of the tutorials you find on Spring Cloud Config recommend starting with a local config folder containing either a <code>.properties</code> or <code>.yaml</code> file. I went with the YAML file for this project.</p></div><div class=paragraph><p>A sample of the file is in the <code>microservices-java-config</code> folder of the <a href=https://github.com/JMHReif/microservices-level7 target=_blank rel=noopener>Github project</a>.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-text data-lang=text>spring:
  neo4j:
    uri: &lt;insert Neo4j URI here&gt;
    database: &lt;insert Neo4j database here&gt;
    authentication:
      username: &lt;insert Neo4j username here&gt;
      password: &lt;insert Neo4j password here&gt;</code></pre></div></div><div class=paragraph><p>We will need to fill in the values for our Neo4j AuraDB free instance in place of the dummy URL, database, username, and password shown above. <strong>Note:</strong> Database should be <code>neo4j</code>, unless you have specifically used commands to change the default. Then, we need to save the file and check it into to <a href=https://git-scm.com/ target=_blank rel=noopener>git</a> by running the next statements from the command line.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-shell data-lang=shell>microservices-java-config % git init
microservices-java-config % git add
microservices-java-config % git commit -am &#34;Initial commit&#34;</code></pre></div></div><div class=paragraph><p>Let’s test our config server application!</p></div></div></div><div class=sect1><h2 id=_test_config_server>Test Config Server</h2><div class=sectionbody><div class=paragraph><p>Start the application from your IDE or command line. To test, we need to figure out the correct URL to ping. First, we are running the application locally and set the port to <code>8888</code>, so the first part of the URL is <code>localhost:8888</code>. The rest of the URL is what confused me in most of the tutorials, but once you know what the application is looking for, it isn’t as intimidating.</p></div><div class=paragraph><p>Many tutorials use the <code>/{application}/{profile}</code> notation. The <code>/{application}</code> piece references the name you give your <em>client</em> application. This is an arbitrary name, except that your config file (in our case, yaml) needs to have the same name. Config file naming follows the pattern <code>{application}-{profile}</code>. If you do not specify a <code>-{profile}</code> (e.g. development, production) on the config file name, it uses the <em>default</em> profile.</p></div><div class=paragraph><p>Since our config file is named <code>neo4j-client.yaml</code>, our application name is <code>neo4j-client</code>. We do not specify a profile on our config file name, so it will use the default. This means the <code>/{profile}</code> piece of the URL is <code>default</code>.</p></div><div class=paragraph><p>Our full URL for testing is then <code>localhost:8888/neo4j-client/default</code>!</p></div><div class=paragraph><div class=title>Results</div><p><span class=image><img src=/img/microservices-lvl7/config-server-test.png alt="config server test"></span></p></div><div class=paragraph><p>Next, we need to plug our client service (<code>service4</code>) in to use the config server we just set up.</p></div></div></div><div class=sect1><h2 id=_service4_modifications>Service4 - modifications</h2><div class=sectionbody><div class=paragraph><p>To start, we need to add a dependency to <code>service4</code> for the Spring Cloud Config client. Open the <code>pom.xml</code> and add the following items:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-xml data-lang=xml>&lt;properties&gt;
	//java version property
	&lt;spring-cloud.version&gt;2021.0.3&lt;/spring-cloud.version&gt;
&lt;/properties&gt;
&lt;dependencies&gt;
	//other dependencies
	&lt;dependency&gt;
		&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
		&lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;
	&lt;/dependency&gt;
&lt;/dependencies&gt;
&lt;dependencyManagement&gt;
	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
			&lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
			&lt;version&gt;${spring-cloud.version}&lt;/version&gt;
			&lt;type&gt;pom&lt;/type&gt;
			&lt;scope&gt;import&lt;/scope&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</code></pre></div></div><div class=paragraph><p>On the <a href=https://github.com/JMHReif/microservices-level7/blob/main/service4/pom.xml#L18 target=_blank rel=noopener>third line of the above code</a>, we add a property for the Spring Cloud Version. This allows us to source this value anywhere it’s needed in the pom. In the dependencies section, we need to add the config client dependency (<a href=https://github.com/JMHReif/microservices-level7/blob/main/service4/pom.xml#L34 target=_blank rel=noopener>seventh line</a>), making this application a client that will use the config server. Last, but not least, we add a dependency management section (<a href=https://github.com/JMHReif/microservices-level7/blob/main/service4/pom.xml#L50 target=_blank rel=noopener>line twelve</a>) to handle versioning of Spring Cloud.</p></div><div class=paragraph><p>Now we need to update the application properties in the <code>src/main/resources</code> folder.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-text data-lang=text>server.port=8083

spring.application.name=neo4j-client
spring.config.import=configserver:http://localhost:8888/</code></pre></div></div><div class=paragraph><p>We leave the port property alone, but we can remove the database credential properties because those are being stored in the config server now. The next two properties specify the application name and where the config server is running. Remember that our application name and the name of our config file MUST match. So, that means our <code>spring.application.name</code> needs to be <code>neo4j-client</code>, as our config file name is <code>neo4j-client.yaml</code>. This is also the name that would be referenced between microservices or for service discovery, though we haven’t delved into that part of microservices yet. ;) Our config server is running locally and on the default config server port, so the value of the last property should look familiar.</p></div><div class=paragraph><p>This actually wraps up all of our changes to the Neo4j service! We don’t need to change anything in the <code>Service4Application.java</code> class because all of our config values are injected as part of the environment, so everything operates in the background.</p></div><div class=paragraph><p>Let’s test it!</p></div></div></div><div class=sect1><h2 id=_put_it_to_the_test>Put it to the test</h2><div class=sectionbody><div class=paragraph><p>As always, we will kick things off from the bottom to the top. First, ensure the Neo4j AuraDB instance is still running. <em>*Note:* AuraDB free tier pauses automatically after 3 days. You can resume with the <code>play</code> icon on the instance.</em></p></div><div class=paragraph><p>Next, we need to start our <code>config-server</code> application, either through the IDE or command line. Once that is running, we can start the <code>service4</code> application through the IDE or command line. Time to test the application using the following commands.</p></div><div class="olist arabic"><ol class=arabic><li><p>Test config server is working: open a browser and go to <code>localhost:8888/neo4j-client/default</code> or go to command line with <code>curl localhost:8888/neo4j-client/default</code>.</p></li><li><p>Test <code>service4</code> is live: open a browser and go to <code>localhost:8083/neo</code> or go to command line with <code>curl localhost:8083/neo</code>.</p></li><li><p>Test backend reviews api: open a browser and go to <code>localhost:8083/neo/reviews</code> or go to command line with <code>curl localhost:8083/neo/reviews</code>.</p></li><li><p>Test reviews api for a certain book: open a browser and go to <code>localhost:8083/neo/reviews/178186</code> or go to command line with <code>curl localhost:8083/neo/178186</code>.</p></li></ol></div><div class=paragraph><p>And here is the resulting output from reviews api results!</p></div><div class=paragraph><div class=title>Find 1000 reviews</div><p><span class=image><img src=/img/microservices-lvl7/microservices-lvl7-results.png alt="microservices lvl7 results"></span></p></div><div class=paragraph><div class=title>Find reviews by book</div><p><span class=image><img src=/img/microservices-lvl7/microservices-lvl7-results-book.png alt="microservices lvl7 results book"></span></p></div></div></div><div class=sect1><h2 id=_wrapping_up>Wrapping up!</h2><div class=sectionbody><div class=paragraph><p>Today, we incorporated the Spring Cloud Config project to manage and provide database credentials to our Neo4j microservice. We created a new service to host the config server and set up an external YAML file containing our database credentials. We saw how to test those pieces and verify the config server was working before moving on to plug in our <code>service4</code> application as the client to use the values provided by the config server. The client service didn’t require too many code changes to do this, and then we tested those components (config server, config file, Neo4j microservice) together to ensure we could access our review data as expected.</p></div><div class=paragraph><p>There are still a few things that we can do on this topic. It would be nice to add our MongoDB credentials to the Spring Cloud Config server, as well, and remove the hard-coded values from Docker Compose. We also need to incorporate the Neo4j microservice and config service with the rest of our group in Docker Compose. Happy coding!</p></div></div></div><div class=sect1><h2 id=_resources>Resources</h2><div class=sectionbody><div class=ulist><ul><li><p>Github: <a href=https://github.com/JMHReif/microservices-level7 target=_blank rel=noopener>microservices-level7</a> repository</p></li><li><p>Github: <a href=https://github.com/JMHReif/microservices-java target=_blank rel=noopener>Meta repository for all related content</a></p></li><li><p>Neo4j AuraDB: <a href=https://dev.neo4j.com/aura-java target=_blank rel=noopener>Create a FREE database</a></p></li><li><p>Documentation: <a href=https://docs.spring.io/spring-cloud-config/docs/current/reference/html/ target=_blank rel=noopener>Spring Cloud Config</a></p></li><li><p>Blog post: <a href=https://www.baeldung.com/spring-cloud-configuration target=_blank rel=noopener>Baeldung’s guide to Spring Cloud Config</a></p></li><li><p>Video: <a href="https://www.youtube.com/watch?v=gb1i4WyWNK4" target=_blank rel=noopener>JavaBrain’s walkthrough</a></p></li></ul></div></div></div><ul class=pa0><li class="list di"><a href=/tags/java class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">java</a></li><li class="list di"><a href=/tags/microservices class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">microservices</a></li><li class="list di"><a href=/tags/applications class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">applications</a></li><li class="list di"><a href=/tags/development class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">development</a></li><li class="list di"><a href=/tags/spring-boot class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">spring-boot</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/blog/microservices-level6/>Journeys in Java, Level 6: Build a Microservice with Neo4j</a></li><li class=mb2><a href=/blog/microservices-level5/>Journeys in Java, Level 5: Manage Microservices with Docker Compose</a></li><li class=mb2><a href=/blog/microservices-level4/>Journeys in Java, Level 4: Building an Empire of Microservices</a></li><li class=mb2><a href=/blog/microservices-level3/>Journeys in Java, Level 3: Building an Empire of Microservices</a></li><li class=mb2><a href=/blog/microservices-level2/>Journeys in Java, Level 2: Building an Empire of Microservices</a></li><li class=mb2><a href=/blog/microservices-level1/>Journeys in Java, Level 1: Building an Empire of Microservices</a></li><li class=mb2><a href=/blog/migrate-sdn-part3/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 3</a></li><li class=mb2><a href=/blog/migrate-sdn-part2/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 2</a></li><li class=mb2><a href=/blog/migrate-sdn-part1/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 1</a></li><li class=mb2><a href=/blog/create-data-marvel-sdn/>Create a Data Marvel with Spring Data Neo4j</a></li><li class=mb2><a href=/blog/java17-graph-explore/>Java 17: Explore the newly-released Java version in a graph database!</a></li><li class=mb2><a href=/blog/java-holds-its-own/>In the Language Wars, Java Holds Its Own</a></li></ul></div></aside></article></main><footer class="bg-dark-green bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://jmhreif.com/>&copy; Jennifer Reif 2024</a><div><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>