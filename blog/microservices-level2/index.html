<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Journeys in Java, Level 2: Building an Empire of Microservices | Jennifer Reif</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Photo credit  In my last blog post, we began building microservices in Java with two Spring Boot applications, passing a &#34;Hello, World!&#34; string from one application to the other. We focused on reduced complexity, minimum previous knowledge, and few components. Next, we can slowly add pieces that simulate microservices projects in the real world.
 One way to do this is by adding a data domain. Applications often model some scenario in the real world such as maintaining office building temperatures, finding connected devices on a network, or recommending a tv show."><meta name=generator content="Hugo 0.85.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="Journeys in Java, Level 2: Building an Empire of Microservices"><meta property="og:description" content="Photo credit  In my last blog post, we began building microservices in Java with two Spring Boot applications, passing a &#34;Hello, World!&#34; string from one application to the other. We focused on reduced complexity, minimum previous knowledge, and few components. Next, we can slowly add pieces that simulate microservices projects in the real world.
 One way to do this is by adding a data domain. Applications often model some scenario in the real world such as maintaining office building temperatures, finding connected devices on a network, or recommending a tv show."><meta property="og:type" content="article"><meta property="og:url" content="https://jmhreif.com/blog/microservices-level2/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-01-27T09:00:00-06:00"><meta property="article:modified_time" content="2022-01-27T09:00:00-06:00"><meta itemprop=name content="Journeys in Java, Level 2: Building an Empire of Microservices"><meta itemprop=description content="Photo credit  In my last blog post, we began building microservices in Java with two Spring Boot applications, passing a &#34;Hello, World!&#34; string from one application to the other. We focused on reduced complexity, minimum previous knowledge, and few components. Next, we can slowly add pieces that simulate microservices projects in the real world.
 One way to do this is by adding a data domain. Applications often model some scenario in the real world such as maintaining office building temperatures, finding connected devices on a network, or recommending a tv show."><meta itemprop=datePublished content="2022-01-27T09:00:00-06:00"><meta itemprop=dateModified content="2022-01-27T09:00:00-06:00"><meta itemprop=wordCount content="2121"><meta itemprop=keywords content="java,microservices,applications,development,spring-boot,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Journeys in Java, Level 2: Building an Empire of Microservices"><meta name=twitter:description content="Photo credit  In my last blog post, we began building microservices in Java with two Spring Boot applications, passing a &#34;Hello, World!&#34; string from one application to the other. We focused on reduced complexity, minimum previous knowledge, and few components. Next, we can slowly add pieces that simulate microservices projects in the real world.
 One way to do this is by adding a data domain. Applications often model some scenario in the real world such as maintaining office building temperatures, finding connected devices on a network, or recommending a tv show."></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://jmhreif.com/img/microservices-lvl2/unsplash-small-bridge.jpeg)><div class="pb3-m pb6-l bg-black-60"><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Jennifer Reif</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/ title="Home page">Home</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blog/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/abstracts/ title="Abstracts page">Abstracts</a></li></ul><a href=https://twitter.com/JMHReif target=_blank class="link-transition twitter link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/JMHReif target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank class="link-transition rss link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="RSS——Opens in a new window"><svg xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">BLOG</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=https://jmhreif.com/blog/microservices-level2/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=https://jmhreif.com/blog/microservices-level2/&text=Journeys%20in%20Java,%20Level%202:%20Building%20an%20Empire%20of%20Microservices" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://jmhreif.com/blog/microservices-level2/&title=Journeys%20in%20Java,%20Level%202:%20Building%20an%20Empire%20of%20Microservices" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">Journeys in Java, Level 2: Building an Empire of Microservices</h1><time class="f6 mv4 dib tracked" datetime=2022-01-27T09:00:00-06:00>January 27, 2022</time>
<span class="f6 mv4 dib tracked">- 10 minutes read</span>
<span class="f6 mv4 dib tracked">- 2121 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><div class=paragraph><small><i><a href="https://unsplash.com/photos/LjesOs00QRg?utm_source=unsplash&utm_medium=referral&utm_content=creditShareLink">Photo credit</a></i></small></div><div class=paragraph><p>In my <a href=https://jmhreif.com/blog/microservices-level1/ target=_blank rel=noopener>last blog post</a>, we began building microservices in Java with two Spring Boot applications, passing a "Hello, World!" string from one application to the other. We focused on reduced complexity, minimum previous knowledge, and few components. Next, we can slowly add pieces that simulate microservices projects in the real world.</p></div><div class=paragraph><p>One way to do this is by adding a data domain. Applications often model some scenario in the real world such as maintaining office building temperatures, finding connected devices on a network, or recommending a tv show. All of these need developers to create models of the environment - buildings and standard conditions; networks and connected devices; show preferences and recommendations. Models of the same domain can differ due to varying requirements.</p></div><div class=paragraph><p>While microservices systems vary greatly in size, technologies, etc., data can be found at the center of nearly all of them.</p></div><div class=sect1><h2 id=_architecture>Architecture</h2><div class=sectionbody><div class=paragraph><p>Our goal is still to create microservices that communicate and pass information without intervention. These blog posts will take us from the beginning to that goal stage in a (hopefully) understandable way. In our last post, we connected two Spring Boot applications communicating via a REST endpoint using the analogy of a bridge connecting two bits of land.</p></div><div class=paragraph><p>Today’s architecture is almost the same, but adding a data domain of books. So we now have a slightly more ornate bridge over water. :)</p></div><div class=paragraph><p>Our architecture diagram will look like the following:</p></div><div class=imageblock><div class=content><img src=/img/microservices-lvl2/microservices-level2.png alt="microservices level2"></div></div><div class=paragraph><p>There are all kinds of data sets we could use, but a few things led me to use books. 1. a book domain is relatable across a wide audience - no specialized knowledge required. 2. there were existing data sets that could be expanded with additional books. 3. many different services could be built for the domain (i.e. purchases, reviews, recommendations, media, and more).</p></div><div class=paragraph><p>Now let’s add some books! If you are following along from the previous blog post, feel free to start with the <a href=https://github.com/JMHReif/microservices-level1 target=_blank rel=noopener>microservices-level1</a> version of the code and make modifications as we discuss them below. If you are starting from this blog post, you can either start fresh with today’s <a href=https://github.com/JMHReif/microservices-level2 target=_blank rel=noopener>level2 code</a> or start from the <a href=https://github.com/JMHReif/microservices-level1 target=_blank rel=noopener>level1 code</a>.</p></div></div></div><div class=sect1><h2 id=_applications_service_1>Applications - Service 1</h2><div class=sectionbody><div class=paragraph><p>Just as before, I like to work from the backend up (or out). Since we are dealing with data now, we will need some sort of datastore. There are too many options to fathom, but we can limit our choices.</p></div><div class=paragraph><p>First, Spring Data has a few integrations with databases that allow us to plug-and-play pretty quickly. This narrows our list to those on <a href=https://spring.io/projects/spring-data target=_blank rel=noopener>Spring Data’s page</a>. Second, we don’t need to add the complexity of spinning up a database instance and creating a separate service for our data store (yet). :) We will get there, but let’s start with an embedded database. An embedded database is created and populated when an application starts and gets shut down when the application terminates or shuts down.</p></div><div class=paragraph><p>There are still a few options, but the most popular is probably MongoDB. It offers an option for embedded (with a minor tweak), so we will use that.</p></div><div class=paragraph><p>We will need to add a couple of additional dependencies in order to create an embedded MongoDB instance and populate/interact with the data. The changes to the <code>pom.xml</code> project file are shown below, and the <a href=https://github.com/JMHReif/microservices-level2/blob/main/service1/pom.xml target=_blank rel=noopener>full file</a> is available on Github.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>&lt;dependency&gt;
   &lt;groupId&gt;de.flapdoodle.embed&lt;/groupId&gt;
   &lt;artifactId&gt;de.flapdoodle.embed.mongo&lt;/artifactId&gt;
   &lt;!-- &lt;scope&gt;test&lt;/scope&gt; --&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
   &lt;artifactId&gt;spring-boot-starter-data-mongodb-reactive&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre></div></div><div class=paragraph><p>Flapdoodle provides the embedded version of MongoDB, although only scoped for testing. We can tweak this by commenting out the scope, so that we can use embedded MongoDB instances for our whole application. Note, this is not recommended for production. ;)</p></div><div class=paragraph><p>Then, we need to include the Spring Data MongoDB starter, which allows us access to all the <a href=https://spring.io/projects/spring-data-mongodb target=_blank rel=noopener>goodies Spring Data offers with MongoDB</a> (annotations for entities, domain-specific language for custom queries, and more).</p></div><div class=sect2><h3 id=_service_1_project_code>Service 1 - project code</h3><div class=paragraph><p>I’ll keep all the code in the <code>Service1Application</code> file, since we don’t have too many lines yet. We will start at the bottom of the file with the <code>Book</code> entity that represents objects of our book data. As always, there is <a href=https://github.com/JMHReif/microservices-level2/blob/main/service1/src/main/java/com/jmhreif/service1/Service1Application.java target=_blank rel=noopener>full code on Github</a>.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@Data
@Document
class Book {
	@Id
	private String bookId;
	@NonNull
	private String title;
	@NonNull
	private String author;
}</code></pre></div></div><div class=paragraph><p>With Lombok in our dependencies, this class might look smaller than typical Java object classes. The <a href=https://projectlombok.org/features/Data target=_blank rel=noopener><code>@Data</code></a> annotation creates getter/setter methods, equals/hashcode/toString methods, and a constructor with required arguments. The <code>@Document</code> annotation tells Spring that this is a MongoDB entity class (data model uses document entities).</p></div><div class=paragraph><p>Next, we add a few entity variables (properties). A unique id helps us identify a particular book in the database, and the title and author are probably interesting fields. All three fields are <code>String</code> types. The first property (<code>bookId</code>) has an annotation of <code>@Id</code>, which tells Spring that this is the id field for our class. The <code>title</code> and <code>author</code> properties have a <code>@NonNull</code> annotation, which means that we don’t want these properties to be missing when we search for books or add new ones. Makes sense, as it’s hard to find a book without a title and/or author.</p></div><div class=paragraph><p>We also need to add a repository interface that allows us to define methods for interacting with the data (separate from specific implementation). That is in the next code block above our <code>Book</code> class.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>interface BookRepository extends ReactiveCrudRepository&lt;Book, String&gt; {
}</code></pre></div></div><div class=paragraph><p>We have entered very little code here because Spring Data provides a few implementations of common methods such as <code>findAll()</code>, <code>findById()</code>, and more. This is mentioned briefly in the <a href=https://docs.spring.io/spring-data/commons/docs/current/reference/html/#repositories.core-concepts target=_blank rel=noopener>related section</a> of the Spring Data Commons documentation. We are using the <code>ReactiveCrudRepository</code> because we want to use reactive methods and types for working with the data, requiring a different repository extension from a traditional <code>CrudRepository</code>.</p></div><div class=paragraph><p>Next, we need to tweak our controller class to work with <code>Book</code> objects, instead of the "Hello, World!" string we used last time.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@RestController
@AllArgsConstructor
@RequestMapping(&#34;/db&#34;)
class BookController {
	private final BookRepository bookRepository;

	@GetMapping(&#34;/books&#34;)
	Flux&lt;Book&gt; getBooks() { return bookRepository.findAll(); }
}</code></pre></div></div><div class=paragraph><p>Comparing against our <a href=https://github.com/JMHReif/microservices-level1/blob/main/service1/src/main/java/com/jmhreif/service1/Service1Application.java target=_blank rel=noopener>previous version’s controller class</a>, the name of the endpoint on line 3 changed from <code>/text</code> to <code>/db</code> to more clearly state our connection to a database and data. The name of the class (line 4) goes from <code>TextController</code> to <code>BookController</code> to align with the data we’re passing.</p></div><div class=paragraph><p>The first line inside the braces of the class injects the book repository, creating a <a href=https://www.baeldung.com/spring-bean target=_blank rel=noopener>Spring Bean</a> that we can use to access the methods provided in our <code>BookRepository</code> interface. Next, we need to adjust our method to return some books. While we don’t need to modify the mapping endpoint for the method, we can specify nested endpoints (under <code>/db</code>) by adding the value in the <code>GetMapping()</code> annotation. Here, we can access the <code>getBooks()</code> method with the <code>/db/books</code> path.</p></div><div class=paragraph><p>The next line implements our <code>getBooks()</code> method. Since we want to potentially return multiple books with reactive types, our method return type is <code>Flux&lt;Book></code>. Inside the method, we return results from accessing our <code>bookRepository</code> bean and calling its <code>findAll()</code> method.</p></div><div class=paragraph><p>Finally, we also need some data in our database to retrieve anything with our method above. An embedded database will spin up when the application starts and be destroyed when the application terminates. So, we need to populate the database each time the application starts. We could load in external data each time, but for simplicity/demo purposes, we will create a bean with hard-coded <code>Book</code> objects to save.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@Bean
CommandLineRunner clr(BookRepository repo) {
   return args -&gt; repo.deleteAll()
	   .thenMany(Flux.just(
		   new Book(&#34;The Lord of the Rings: The Return of the King&#34;, &#34;J.R.R. Tolkien&#34;),
		   new Book(&#34;Harry Potter and the Prisoner of Azkaban&#34;, &#34;J.K. Rowling&#34;),
		   new Book(&#34;Star Wars: The Truce at Bakura&#34;, &#34;Kathy Tyers&#34;),
		   new Book(&#34;The Phoenix Project&#34;, &#34;Gene Kim/Kevin Behr/George Spafford&#34;)))
	   .flatMap(repo::save)
	   .log()
	   .subscribe();
}</code></pre></div></div><div class=paragraph><p>A <a href=https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/CommandLineRunner.html target=_blank rel=noopener><code>CommandLineRunner</code></a> runs when the application starts, so this bean executes early in the startup. We pass our <code>BookRepository</code> into the method so we can access the methods to MongoDB data.</p></div><div class=paragraph><p>In the method body, we return the results of a <a href=https://www.javatpoint.com/java-lambda-expressions target=_blank rel=noopener>Lambda expression</a> - passing in arguments from the application context on the left side of the arrow and executing the statement on the right side of the arrow. It uses the repo’s provided method <code>deleteAll()</code> to ensure an empty database, then takes some defined <code>Book</code> objects (4 of my favorite books), flattens the multiple-object Flux to another Flux (<code>.flatMap()</code>), and saves that Flux of books in our database with another Lambda (<code>repo::save</code>) that calls the <code>save</code> method on the book repository.</p></div><div class=paragraph><p>We log all this to find any errors (<code>.log()</code>) and subscribe to put the publisher into action. In reactive programming, our code before the <code>.subscribe()</code> is like a bus sitting at a station, and subscribing moves the bus. Until <code>subscribe</code> is called, there is no action.</p></div><div class=paragraph><p>We can run the application now, though it only confirms data gets loaded via logging. This completes the backing service. Updating service2 will allow us to access the backend we just set up to ensure our services can still communicate.</p></div></div></div></div><div class=sect1><h2 id=_applications_service_2>Applications - Service 2</h2><div class=sectionbody><div class=paragraph><p>In service2, we don’t need to add any dependencies because we are not changing the functionality, only the data being passed. Our frontend service still sends a request and displays a response, and while the format of that data is different (books), the technologies to sending and receiving it isn’t.</p></div><div class=paragraph><p>That means no changes to our <code>pom.xml</code> file. On to the application class code!</p></div><div class=sect2><h3 id=_service_2_project_code>Service 2 - project code</h3><div class=paragraph><p>As in service1, we will start from the bottom of the <code>Service2Application.java</code> class and work our way up. First, we need to define our <code>Book</code> domain class again because we need the frontend application to recognize and map the same objects our backend service uses. However, the code is slightly different from our service1 <code>Book</code> class.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>class Book {
   private String bookId;
   private String title;
   private String author;
}</code></pre></div></div><div class=paragraph><p>Service2 does not interact directly with the database, so it only needs the domain class to ensure data being passed matches what our backend services expects and returns. We don’t need any of the annotations, since all four ensure data is mapped between application and database. Instead, we simply need our three properties defined for mapping object fields to books.</p></div><div class=paragraph><p>Moving on up, we need to make a couple of minor adjustments to the controller class that calls our backend endpoint.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@Component
@AllArgsConstructor
class BookController {
   private final WebClient client;

   Flux&lt;Book&gt; getBooks() {
	  return client.get()
		.uri(&#34;/db/books&#34;)
		.retrieve()
		.bodyToFlux(Book.class);
	}
}</code></pre></div></div><div class=paragraph><p>The first change is to the name of the class itself (from <code>TextController</code> to <code>BookController</code>) to align with our book domain. On <a href=https://github.com/JMHReif/microservices-level2/blob/main/service2/src/main/java/com/jmhreif/service2/Service2Application.java#L37 target=_blank rel=noopener>line 6</a> of the above code, we implement the <code>getBooks()</code> method. The name for the method also gets updated to match our book domain, and we need to use a different return type (from <code>Mono&lt;String></code> to <code>Flux&lt;Book></code>) because we are dealing with book objects instead of a string and expect multiple books instead of a single string return.</p></div><div class=paragraph><p>On the <a href=https://github.com/JMHReif/microservices-level2/blob/main/service2/src/main/java/com/jmhreif/service2/Service2Application.java#L39 target=_blank rel=noopener>eighth line of controller</a>, we need to update our endpoint URL path because we changed that in our backend service from <code>/text</code> to <code>/db/books</code>. Finally, the last line of the method (<a href=https://github.com/JMHReif/microservices-level2/blob/main/service2/src/main/java/com/jmhreif/service2/Service2Application.java#L41 target=_blank rel=noopener>controller line 10</a>) maps the return body to a <code>Flux</code> (one or more) of <code>Book</code> objects, rather than the <a href=https://github.com/JMHReif/microservices-level1/blob/main/service2/src/main/java/com/jmhreif/service2/Service2Application.java#L38 target=_blank rel=noopener>previous mapping to a Mono of String</a>.</p></div><div class=paragraph><p>None of the code in the <code>Service2Application</code> class needs to change, so now it’s time to test it out and see if it works!</p></div></div></div></div><div class=sect1><h2 id=_put_it_to_the_test>Put it to the test</h2><div class=sectionbody><div class=paragraph><p>Start each of the applications, either through your IDE or via the command line. Once both are running, open a browser and go to <code>localhost:8080/db/books</code>. Alternatively, you can run this at the command line with <code>curl localhost:8080/db/books</code> or (if you have <a href=https://httpie.io/ target=_blank rel=noopener>httpie</a> tool installed) <code>http :8080/db/books</code>.</p></div><div class=paragraph><p>And here is the resulting output!</p></div><div class=imageblock><div class=content><img src=/img/microservices-lvl2/microservices-lvl2-results.png alt="microservices lvl2 results"></div></div></div></div><div class=sect1><h2 id=_wrapping_up>Wrapping up!</h2><div class=sectionbody><div class=paragraph><p>Congratulations, we have taken the next step to add a data domain (with database) to our microservices project!</p></div><div class=paragraph><p>We kept our two individual Spring Boot applications that communicated over HTTP, but modified them to pass <code>Book</code> data, instead of a single string. Our backend service (service1) creates and populates an embedded MongoDB instance with some books, and our frontend service (service2) requests and returns those books. We successfully added a database layer (although embedded for now) and came a bit closer to real-world business cases with a data domain and storage.</p></div><div class=paragraph><p>Microservices are all about having multiple applications/technologies as services and getting them to communicate among one another. Of course, there is much more to a production-ready system, but we are on our way to building and understanding them one small step at a time.</p></div><div class=paragraph><p>Happy coding!</p></div></div></div><div class=sect1><h2 id=_resources>Resources</h2><div class=sectionbody><div class=ulist><ul><li><p>Github: <a href=https://github.com/JMHReif/microservices-level2 target=_blank rel=noopener>microservices-level2</a> repository</p></li><li><p>Documentation: <a href=https://spring.io/projects/spring-data-mongodb target=_blank rel=noopener>Spring Data MongoDB</a></p></li><li><p>Previous blog post: <a href=https://jmhreif.com/blog/microservices-level1/ target=_blank rel=noopener>Microservices Level 1</a></p></li><li><p>Document database: <a href=https://www.mongodb.com/ target=_blank rel=noopener>MongoDB product page</a></p></li></ul></div></div></div><ul class=pa0><li class=list><a href=/tags/java class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">java</a></li><li class=list><a href=/tags/microservices class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">microservices</a></li><li class=list><a href=/tags/applications class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">applications</a></li><li class=list><a href=/tags/development class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">development</a></li><li class=list><a href=/tags/spring-boot class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">spring-boot</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/blog/microservices-level1/>Journeys in Java, Level 1: Building an Empire of Microservices</a></li><li class=mb2><a href=/blog/migrate-sdn-part3/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 3</a></li><li class=mb2><a href=/blog/migrate-sdn-part2/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 2</a></li><li class=mb2><a href=/blog/migrate-sdn-part1/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 1</a></li><li class=mb2><a href=/blog/create-data-marvel-sdn/>Create a Data Marvel with Spring Data Neo4j</a></li><li class=mb2><a href=/blog/java17-graph-explore/>Java 17: Explore the newly-released Java version in a graph database!</a></li><li class=mb2><a href=/blog/java-holds-its-own/>In the Language Wars, Java Holds Its Own</a></li></ul></div></aside></article></main><footer class="bg-dark-green bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://jmhreif.com/>&copy; Jennifer Reif 2022</a><div><a href=https://twitter.com/JMHReif target=_blank class="link-transition twitter link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/JMHReif target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank class="link-transition rss link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="RSS——Opens in a new window"><svg xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></footer></body></html>