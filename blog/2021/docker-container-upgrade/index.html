<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Container Upgrade - Experiences Updating Three Databases | Jennifer Reif</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Photo credit *Updated Dec 16, 2021
I created a demo project a couple of years ago that included a lot of technical setup - containers, data import, queries, and such. I presented it for a conference or two, and while it was one of my favorite projects, it was a lot of preparation for the live demo.
I recently rediscovered the project, and submitted it to a couple of conferences."><meta name=generator content="Hugo 0.119.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><link rel=canonical href=https://jmhreif.com/blog/2021/docker-container-upgrade/><meta property="og:title" content="Container Upgrade - Experiences Updating Three Databases"><meta property="og:description" content="Photo credit *Updated Dec 16, 2021
I created a demo project a couple of years ago that included a lot of technical setup - containers, data import, queries, and such. I presented it for a conference or two, and while it was one of my favorite projects, it was a lot of preparation for the live demo.
I recently rediscovered the project, and submitted it to a couple of conferences."><meta property="og:type" content="article"><meta property="og:url" content="https://jmhreif.com/blog/2021/docker-container-upgrade/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-10-15T09:00:00-06:00"><meta property="article:modified_time" content="2021-10-15T09:00:00-06:00"><meta itemprop=name content="Container Upgrade - Experiences Updating Three Databases"><meta itemprop=description content="Photo credit *Updated Dec 16, 2021
I created a demo project a couple of years ago that included a lot of technical setup - containers, data import, queries, and such. I presented it for a conference or two, and while it was one of my favorite projects, it was a lot of preparation for the live demo.
I recently rediscovered the project, and submitted it to a couple of conferences."><meta itemprop=datePublished content="2021-10-15T09:00:00-06:00"><meta itemprop=dateModified content="2021-10-15T09:00:00-06:00"><meta itemprop=wordCount content="1998"><meta itemprop=keywords content="docker,neo4j,mongodb,mariadb,upgrade,container,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Container Upgrade - Experiences Updating Three Databases"><meta name=twitter:description content="Photo credit *Updated Dec 16, 2021
I created a demo project a couple of years ago that included a lot of technical setup - containers, data import, queries, and such. I presented it for a conference or two, and while it was one of my favorite projects, it was a lot of preparation for the live demo.
I recently rediscovered the project, and submitted it to a couple of conferences."></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://jmhreif.com/img/containers/unsplash-containers.jpeg)><div class=bg-black-60><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Jennifer Reif</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/ title="Home page">Home</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blog/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/abstracts/ title="Abstracts page">Abstracts</a></li></ul><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank rel=noopener class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" aria-label="follow on Twitterâ€”â€”Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank rel=noopener class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHubâ€”â€”Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank rel=noopener class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedInâ€”â€”Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank rel=noopener class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" aria-label="follow on RSSâ€”â€”Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.podbean.com/ target=_blank rel=noopener class="podcast ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="podcast link" aria-label="follow on podcastâ€”â€”Opens in a new window"><span class=icon><svg width="1200pt" height="1200pt" viewBox="0 0 1200 1200" xmlns="http://www.w3.org/2000/svg"><path d="m6e2 62.484c-296.48.0-537.52 241.03-537.52 537.52s240.98 537.52 537.52 537.52c296.48.0 537.52-240.98 537.52-537.52.0-296.48-241.03-537.52-537.52-537.52zm-155.02 305.02c0-85.5 69.516-155.02 155.02-155.02S755.02 282 755.02 367.504v234.98c0 85.5-69.516 155.02-155.02 155.02s-155.02-69.516-155.02-155.02zm192.52 516.52v66c0 20.484-17.016 37.5-37.5 37.5s-37.5-17.016-37.5-37.5v-66C408 865.508 288 734.024 288 574.504c0-20.484 17.016-37.5 37.5-37.5s37.5 17.016 37.5 37.5c0 130.5 106.5 237 237 237s237-106.5 237-237c0-20.484 17.016-37.5 37.5-37.5s37.5 17.016 37.5 37.5c0 159.52-120 291-274.5 309.52z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked ttu">Blog</aside><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/intent/tweet?url=https://jmhreif.com/blog/2021/docker-container-upgrade/&amp;text=Container%20Upgrade%20-%20Experiences%20Updating%20Three%20Databases" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://jmhreif.com/blog/2021/docker-container-upgrade/&amp;title=Container%20Upgrade%20-%20Experiences%20Updating%20Three%20Databases" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div><h1 class="f1 athelas mt3 mb1">Container Upgrade - Experiences Updating Three Databases</h1><time class="f6 mv4 dib tracked" datetime=2021-10-15T09:00:00-06:00>October 15, 2021</time>
<span class="f6 mv4 dib tracked">- 10 minutes read</span>
<span class="f6 mv4 dib tracked">- 1998 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><div class=paragraph><small><i><a href="https://unsplash.com/photos/tjX_sniNzgQ?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditShareLink">Photo credit</a></i></small></div><div class=paragraph><p><em>*Updated Dec 16, 2021</em></p></div><div class=paragraph><p>I created a demo project a couple of years ago that included a lot of technical setup - containers, data import, queries, and such. I presented it for a conference or two, and while it was one of my favorite projects, it was a lot of preparation for the live demo.</p></div><div class=paragraph><p>I recently rediscovered the project, and submitted it to a couple of conferences. It got accepted, so I needed to upgrade the versions of all the software. With so much setup in the project, I thought it would certainly be a giant undertaking. However, I was pleasantly surprised on several things, even though a few things tripped me up. This blog post will document things I learned along the way, so that hopefully, you donâ€™t run into the same road blocks I didâ€¦or at least, I might help you solve them faster. With that, letâ€™s jump in!</p></div><div class=sect1><h2 id=_project_background>Project background</h2><div class=sectionbody><div class=paragraph><p>First, a bit of background on what all is involved and what I was trying to accomplish with the project.</p></div><div class=paragraph><p>I wanted to showcase <a href=https://spring.io/projects/spring-data target=_blank rel=noopener>Spring Data</a> and the many integrations it offers. I chose integrations with key players in their respective database spaces - MariaDB (relational, open source MySQL), MongoDB (document, NoSQL), and Neo4j (graph, NoSQL). I would later import data and create applications for this, but that is outside the scope of this post.</p></div><div class=paragraph><p>Of course, live coding is a really powerful way to demonstrate any technology, which meant I needed something manageable (i.e. similar and repeatable) to spin up each environment and data. For this, I chose Docker containers. Each of the databases in question provided a container image on Docker Hub that I could use.</p></div><div class=paragraph><p>Now to the technical details.</p></div></div></div><div class=sect1><h2 id=_upgrading_the_containers>Upgrading the containers</h2><div class=sectionbody><div class=paragraph><p>One common change across all of my containers was that the syntax for defining an author in the Dockerfile had changed from a <code>MAINTAINER</code> wording to a <code>LABEL</code> term. You can see this in my commit from the <a href=https://github.com/JMHReif/docker-maria/commit/f430112ac974c351cd28656c52353c0aee95f1d5#diff-f34da55ca08f1a30591d8b0b3e885bcc678537b2a9a4aadea4f190806b374ddcR7 target=_blank rel=noopener>docker-maria</a> Github repository, and in similar commits for the <a href=https://github.com/JMHReif/docker-mongo/commit/16d3e80b4c7830116541e3cefeaa2c8e0f4eab68#diff-f34da55ca08f1a30591d8b0b3e885bcc678537b2a9a4aadea4f190806b374ddcR7 target=_blank rel=noopener>docker-mongo</a> and <a href=https://github.com/JMHReif/docker-neo4j/commit/2f895e55d70f501d683dc87f46a8521616c30615#diff-f34da55ca08f1a30591d8b0b3e885bcc678537b2a9a4aadea4f190806b374ddcR7 target=_blank rel=noopener>docker-neo4j</a> repositories. While I donâ€™t think this syntax feels as logical and clear to me, the old maintainer syntax is no longer supported by Docker, so this change was required.</p></div><div class=paragraph><p>Another difference to note is that my previous versions of these containers operated on the x86-64 architecture (my MacOS laptop, Intel chip); however, that laptop recently was replaced with one that has arm64 architecture (MacOS laptop, Apple silicon chip). Some containers support both architectures in the same image, but others do not - Iâ€™m looking at you, Neo4j. ðŸ˜… Iâ€™ll talk more about this with each image.</p></div><div class=paragraph><p><em>*Note(2021-12-16):* As of Neo4j version 4.4+, the Neo4j official DockerHub image supports both amd64 (Intel chip) and arm64 (Apple silicon chip) architectures (see OS/ARCH for each tag). If you are using Neo4j prior to v4.4, then you will need to use the neo4j/neo4j-arm64-experimental DockerHub repository.</em></p></div><div class=sect2><h3 id=_mariadb>MariaDB</h3><div class=paragraph><p>Outside of that change (plus adding a README to the repository), I needed to rebuild the container locally, which pulled the latest version of the <a href=https://github.com/JMHReif/docker-maria/blob/master/docker/Dockerfile#L3 target=_blank rel=noopener>MariaDB base image</a>. I didnâ€™t need to do anything different for my Apple silicon chip, as the same base image supports both architectures. We can see this in the <a href=https://hub.docker.com/_/mariadb target=_blank rel=noopener>mariadb image</a> tags, as shown below. Both <code>x86-64</code> and <code>ARM 64</code> are there.</p></div><div class=imageblock><div class=content><img src=/img/containers/dockerhub-maria.png alt="dockerhub maria"></div></div><div class=paragraph><p>Once I pulled the latest version of the container and tested it, I pushed the updated image to my <a href=https://hub.docker.com/u/jmreif target=_blank rel=noopener>personal Docker Hub</a> repositories. The commands used to do all of these steps are listed below.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-shell data-lang=shell>docker build . -t jmreif/mariadb

docker run --name mymaria -p3306:3306 \
    -d -v $HOME/Projects/docker/data/maria:/var/lib/mysql \
    -v $HOME/Projects/docker/logs/maria:/var/log/mysql \
    -e MYSQL_ROOT_PASSWORD=Testing123 \
    jmreif/mariadb

docker push jmreif/mariadb</code></pre></div></div><div class=paragraph><p>The second command in the code block above is a bit long due to all of the options. I also included the same command in the run script from the Github repository, so if you clone the whole repository, you can run the script in place of the <code>docker run</code> command above.</p></div><div class=paragraph><p>First, I use the <code>--name</code> option to give my container instance a name. This allows me to reference the container by name in commands, instead of using the container id (complicated alphanumeric value). I then bind the container port to a host port using <a href=https://docs.docker.com/engine/reference/commandline/run/#publish-or-expose-portâ€”â€‹p---expose target=_blank rel=noopener><code>-p</code></a> (syntax is hostPort:containerPort). Since MariaDBâ€™s default port is 3306, I stick with that, so we bind my machineâ€™s 3306 port to the containerâ€™s 3306 port.</p></div><div class=paragraph><p>The <code>-d</code> option that follows is to run the container in detach mode. This means it runs in the background, making it easier to see the container and gain access to it. The next two options use the <a href=https://docs.docker.com/engine/reference/commandline/run/#mount-volumeâ€”â€‹v---read-only target=_blank rel=noopener><code>-v</code></a> flag, which mounts folders from the host device into the container. This means that if I have files or scripts I need to access inside the container, the container can see these through a mounted volume. In our case, we have mapped a local <code>data</code> folder to the <code>/var/lib/mysql</code> folder in the container (for data load), and we have mapped a local <code>log</code> folder to the <code>/var/log/mysql</code> folder in the container (for viewing log files).</p></div><div class=paragraph><p>Next, our <code>-e</code> option is setting environment variables to pass into the container. For us, this means a password for the database. The last bit of text in the command is specifying the image to use for building the container (jmreif/mariadb).</p></div><div class=paragraph><p>With that knowledge, we can take a look at the MongoDB container changes.</p></div></div><div class=sect2><h3 id=_mongodb>MongoDB</h3><div class=paragraph><p>Moving now to the <a href=https://github.com/JMHReif/docker-mongo target=_blank rel=noopener>docker-mongo</a> repository, we donâ€™t see too many changes here either. The change for the author syntax on the Dockerfile was mentioned earlier, and I added a README for details. Otherwise, I did the same as with the MariaDB container - rebuilt the image so it pulled an updated <a href=https://hub.docker.com/_/mongo target=_blank rel=noopener>mongo base image</a>, then tested the container, then pushed the updated version.</p></div><div class=paragraph><p>The MongoDB base image also supports multiple architectures (including x86-64 and arm64), so I didnâ€™t need to do anything different. We can confirm this with the Docker Hub image screenshot below. The <code>x86-64</code> and <code>ARM 64</code> tags are both there.</p></div><div class=imageblock><div class=content><img src=/img/containers/dockerhub-mongo.png alt="dockerhub mongo"></div></div><div class=paragraph><p>The commands for all these steps are very similar to the MariaDB ones shown earlier, but we will note the differences below.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-shell data-lang=shell>docker build . -t jmreif/mongodb

docker run --name mymongo -p27017:27017 \
    -e MONGO_INITDB_ROOT_USERNAME=mongoadmin \
    -e MONGO_INITDB_ROOT_PASSWORD=Testing123 \
    -d -v $HOME/Projects/docker/data/mongo:/data/db \
    -v $HOME/Projects/docker/logs/mongo:/logs \
    -v $HOME/Projects/docker/tmp/mongo:/tmp \
    jmreif/mongodb

docker push jmreif/mongodb</code></pre></div></div><div class=paragraph><p>We will focus on the second command. The syntax is similar, using the <code>--name</code> option to specify a name for our container and then using the <code>-p</code> option to bind a container port to a host port, with 27017 being MongoDBâ€™s default port. Next, we specify our environment variables for the database username and password with <code>-e</code>. If you remember, we specified these options last in our mariadb container, but ordering doesnâ€™t really matter here. After our password, we use the <code>-d</code> option to run the container in the background and have three <code>-v</code> options for mounting data, logs, and temporary folders to the container. Lastly, we have the image name used for creating the container.</p></div><div class=paragraph><p>This completes our update for the MongoDB container. Now we can continue on to Neo4j.</p></div></div><div class=sect2><h3 id=_neo4j>Neo4j</h3><div class=paragraph><p>With Neo4jâ€™s latest update to version 4.4, the changes align very closely with those we saw for MariaDB and MongoDB. As you might have guessed, we changed the author syntax in the Dockerfile for Neo4j, just as we did with MariaDB and MongoDB. I also added a README file in this repository to match the others. Looking at the <a href=https://github.com/JMHReif/docker-neo4j/commit/bf09ef7b8bb546097882f6fe506ee35cf97aae23 target=_blank rel=noopener>commit</a>, though, there are a couple other changes, so letâ€™s walk through those.</p></div><div class=paragraph><p><em>*Note(2021-12-16):* Neo4j supports multi-arch as of version 4.4+! For Neo4j 4.3 and older, the <a href=https://hub.docker.com/r/neo4j/neo4j-arm64-experimental target=_blank rel=noopener>Neo4j arm64 image</a> supports arm64. You will need to pull a different base image by modifying the <a href=https://github.com/JMHReif/docker-neo4j/commit/2f895e55d70f501d683dc87f46a8521616c30615#diff-f34da55ca08f1a30591d8b0b3e885bcc678537b2a9a4aadea4f190806b374ddcR3 target=_blank rel=noopener>base image line</a> to use the <a href=https://hub.docker.com/r/neo4j/neo4j-arm64-experimental target=_blank rel=noopener>neo4j-arm64-experimental</a> image.</em></p></div><div class=paragraph><p>We can see both the specified architectures on the official Neo4j repository in the screenshot below.</p></div><div class=imageblock><div class=content><img src=/img/containers/dockerhub-neo4j.png alt="dockerhub neo4j"></div></div><div class=paragraph><p>Neo4j also requires you to specify a version tag for the image (actually a Docker best practice), so I used the <code>4.4.1</code> version. However, feel free to use one to fit your needs. The current (as of writing this) release version is 4.4, so picking any minor versions of that ensures you have the latest features.</p></div><div class=paragraph><p>Next, I exposed an extra port for the default Neo4j HTTPS port (7473). The other two ports in the Dockerfile are for Neo4jâ€™s default HTTP and BOLT ports, respectively. Though it is not required to have them all, I have all connection types covered.</p></div><div class=paragraph><p>With those changes in place, we can build, test, and push the new container. As before, Iâ€™ll show the commands used for all of these steps below.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-shell data-lang=shell>docker build . -t jmreif/neo4j

docker run \
    --name myneo4j -p7474:7474 -p7687:7687 \
    -e NEO4J_AUTH=neo4j/Testing123 \
    -d -v $HOME/Projects/docker/data/neo4j:/data \
    -v $HOME/Projects/docker/logs/neo4j:/logs \
    -v $HOME/Projects/docker/data/neo4j/import:/import \
    -v $HOME/Projects/docker/data/neo4j/plugins:/plugins \
    jmreif/neo4j

docker push jmreif/neo4j</code></pre></div></div><div class=paragraph><p>The only change for the build and push commands is the image name, so we will skip to the run command differences. All of the options should look familiar, since we donâ€™t have anything new compared to the MariaDB and MongoDB versions. The <code>--name</code> option lets me set a container name for referencing, and the <code>-p</code> lets me map host to container ports. In this case, Iâ€™ve bound both 7474 and 7687, which are the HTTP and BOLT ports for Neo4j. This means I can access <a href=https://neo4j.com/developer/neo4j-browser/ target=_blank rel=noopener>Neo4j Browser</a> using port 7474, and I can connect via applications through 7687 with the <a href=https://en.wikipedia.org/wiki/Bolt_(network_protocol) target=_blank rel=noopener>bolt protocol</a>.</p></div><div class=paragraph><p>On the next line, the <code>-e</code> option is used to set an environment variable for the username and password (both are set with a single variable, using a <code>/</code> to separate the two values). A <code>-d</code> option follows that to run the container in the background, and then all of our <code>-v</code> options mount folders for data and logs, as well as two Neo4j-specific ones for import files (/import) and plugins (for adding extensions like <a href=https://neo4j.com/labs/apoc/ target=_blank rel=noopener>APOC</a>). The final bit of text specifies the image to use for building the container - <code>jmreif/neo4j</code>.</p></div></div></div></div><div class=sect1><h2 id=_doing_things_with_the_container>Doing things with the container</h2><div class=sectionbody><div class=paragraph><p>There are a variety of commands you can use to access and interact with the containers we just upgraded. Probably some of the most common are listed below.</p></div><div class=ulist><ul><li><p><code>docker start &lt;containerName></code>: starts a stopped, existing container</p></li><li><p><code>docker stop &lt;containerName></code>: stops a running container</p></li><li><p><code>docker rm &lt;containerName></code>: delete a container. You will need to do a <code>docker run</code> command again to create a fresh container. Use when you need to change options in the run command or make adjustments to the Dockerfile. <strong>Note:</strong> if you make adjustments to the Dockerfile, that you will also need to rebuild the image.</p></li><li><p><code>docker exec -it &lt;containerName> &lt;type></code>: allows you to ssh into the container. Helpful for running scripts, loading data, and making other changes inside the container itself.</p></li></ul></div><div class=paragraph><p>I hope to cover more about these pertaining to this project in later posts, but there is plenty of general documentation for these commands, as well.</p></div></div></div><div class=sect1><h2 id=_wrapping_up>Wrapping up!</h2><div class=sectionbody><div class=paragraph><p>In this post, we walked through my experience of upgrading Docker containers for three major databases - MariaDB, MongoDB, and Neo4j. All of our database images support multiple architectures, simplifying our process and future updates. I honestly expected more hassle across the board with Docker and the recent Apple silicon chip. The transition wasnâ€™t too big of a hurdle.</p></div><div class=paragraph><p>We also looked at the commands for how to rebuild images so that they pull latest versions, whether through a default (not specifying a tag for the base image in the Dockerfile) or through defining a base image tag. Lastly, we reviewed the commands for rebuilding images and pushing them to a repository on DockerHub so that we can share them.</p></div><div class=paragraph><p>As a final note, if you have any questions or want to provide feedback on Neo4jâ€™s Docker container, please do <a href=https://github.com/neo4j/docker-neo4j/issues target=_blank rel=noopener>raise Github issues</a> or <a href=https://community.neo4j.com/c/integrations/docker/86 target=_blank rel=noopener>ask questions</a>!</p></div><div class=paragraph><p>Happy coding!</p></div></div></div><div class=sect1><h2 id=_resources>Resources</h2><div class=sectionbody><div class=ulist><ul><li><p>Documentation: <a href=https://docs.docker.com/engine/reference/run/ target=_blank rel=noopener>Docker run command</a></p></li><li><p>Documentation: <a href=https://docs.docker.com/engine/reference/commandline/docker/ target=_blank rel=noopener>Docker command list</a></p></li><li><p>Github: <a href=https://github.com/JMHReif/docker-maria target=_blank rel=noopener>MariaDB</a>, <a href=https://github.com/JMHReif/docker-mongo target=_blank rel=noopener>MongoDB</a>, and <a href=https://github.com/JMHReif/docker-neo4j target=_blank rel=noopener>Neo4j</a> repositories</p></li><li><p>Developer guide: <a href=https://neo4j.com/developer/docker/ target=_blank rel=noopener>Docker and Neo4j</a></p></li></ul></div></div></div><ul class=pa0><li class="list di"><a href=/tags/docker/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">docker</a></li><li class="list di"><a href=/tags/neo4j/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">neo4j</a></li><li class="list di"><a href=/tags/mongodb/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">mongodb</a></li><li class="list di"><a href=/tags/mariadb/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">mariadb</a></li><li class="list di"><a href=/tags/upgrade/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">upgrade</a></li><li class="list di"><a href=/tags/container/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">container</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/blog/2021/migrate-sdn-part3/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 3</a></li><li class=mb2><a href=/blog/2021/java17-graph-explore/>Java 17: Explore the newly-released Java version in a graph database!</a></li><li class=mb2><a href=/blog/2021/migrate-sdn-part2/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 2</a></li><li class=mb2><a href=/blog/2021/migrate-sdn-part1/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 1</a></li><li class=mb2><a href=/blog/2021/create-data-marvel-sdn/>Create a Data Marvel with Spring Data Neo4j</a></li></ul></div></aside></article></main><footer class="bg-dark-green bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://jmhreif.com/>&copy; Jennifer Reif 2025</a><div><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank rel=noopener class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" aria-label="follow on Twitterâ€”â€”Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank rel=noopener class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHubâ€”â€”Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank rel=noopener class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedInâ€”â€”Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank rel=noopener class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" aria-label="follow on RSSâ€”â€”Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.podbean.com/ target=_blank rel=noopener class="podcast ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="podcast link" aria-label="follow on podcastâ€”â€”Opens in a new window"><span class=icon><svg width="1200pt" height="1200pt" viewBox="0 0 1200 1200" xmlns="http://www.w3.org/2000/svg"><path d="m6e2 62.484c-296.48.0-537.52 241.03-537.52 537.52s240.98 537.52 537.52 537.52c296.48.0 537.52-240.98 537.52-537.52.0-296.48-241.03-537.52-537.52-537.52zm-155.02 305.02c0-85.5 69.516-155.02 155.02-155.02S755.02 282 755.02 367.504v234.98c0 85.5-69.516 155.02-155.02 155.02s-155.02-69.516-155.02-155.02zm192.52 516.52v66c0 20.484-17.016 37.5-37.5 37.5s-37.5-17.016-37.5-37.5v-66C408 865.508 288 734.024 288 574.504c0-20.484 17.016-37.5 37.5-37.5s37.5 17.016 37.5 37.5c0 130.5 106.5 237 237 237s237-106.5 237-237c0-20.484 17.016-37.5 37.5-37.5s37.5 17.016 37.5 37.5c0 159.52-120 291-274.5 309.52z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>