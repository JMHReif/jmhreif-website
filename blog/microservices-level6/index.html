<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Journeys in Java, Level 6: Building an Empire of Microservices | Jennifer Reif</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Photo credit  For our next adventure in Java microservices, we want to expand our system for book review data. While books and authors are well-suited for a document database such as MongoDB, once you add reviews to the mix, the importance of the relationships makes this project better suited for a graph database. This way, we can utilize relationships between the different entities to improve analysis based on the structure of the connections."><meta name=generator content="Hugo 0.85.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="Journeys in Java, Level 6: Building an Empire of Microservices"><meta property="og:description" content="Photo credit  For our next adventure in Java microservices, we want to expand our system for book review data. While books and authors are well-suited for a document database such as MongoDB, once you add reviews to the mix, the importance of the relationships makes this project better suited for a graph database. This way, we can utilize relationships between the different entities to improve analysis based on the structure of the connections."><meta property="og:type" content="article"><meta property="og:url" content="https://jmhreif.com/blog/microservices-level6/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-06-21T09:00:00-06:00"><meta property="article:modified_time" content="2022-06-21T09:00:00-06:00"><meta itemprop=name content="Journeys in Java, Level 6: Building an Empire of Microservices"><meta itemprop=description content="Photo credit  For our next adventure in Java microservices, we want to expand our system for book review data. While books and authors are well-suited for a document database such as MongoDB, once you add reviews to the mix, the importance of the relationships makes this project better suited for a graph database. This way, we can utilize relationships between the different entities to improve analysis based on the structure of the connections."><meta itemprop=datePublished content="2022-06-21T09:00:00-06:00"><meta itemprop=dateModified content="2022-06-21T09:00:00-06:00"><meta itemprop=wordCount content="2211"><meta itemprop=keywords content="java,microservices,applications,development,spring-boot,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Journeys in Java, Level 6: Building an Empire of Microservices"><meta name=twitter:description content="Photo credit  For our next adventure in Java microservices, we want to expand our system for book review data. While books and authors are well-suited for a document database such as MongoDB, once you add reviews to the mix, the importance of the relationships makes this project better suited for a graph database. This way, we can utilize relationships between the different entities to improve analysis based on the structure of the connections."></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://jmhreif.com/img/microservices-lvl6/unsplash-sunset-goldengate-bridge.jpeg)><div class="pb3-m pb6-l bg-black-60"><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Jennifer Reif</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/ title="Home page">Home</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blog/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/abstracts/ title="Abstracts page">Abstracts</a></li></ul><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">BLOG</aside><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/share?url=https://jmhreif.com/blog/microservices-level6/&text=Journeys%20in%20Java,%20Level%206:%20Building%20an%20Empire%20of%20Microservices" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://jmhreif.com/blog/microservices-level6/&title=Journeys%20in%20Java,%20Level%206:%20Building%20an%20Empire%20of%20Microservices" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div><h1 class="f1 athelas mt3 mb1">Journeys in Java, Level 6: Building an Empire of Microservices</h1><time class="f6 mv4 dib tracked" datetime=2022-06-21T09:00:00-06:00>June 21, 2022</time>
<span class="f6 mv4 dib tracked">- 11 minutes read</span>
<span class="f6 mv4 dib tracked">- 2211 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><div class=paragraph><small><i><a href="https://unsplash.com/photos/SHP1t8EduMY?utm_source=unsplash&utm_medium=referral&utm_content=creditShareLink">Photo credit</a></i></small></div><div class=paragraph><p>For our next adventure in Java microservices, we want to expand our system for book review data. While books and authors are well-suited for a document database such as MongoDB, once you add reviews to the mix, the importance of the relationships makes this project better suited for a graph database. This way, we can utilize relationships between the different entities to improve analysis based on the structure of the connections. While everything we will do here is feasible with other data stores, a graph database dramatically simplifies queries on connected entities.</p></div><div class=paragraph><p>If you are new to graphs, I will leave a couple of resources below for more information.</p></div><div class=ulist><ul><li><p><a href=https://medium.com/neo4j/how-do-you-know-if-a-graph-database-solves-the-problem-a7da10393f5 target=_blank rel=noopener>Blog post: How do you know if a graph database solves the problem</a></p></li><li><p><a href=https://neo4j.com/developer/graph-database/ target=_blank rel=noopener>Neo4j guide: What is a graph database?</a></p></li></ul></div><div class=paragraph><p>Utilizing another database means starting a database instance, and there were a few choices here. Several graph databases exist on the market, but Neo4j is a popular one and offers several deployment options. We could spin up a Docker container (as we did in an <a href=https://jmhreif.com/blog/microservices-level3/ target=_blank rel=noopener>earlier section with MongoDB</a>) or take advantage of the database-as-a-service option called <a href=https://bit.ly/neo4j-aura target=_blank rel=noopener>AuraDB</a> with their free tier. Neo4j will handle managing the database, and it should have everything we need.</p></div><div class=paragraph><p>In this post, we will create our Neo4j database and get the data loaded, then build our new service that interacts with the database and provides an API for client services.</p></div><div class=paragraph><p>Let’s get into the technical stuff!</p></div><div class=sect1><h2 id=_architecture>Architecture</h2><div class=sectionbody><div class=paragraph><p>We began this microservices project with minimum functionality explained in the <a href=https://jmhreif.com/blog/microservices-level1/ target=_blank rel=noopener>level 1 blog post</a>. In our last post (<a href=https://jmhreif.com/blog/microservices-level5/ target=_blank rel=noopener>level5</a>), we used our existing services with book and author data, but set up Docker Compose to manage all the services together using a yaml file and a couple of commands.</p></div><div class=paragraph><p>With this iteration, we want to add some new functionality for book review data using a graph database in the cloud and set up a new service that hosts that data from the database.</p></div><div class=paragraph><p>Here is the updated architecture:</p></div><div class=imageblock><div class=content><img src=/img/microservices-lvl6/microservices-level6.png alt="microservices level6"></div></div><div class=paragraph><p>The items outside the grey box are what we are adding today - Neo4j database and <code>service4</code> application. The rest of the pieces of the diagram are from previous iterations of our microservices project. Notice that we are not yet incorporating Neo4j and our new service to Docker Compose. I prefer to build things in small increments, so that there is less room for errors. We will add these new pieces to our existing architecture in a later post.</p></div></div></div><div class=sect1><h2 id=_database_as_a_service_auradb>Database-as-a-service: AuraDB</h2><div class=sectionbody><div class=paragraph><p>We want to add a new database into our microservices system, and we know we want to use <a href=https://bit.ly/neo4j-aura target=_blank rel=noopener>AuraDB</a> free tier. Signing up and creating the database instance requires a couple steps and a bit of information, such as verifying your email address and waiting for the instance to spin up (takes a few minutes). Details of that process (with screenshots) are shown in most of my colleague <a href=https://twitter.com/mesirii target=_blank rel=noopener>Michael Hunger</a>'s "Discover AuraDB Free" blog posts, such as <a href=https://medium.com/neo4j/discover-auradb-free-week-26-goodreads-books-and-recommendations-54fb47e3f201 target=_blank rel=noopener>this week’s</a>.</p></div><div class=paragraph><p>Once the instance is running, we can get started with our data load.</p></div></div></div><div class=sect1><h2 id=_graph_data_load>Graph data load</h2><div class=sectionbody><div class=paragraph><p>I could just load reviews to Neo4j, but graphs gain power from relationships between data. So, we can load all the entities for books, authors, and reviews. My <a href=https://github.com/JMHReif/graph-demo-datasets/tree/main/goodreadsUCSD target=_blank rel=noopener>data Github repository</a> contains a load script with steps outlined in the folder’s readme. A couple of queries are included in the readme for verifying the data. The loaded data has the below data model.</p></div><div class=imageblock><div class=content><img src=/img/microservices-lvl6/goodreads-ucsd-data-model.png alt="goodreads ucsd data model"></div></div><div class=paragraph><p>Time to start building our application to pull review data.</p></div></div></div><div class=sect1><h2 id=_applications_service_4>Applications - Service 4</h2><div class=sectionbody><div class=paragraph><p>For those following along from previous iterations of this project, our new <code>service4</code> will look pretty similar to <code>service1</code> and <code>service3</code> for books and authors, respectively. For those jumping in with this blog post, we will build a Spring Boot application with a couple of REST endpoints to access the data from the connected database (in this case, Neo4j).</p></div><div class=paragraph><p>We can put together the outline of our project using the Spring Initializr at <a href=https://start.spring.io/ target=_blank rel=noopener>start.spring.io</a>.</p></div><div class=paragraph><p>On the form, we can leave <code>Project</code>, <code>Language</code>, and <code>Spring Boot</code> version fields defaulted. Under the <code>Project Metadata</code> section, I have chosen to update the group name for my personal projects, but you are welcome to leave it defaulted as well. I named the artifact <code>service4</code>, but naming isn’t important as long as we can keep everything straight with our other services. All other fields in this section can remain as they are. Under the <code>Dependencies</code> section, we will need <code>Spring Reactive Web</code>, <code>Lombok</code>, and <code>Spring Data Neo4j</code>. <a href=https://spring.io/projects/spring-data-neo4j target=_blank rel=noopener>Spring Data Neo4j</a> is the sister project to our previously-used Spring Data MongoDB, providing much of the same capabilities for the graph database. Finally, the project template is complete, and we can click the <code>Generate</code> button at the bottom to download the project.</p></div><div class=imageblock><div class=content><img src=/img/microservices-lvl6/springio-svc4.png alt="springio svc4"></div></div><div class=paragraph><p><em>Note: the Spring Initializr displays in dark mode or light mode via the moon or sun icons in the right column of the page.</em></p></div><div class=paragraph><p>Generating will download the project as a zip, so we can unzip it and move it to our project folder with the other services. Open the project in your favorite IDE and let’s get coding!</p></div><div class=paragraph><p>The <code>pom.xml</code> contains the dependencies and software versions we set up on the Spring Initializr, so we can move to the <code>application.properties</code> file in the <code>src/main/resources</code> folder. Here, we want to connect to our Neo4j instance with a URI and database credentials. We typically do not want to embed our database credentials in an application. Hard-coding those values could give others access to login or tamper with our cloud database. This is different from our previous services because we connected to a local MongoDB instance. Solving this is something we will cover in the next blog post, but for now, we will simply hard-code our credentials with the caveat that we need to override them with dummy data before we publish any code.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-text data-lang=text>server.port=8083

#database connection
spring.neo4j.uri=&lt;insert Neo4j URI here&gt;
spring.neo4j.authentication.username=&lt;insert Neo4j username here&gt;
spring.neo4j.authentication.password=&lt;insert Neo4j password here&gt;
spring.data.neo4j.database=&lt;insert Neo4j database here&gt;</code></pre></div></div><div class=paragraph><p>Because we have multiple services, we need the <code>server.port</code> property to ensure traffic does not conflict. We have already used ports 8080-8082 for services 1-3, so 8083 is our next in line. Next, we need to connect to our database using the properties for Neo4j URI, username, password, and database. <em>*Note:* Database should be <code>neo4j</code>, unless you have specifically used commands to change the default.</em></p></div><div class=paragraph><p>On to the project code!</p></div><div class=sect2><h3 id=_service_4_project_code>Service 4 - project code</h3><div class=paragraph><p>As mentioned above, code for <code>service4</code> will look similar to services 1 and 3, with the exception that we are mapping graph data instead of document data. A few changes go into that shift, so let’s walk through them starting with the domain class.</p></div><div class=listingblock><div class=title>Data domain class</div><div class=content><pre class=highlight><code class=language-java data-lang=java>@Data
@Node
class Review {
	@Id
	@GeneratedValue
	private Long neoId;
	@NonNull
	private String review_id;

	private String book_id, review_text, date_added, date_updated, started_at, read_at;
	private Integer rating, n_comments, n_votes;
}</code></pre></div></div><div class=paragraph><p>The <code>@Data</code> is a <a href=https://projectlombok.org/features/Data target=_blank rel=noopener>Lombok annotation</a> that generates our getters, setters, equals, hashCode, and toString methods for the domain class. It cuts down on the boilerplate code, so that’s nice. Next is the <a href=https://github.com/JMHReif/microservices-level6/blob/main/service4/src/main/java/com/jmhreif/service4/Service4Application.java#L53 target=_blank rel=noopener><code>@Node</code></a> annotation. This is a Spring Data Neo4j annotation that marks it as a Neo4j entity class (Neo4j entities are called nodes).</p></div><div class=paragraph><p>Within the class declaration, we define a few fields (properties) for our class. The <code>@Id</code> annotation marks the field as a unique identifier, and the <code>@GeneratedValue</code> says that it is generated internally by Neo4j. On our next field <a href=https://github.com/JMHReif/microservices-level6/blob/main/service4/src/main/java/com/jmhreif/service4/Service4Application.java#L59 target=_blank rel=noopener><code>review_id</code></a>, we have a Lombok <a href=https://projectlombok.org/features/NonNull target=_blank rel=noopener><code>@NonNull</code></a> annotation that specifies this field cannot be null. We also have some other fields we want to retrieve for the review text, dates, and rating information.</p></div><div class=paragraph><p>Next, we need a repository interface where we can define methods to interact with the data in the database.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>interface ReviewRepository extends ReactiveCrudRepository&lt;Review, Long&gt; {
	Flux&lt;Review&gt; findFirst1000By();

	@Query(&#34;MATCH (r:Review)-[rel:WRITTEN_FOR]-&gt;(b:Book {book_id: $book_id}) RETURN r;&#34;)
	Flux&lt;Review&gt; findReviewsByBook(String book_id);
}</code></pre></div></div><div class=paragraph><p>We want this repository to extend the <code>ReactiveCrudRepository</code>, which will let us use reactive methods and types for working with the data. Then, we define a couple of methods. While we could use Spring Data’s out-of-the-box implementations of a few default methods (listed in the <a href=https://docs.spring.io/spring-data/commons/docs/current/reference/html/#repositories.core-concepts target=_blank rel=noopener>code example of the documentation</a>), we want to customize a little bit, so we will define our own. Instead of using the default <code>.findAll()</code> method, we want to pull only 1,000 results because pulling all 35,342 reviews could overload result-rendering on the client.</p></div><div class=paragraph><p>Notice that we do not have any implementation details with the <code>findFirst1000By()</code> method (no query or logic). Instead, we are using another of Spring Data’s features - <a href=https://www.baeldung.com/spring-data-derived-queries target=_blank rel=noopener>derived methods</a>. This is where Spring constructs (i.e. "derives") what the query should be based on the method name. In our example, the repository is dealing with reviews (<code>ReactiveCrudRepository&lt;Review, Long></code>), so <code>findFirst1000</code> is looking for the first 1,000 reviews. Normally, this syntax would continue by finding the results <code>by</code> a certain criterion (rating, reviewer, date, etc), but since we want to pull any random set of reviews, we can trick Spring by simply leaving off the criterion from our method name. This is where we get the <code>findFirst1000By</code>. <em>*Note:* This is a hidden workaround that is pretty handy once you know it, but it would be nice if Spring provided an out-of-the-box solution for these cases.</em></p></div><div class=paragraph><p>Our next method <a href=https://github.com/JMHReif/microservices-level6/blob/main/service4/src/main/java/com/jmhreif/service4/Service4Application.java#L48 target=_blank rel=noopener>starting at the fourth line</a> is a bit more straightforward. We want to find reviews for any specific book, so we need to look up reviews by <code>book_id</code>. For this, we have written a custom query using the <code>@Query</code> annotation and the database’s related query language. Neo4j’s is <a href=https://neo4j.com/developer/cypher/ target=_blank rel=noopener>Cypher</a>. This query looks for reviews written for a book with the specified book id.</p></div><div class=paragraph><p>With the repository complete, we can write our <a href=https://www.javatpoint.com/spring-mvc-tutorial target=_blank rel=noopener>controller class</a> that sets up some REST endpoints for other services to access the data.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@RestController
@RequestMapping(&#34;/neo&#34;)
@AllArgsConstructor
class ReviewController {
	private final ReviewRepository reviewRepo;

	@GetMapping
	String liveCheck() { return &#34;Service4 is up&#34;; }

	@GetMapping(&#34;/reviews&#34;)
	Flux&lt;Review&gt; getReviews() { return reviewRepo.findFirst1000By(); }

	@GetMapping(&#34;/reviews/{book_id}&#34;)
	Flux&lt;Review&gt; getBookReviews(@PathVariable String book_id) { return reviewRepo.findReviewsByBook(book_id); }
}</code></pre></div></div><div class=paragraph><p>Those familiar with our previous services 1 and 3 code will notice this looks almost the exact same (except with reviews instead of books or authors). The <code>@RestController</code> Spring annotation designates this as a rest controller class, and the <code>@RequestMapping</code> defines a high-level endpoint for using any of the class methods. Within the class declaration, we inject the <code>ReviewRepository</code> with the <a href=https://github.com/JMHReif/microservices-level6/blob/main/service4/src/main/java/com/jmhreif/service4/Service4Application.java#L32 target=_blank rel=noopener>first line</a>, so that we can utilize our written methods.</p></div><div class=paragraph><p>Next, we map endpoints for each of our methods. The <code>liveCheck()</code> method uses the high-level <code>/neo</code> endpoint to return a string, ensuring that our service is live and reachable. We can execute the <code>getReviews()</code> method by adding a nested endpoint (<code>/reviews</code>). This method uses the <code>findFirst1000By()</code> method that we wrote in the repository and returns a reactive <code>Flux&lt;></code> type where we expect 0 or more reviews in the results.</p></div><div class=paragraph><p>Our <a href=https://github.com/JMHReif/microservices-level6/blob/main/service4/src/main/java/com/jmhreif/service4/Service4Application.java#L40 target=_blank rel=noopener>final method</a> has the nested endpoint of <code>/reviews/{book_id}</code>, where the book id is a path variable that changes based on the book we want to search. The <code>getBookReviews()</code> method passes in the specified book id as the path variable, then calls the <code>findReviewsByBook()</code> method from the repository and returns a <code>Flux&lt;></code> of reviews.</p></div><div class=paragraph><p>Time to test our new service!</p></div></div></div></div><div class=sect1><h2 id=_put_it_to_the_test>Put it to the test</h2><div class=sectionbody><div class=paragraph><p>Since <code>service4</code> is currently separate from our other services and using a different database, we will test this individually for now and test everything together once we are ready to incorporate <code>service4</code> with the rest in Docker Compose.</p></div><div class=paragraph><p>I like to start projects from bottom to top, so let us first ensure the Neo4j AuraDB instance is still running. <em>*Note:* AuraDB free tier pauses automatically after 3 days. You can resume with the <code>play</code> icon on the instance.</em></p></div><div class=paragraph><p>Next, we need to start our <code>service4</code> application, either through the IDE or command line. Once that is running, we can test the application with the following commands.</p></div><div class="olist arabic"><ol class=arabic><li><p>Test application is live: open a browser and go to <code>localhost:8083/neo</code> or go to command line with <code>curl localhost:8083/neo</code>.</p></li><li><p>Test backend reviews api finding reviews: open a browser and go to <code>localhost:8083/neo/reviews</code> or go to command line with <code>curl localhost:8083/neo/reviews</code>.</p></li><li><p>Test api finding reviews for a certain book: open a browser and go to <code>localhost:8083/neo/reviews/178186</code> or go to command line with <code>curl localhost:8083/neo/178186</code>.</p></li></ol></div><div class=paragraph><p>And here is the resulting output from authors api results from service4!</p></div><div class=paragraph><div class=title>Find 1000 reviews</div><p><span class=image><img src=/img/microservices-lvl6/microservices-lvl6-results.png alt="microservices lvl6 results"></span></p></div><div class=paragraph><div class=title>Find reviews by book</div><p><span class=image><img src=/img/microservices-lvl6/microservices-lvl6-results-book.png alt="microservices lvl6 results book"></span></p></div></div></div><div class=sect1><h2 id=_wrapping_up>Wrapping up!</h2><div class=sectionbody><div class=paragraph><p>We walked through creating a graph database instance using Neo4j AuraDB free tier and loaded data for books, authors, and reviews. Then, we built a microservice application to connect to the cloud database and retrieve reviews. Finally, we tested all of our code by starting the application and hitting each of our endpoints to ensure we could access the data.</p></div><div class=paragraph><p>There is so much more we can do on this topic. In upcoming posts, we need to externalize our database credentials, keeping sensitive data private, yet accessible to multiple services. We also need to incorporate our new <code>service4</code> with the rest of our services in Docker Compose to manage everything together. Another area of exploration is to take further advantage of graph benefits by pulling more related entities. Happy coding!</p></div></div></div><div class=sect1><h2 id=_resources>Resources</h2><div class=sectionbody><div class=ulist><ul><li><p>Github: <a href=https://github.com/JMHReif/microservices-level6 target=_blank rel=noopener>microservices-level6</a> repository</p></li><li><p>Github: <a href=https://github.com/JMHReif/microservices-java target=_blank rel=noopener>Meta repository for all related content</a></p></li><li><p>Developer guide: <a href=https://neo4j.com/developer/graph-database/ target=_blank rel=noopener>Neo4j graph database</a></p></li><li><p>Neo4j AuraDB: <a href=https://bit.ly/neo4j-aura target=_blank rel=noopener>Create a FREE database</a></p></li><li><p>Documentation: <a href=https://spring.io/projects/spring-data-neo4j target=_blank rel=noopener>Spring Data Neo4j</a></p></li></ul></div></div></div><ul class=pa0><li class="list di"><a href=/tags/java class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">java</a></li><li class="list di"><a href=/tags/microservices class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">microservices</a></li><li class="list di"><a href=/tags/applications class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">applications</a></li><li class="list di"><a href=/tags/development class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">development</a></li><li class="list di"><a href=/tags/spring-boot class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">spring-boot</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/blog/microservices-level5/>Journeys in Java, Level 5: Building an Empire of Microservices</a></li><li class=mb2><a href=/blog/microservices-level4/>Journeys in Java, Level 4: Building an Empire of Microservices</a></li><li class=mb2><a href=/blog/microservices-level3/>Journeys in Java, Level 3: Building an Empire of Microservices</a></li><li class=mb2><a href=/blog/microservices-level2/>Journeys in Java, Level 2: Building an Empire of Microservices</a></li><li class=mb2><a href=/blog/microservices-level1/>Journeys in Java, Level 1: Building an Empire of Microservices</a></li><li class=mb2><a href=/blog/migrate-sdn-part3/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 3</a></li><li class=mb2><a href=/blog/migrate-sdn-part2/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 2</a></li><li class=mb2><a href=/blog/migrate-sdn-part1/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 1</a></li><li class=mb2><a href=/blog/create-data-marvel-sdn/>Create a Data Marvel with Spring Data Neo4j</a></li><li class=mb2><a href=/blog/java17-graph-explore/>Java 17: Explore the newly-released Java version in a graph database!</a></li><li class=mb2><a href=/blog/java-holds-its-own/>In the Language Wars, Java Holds Its Own</a></li></ul></div></aside></article></main><footer class="bg-dark-green bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://jmhreif.com/>&copy; Jennifer Reif 2022</a><div><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>