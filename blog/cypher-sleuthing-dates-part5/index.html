<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Cypher Sleuthing: Dealing with Dates, Part 5 | Jennifer Reif</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="From part 1 introducing Cypher dates and formats to part 4 where we combined duration functions and temporal components to translate amounts in one unit to another unit, we have covered a lot of ground in this series! Filling in the gaps, part 2 showed us how to truncate dates for searches and use durations for adding/subtracting amounts of time, and part 3 gave us an intro to temporal components and translations within component groups."><meta name=generator content="Hugo 0.85.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="Cypher Sleuthing: Dealing with Dates, Part 5"><meta property="og:description" content="From part 1 introducing Cypher dates and formats to part 4 where we combined duration functions and temporal components to translate amounts in one unit to another unit, we have covered a lot of ground in this series! Filling in the gaps, part 2 showed us how to truncate dates for searches and use durations for adding/subtracting amounts of time, and part 3 gave us an intro to temporal components and translations within component groups."><meta property="og:type" content="article"><meta property="og:url" content="https://jmhreif.com/blog/cypher-sleuthing-dates-part5/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-08-10T09:00:00-06:00"><meta property="article:modified_time" content="2021-08-10T09:00:00-06:00"><meta itemprop=name content="Cypher Sleuthing: Dealing with Dates, Part 5"><meta itemprop=description content="From part 1 introducing Cypher dates and formats to part 4 where we combined duration functions and temporal components to translate amounts in one unit to another unit, we have covered a lot of ground in this series! Filling in the gaps, part 2 showed us how to truncate dates for searches and use durations for adding/subtracting amounts of time, and part 3 gave us an intro to temporal components and translations within component groups."><meta itemprop=datePublished content="2021-08-10T09:00:00-06:00"><meta itemprop=dateModified content="2021-08-10T09:00:00-06:00"><meta itemprop=wordCount content="2140"><meta itemprop=keywords content="cypher,query language,dates,temporal,programming,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Cypher Sleuthing: Dealing with Dates, Part 5"><meta name=twitter:description content="From part 1 introducing Cypher dates and formats to part 4 where we combined duration functions and temporal components to translate amounts in one unit to another unit, we have covered a lot of ground in this series! Filling in the gaps, part 2 showed us how to truncate dates for searches and use durations for adding/subtracting amounts of time, and part 3 gave us an intro to temporal components and translations within component groups."></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://jmhreif.com/img/date-part-5/spyglass-laptop.jpeg)><div class="pb3-m pb6-l bg-black-60"><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Jennifer Reif</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/ title="Home page">Home</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blog/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/abstracts/ title="Abstracts page">Abstracts</a></li></ul><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">BLOG</aside><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/share?url=https://jmhreif.com/blog/cypher-sleuthing-dates-part5/&text=Cypher%20Sleuthing:%20Dealing%20with%20Dates,%20Part%205" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://jmhreif.com/blog/cypher-sleuthing-dates-part5/&title=Cypher%20Sleuthing:%20Dealing%20with%20Dates,%20Part%205" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div><h1 class="f1 athelas mt3 mb1">Cypher Sleuthing: Dealing with Dates, Part 5</h1><time class="f6 mv4 dib tracked" datetime=2021-08-10T09:00:00-06:00>August 10, 2021</time>
<span class="f6 mv4 dib tracked">- 11 minutes read</span>
<span class="f6 mv4 dib tracked">- 2140 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><div class=paragraph><p>From <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part1/ target=_blank rel=noopener>part 1</a> introducing Cypher dates and formats to <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part4/ target=_blank rel=noopener>part 4</a> where we combined duration functions and temporal components to translate amounts in one unit to another unit, we have covered a lot of ground in this series! Filling in the gaps, <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part2/ target=_blank rel=noopener>part 2</a> showed us how to truncate dates for searches and use durations for adding/subtracting amounts of time, and <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part3/ target=_blank rel=noopener>part 3</a> gave us an intro to temporal components and translations within component groups.</p></div><div class=paragraph><p>This post will be the final in the series. We will take a brief departure from Cypher temporals to the APOC library, where much of the temporal functionality for Neo4j began (before it was available in Cypher). Many of the original procedures and functions in the APOC library still exist, along with new ones that are not yet implemented in Cypher. This post will cover all the APOC temporal functionality and note which ones have been replaced by Cypher or are still uniquely provided by APOC.</p></div><div class=sect1><h2 id=_apoc_temporal_functions>APOC Temporal Functions</h2><div class=sectionbody><div class=paragraph><p>All the way back in our <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part1/ target=_blank rel=noopener>part 1 post</a>, we covered 4 APOC functions that could format epoch time (to any string and to an ISO8601 string), translate various string formats, and convert a string to a Neo4j (ISO8601) temporal. In the remainder of this post, we will briefly cover the rest of the existing <code>apoc.date.x</code> and <code>apoc.temporal.x</code> functions to explain their purpose and note which ones are replaced by ones in Cypher.</p></div><div class=paragraph><p>Let’s start our list! Ones that are crossed out were covered in the <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part1/ target=_blank rel=noopener>Part 1</a> post of this series.</p></div><div class="olist arabic"><ol class=arabic><li><p>apoc.date.add()</p></li><li><p>apoc.date.convert()</p></li><li><p><del>apoc.date.convertFormat()</del></p></li><li><p>apoc.date.currentTimestamp()</p></li><li><p>apoc.date.field()</p></li><li><p>apoc.date.fields()</p></li><li><p><del>apoc.date.format()</del></p></li><li><p>apoc.date.fromISO8601()</p></li><li><p>apoc.date.parse()</p></li><li><p>apoc.date.parseAsZonedDateTime()</p></li><li><p>apoc.date.systemTimezone()</p></li><li><p><del>apoc.date.toISO8601()</del></p></li><li><p>apoc.date.toYears()</p></li><li><p>apoc.temporal.format()</p></li><li><p>apoc.temporal.formatDuration()</p></li><li><p><del>apoc.temporal.toZonedTemporal()</del></p></li></ol></div><div class=sect2><h3 id=_apoc_date_add>apoc.date.add()</h3><div class=paragraph><p>This function adds or subtracts values from epoch time. Since we can work with epoch time in Cypher and add or subtract durations, then this functionality should all be available in Cypher. Here is an example.</p></div><div class=paragraph><p>Example: Cypher vs APOC epoch subtract time</p></div><div class=listingblock><div class=content><pre class=highlight><code>RETURN datetime({epochSeconds: 1626149356}) - duration(&#39;P1D&#39;) as cypher,
 apoc.date.add(1626149356,&#39;s&#39;,-1,&#39;d&#39;) as apoc;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-5/sleuth_date_part5_1.png alt="sleuth date part5 1"></div></div><div class=paragraph><p>Notice that the return type for Cypher is still a temporal value, while the return type for the APOC procedure is an epoch time. That is the only difference between the two.</p></div></div><div class=sect2><h3 id=_apoc_date_convert>apoc.date.convert()</h3><div class=paragraph><p>This function converts a time-based integer value from one format to another. For instance, we can convert 120 minutes to 2 hours. One difference to keep in mind is that Cypher’s version of using duration functions and components deals in duration syntax (strings with literal 'P' and 'T'), whereas APOC’s version deals entirely with integer math.</p></div><div class=paragraph><p>Example: Cypher vs APOC convert units</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (c:Conference)
RETURN duration.inSeconds(c.startDatetime, c.endDatetime).hours as cypher,
 apoc.date.convert(c.endDatetime.epochSeconds-c.startDatetime.epochSeconds,&#39;s&#39;,&#39;hours&#39;) as apoc;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-5/sleuth_date_part5_2.png alt="sleuth date part5 2"></div></div><div class=paragraph><p>This example is a bit trickier. If you are dealing within Neo4j and Cypher temporals, then the Cypher functionality is a bit less verbose (even though I’m still using Cypher temporal components to get the datetimes for subtraction). However, if I’m coming from an external source and already have an epoch value, then the APOC function is actually far simpler. Unless I’m missing something, I don’t believe Cypher can take an epoch value and convert it from seconds to hours at all.</p></div><div class=paragraph><p>So, whether you use Cypher or APOC here depends on your incoming value and desired output.</p></div></div><div class=sect2><h3 id=_apoc_date_currenttimestamp>apoc.date.currentTimestamp()</h3><div class=paragraph><p>This function might seem like the Cypher clock options might render APOC’s version obsolete. However, <code>apoc.date.currentTimestamp()</code> tracks the live time, which will update even inside of a transaction. Cypher’s currently will not.</p></div><div class=paragraph><p>There are several <a href=https://neo4j.com/labs/apoc/4.1/overview/apoc.date/apoc.date.currentTimestamp/ target=_blank rel=noopener>good examples</a> of this APOC function in the documentation, so I will allow you to explore those on your own.</p></div></div><div class=sect2><h3 id=_apoc_date_field>apoc.date.field()</h3><div class=paragraph><p>The <a href=https://neo4j.com/labs/apoc/4.1/overview/apoc.date/apoc.date.field/ target=_blank rel=noopener><code>apoc.date.field()</code> function</a> takes an Epoch time and retrieves the specified field. This can be replaced by Cypher using the epochMillis component to accept the input and using other components and/or functions to select the appropriate unit.</p></div><div class=paragraph><p>It’s easier to follow using an example.</p></div><div class=paragraph><p>Example: Cypher vs APOC select component from datetime</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH datetime() as datetime, datetime().epochMillis as epoch
RETURN datetime().hour as cypher,
 datetime({epochMillis: epoch}).hour as cypherEpoch,
 apoc.date.field(epoch, &#39;hours&#39;) as apocEpoch;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-5/sleuth_date_part5_3.png alt="sleuth date part5 3"></div></div><div class=paragraph><p>In this example, I’m showing Cypher’s functionality with both a Neo4j datetime input, as well as an epoch time input. Cypher’s syntax (second value in the return) is slightly more verbose, but still simple to understand. For this function, I think I would lean toward using the built-in Cypher functionality unless there is an edge case that Cypher won’t accept and APOC will.</p></div></div><div class=sect2><h3 id=_apoc_date_fields>apoc.date.fields()</h3><div class=paragraph><p>Similar to the previous function, <code>apoc.date.fields()</code> deals with components of the date, but it returns all of them as a map. While it is possible to do this in Cypher, it’s not built-in. Let’s take a look.</p></div><div class=paragraph><p>Example: Cypher vs APOC list all date fields as map</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH datetime() as d
RETURN { year: d.year, month: d.month, day: d.day, hour: d.hour, minute: d.minute, second: d.second } as cypher,
 apoc.date.fields(toString(d),&#34;YYYY-MM-dd&#39;T&#39;HH:mm:ss.SSS&#39;Z&#39;&#34;) as apoc;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-5/sleuth_date_part5_4.png alt="sleuth date part5 4"></div></div><div class=paragraph><p>The APOC function also takes a string value, which isn’t too difficult to convert with Cypher’s <code>toString()</code> function. However, if you already have a string value, remember that Cypher’s temporal functions (<code>datetime()</code>, <code>date()</code>, etc) will also accept strings, as long as they are in the ISO8601 format, so this would also be an easy conversion.</p></div></div><div class=sect2><h3 id=_apoc_date_fromiso8601>apoc.date.fromISO8601()</h3><div class=paragraph><p>With this function, we can take an ISO8601 string and convert it to epoch time. We are also able to do this with the built-in Cypher functionality. Let’s see what that looks like.</p></div><div class=paragraph><p>Example: Cypher vs APOC convert ISO8601 to epoch</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH datetime() as datetime
RETURN datetime.epochMillis as cypher,
 apoc.date.fromISO8601(toString(datetime)) as apoc;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-5/sleuth_date_part5_5.png alt="sleuth date part5 5"></div></div><div class=paragraph><p>Note that the APOC function automatically converts to epoch with milliseconds, where we can actually control whether we want seconds or milliseconds with Cypher’s <code>.epochMillis</code> or <code>.epochSeconds</code> components.</p></div></div><div class=sect2><h3 id=_apoc_date_parse>apoc.date.parse()</h3><div class=paragraph><p>This function takes a date string and converts it to a time unit - milliseconds, seconds, minutes, hours, or days. There isn’t currently a way to do this in Cypher, as the only way to convert from a date to a time unit is by calculating a duration between two dates and using the duration functions and components.</p></div><div class=paragraph><p>Example: Cypher vs APOC convert date to time</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH datetime() as d
RETURN duration.inSeconds(datetime(&#39;1970-01-01T00:00:00.000Z&#39;),d).hours as cypher,
 apoc.date.parse(toString(d),&#39;h&#39;,&#34;yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSS&#39;Z&#39;&#34;) as apoc;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-5/sleuth_date_part5_6.png alt="sleuth date part5 6"></div></div><div class=paragraph><p>This one was a bit cumbersome in Cypher. First, in order for me to translate to a different time unit, I had to use one of the duration functions (<code>inSeconds()</code>) to convert the years and years of time to something I could convert to hours (remember we have to use the function to get us to the proper component category from the left column in the <a href=https://neo4j.com/docs/cypher-manual/current/syntax/temporal/#cypher-temporal-accessing-components-durations target=_blank rel=noopener>Cypher manual table</a>). Those functions require two arguments - a start time and an end time to calculate duration between. Since I know the APOC is converting to epoch time, then I can use the start of <a href=https://en.wikipedia.org/wiki/Unix_time target=_blank rel=noopener>epoch time</a> as the starting date (1970-01-01T00:00:00.000Z). Once that duration is converted to seconds, I can use the <code>.hours</code> component to convert the whole value to hours.</p></div><div class=paragraph><p>Now, the APOC version is much simpler because it makes a couple of assumptions. First, since <code>apoc.date.parse()</code> converts a string to a time unit, the epoch start time is already used. Second, APOC does the conversion between larger durations behind the scenes, so I don’t need to specify component categories and such. I only need to specify the unit for output ('h' for hours).</p></div><div class=paragraph><p>To Cypher’s credit, it has to be flexible enough to handle a myriad of scenarios accurately with a few functions and components. However, if I was looking to make this specific kind of conversion, APOC is much simpler at this point in time.</p></div></div><div class=sect2><h3 id=_apoc_date_parseaszoneddatetime>apoc.date.parseAsZonedDateTime()</h3><div class=paragraph><p>This is similar to the <code>apoc.date.parse()</code> in that it parses a string to another value, but the output is actually going straight to an ISO8601 temporal value. This means we can take any type of string and pass its format and timezone and get a temporal value in return! You might ask how this would be different than passing a date string to Cypher’s temporal instants (e.g. <code>datetime('2021-07-19T09:45:00')</code>), but I’ll show that in just a minute.</p></div><div class=paragraph><p>Example: Cypher vs APOC convert string to ISO8601 temporal</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH &#39;2021-07-19T09:45:00-06:00&#39; as strDatetime
RETURN datetime(strDatetime) as cypher,
 apoc.date.parseAsZonedDateTime(strDatetime,&#34;yyyy-MM-dd&#39;T&#39;HH:mm:ss&#34;,&#34;-06:00&#34;) as apoc;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-5/sleuth_date_part5_7.png alt="sleuth date part5 7"></div></div><div class=paragraph><p>The results are different! This is because Cypher is making the assumption that the value you pass is the time for the timezone specified. The APOC function, however, is translating the value provided to the timezone specified, assuming that the value passed is UTC zone (+00:00).</p></div><div class=paragraph><p>Cypher and APOC calculate the same results if you remove timezone entirely - from the input string, as well as the 3rd argument in the APOC function call.</p></div></div><div class=sect2><h3 id=_apoc_date_systemtimezone>apoc.date.systemTimezone()</h3><div class=paragraph><p>This function returns the timezone of the local system, while Cypher’s pulls the database timezone, which is UTC by default. You can alter the database’s internal time with a configuration, if needed.</p></div><div class=paragraph><p>Example: Cypher vs APOC system timezone</p></div><div class=listingblock><div class=content><pre class=highlight><code>RETURN time().timezone as cypher,
 apoc.date.systemTimezone() as apoc;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-5/sleuth_date_part5_8.png alt="sleuth date part5 8"></div></div><div class=paragraph><p>Unless you were running this query in different systems across regions where all the configurations were still defaulted (you’d get all UTC for results), then the Cypher version is probably the better method.</p></div></div><div class=sect2><h3 id=_apoc_date_toyears>apoc.date.toYears()</h3><div class=paragraph><p>The <code>apoc.date.toYears()</code> function takes an epoch time and calculates the number of years since the start of epoch time (<code>1970-01-01T00:00:00Z</code>). There is currently no way to replicate this exactly in Cypher, as the APOC function returns a floating point number (precise calculation), while everything in Cypher converts to whole values only - no fractions. We can get close, though, so it depends on your use case. Let’s see it.</p></div><div class=paragraph><p>Example: Cypher vs APOC convert epoch time to years</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH datetime().epochMillis AS datetime
RETURN duration.inMonths(datetime(&#39;1970-01-01T00:00:00.000Z&#39;),datetime()).years as cypher,
 apoc.date.toYears(datetime) as apoc;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-5/sleuth_date_part5_9.png alt="sleuth date part5 9"></div></div></div><div class=sect2><h3 id=_apoc_temporal_format>apoc.temporal.format()</h3><div class=paragraph><p>Now that we’re in the <code>apoc.temporal.x</code> realm (rather than in <code>apoc.date.x</code>), we are dealing directly with temporal values as input and trying to get a different output. In the case of <code>apoc.temporal.format()</code>, we are trying to get a string in another format. There isn’t currently any way to replicate this in Cypher because Cypher does not output dates in other formats besides ISO8601.</p></div><div class=paragraph><p>Example: APOC format temporal to string</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH datetime() as datetime
RETURN apoc.temporal.format(datetime, &#39;yyyy-MM-dd HH:mm&#39;);</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-5/sleuth_date_part5_10.png alt="sleuth date part5 10"></div></div></div><div class=sect2><h3 id=_apoc_temporal_formatduration>apoc.temporal.formatDuration()</h3><div class=paragraph><p>I actually didn’t realize this existed until I was going through documentation. Similar to the function just above, you can also format durations into other units with this function. There are a couple of gotchas, though. While it will accept other duration formats (unit-based and date/time-based), I’m not sure on use cases for those particular durations. It won’t accept unit-based for a duration like <code>P05D</code> or <code>P1M</code>.</p></div><div class=paragraph><p>Example: Cypher vs APOC format duration</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH duration({minutes: 150}) as d
RETURN d.hours as cypher,
 apoc.temporal.formatDuration(d,&#39;hour&#39;);</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-5/sleuth_date_part5_11.png alt="sleuth date part5 11"></div></div><div class=paragraph><p>Note that the return for the APOC output is a 2-digit string value. This is specified in the <a href=https://www.elastic.co/guide/en/elasticsearch/reference/5.5/mapping-date-format.html#built-in-date-formats target=_blank rel=noopener>built-in formats</a>. There is also another example <a href=https://neo4j.com/labs/apoc/4.1/temporal/temporal-conversions/#_formatting_durations target=_blank rel=noopener>showing a use case</a> to calculate the difference between realtime and transaction time.</p></div></div></div></div><div class=sect1><h2 id=_wrapping_up>Wrapping up!</h2><div class=sectionbody><div class=paragraph><p>Throughout this series, we have taken a journey through nearly all aspects of temporal values related to Neo4j - both Cypher and APOC.</p></div><div class=paragraph><p>In our <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part1/ target=_blank rel=noopener>Part 1</a> post, we saw how complex programming for dates and times could actually be and how to create instants using functions like <code>date()</code>, <code>datetime()</code>, <code>time()</code>, etc. Temporal components also got a brief mention before we took a look at how to get to Neo4j-supported formats from epoch time and strings and capped our post with showing how to use multiple conversions in a single line. APOC saw some spotlight, as we relied on it for some of the conversions.</p></div><div class=paragraph><p>In our <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part2/ target=_blank rel=noopener>Part 2</a> post, we walked through truncating temporal types in Cypher and scratched the surface of creating basic durations, plus adding and subtracting them from dates. We then covered duration precision, which forms the foundation of most operations with durations. The last section of that post calculated differences between two dates with <code>duration.between()</code>.</p></div><div class=paragraph><p>In our <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part3/ target=_blank rel=noopener>Part 3</a> post, we did another quick review of temporal components (begun in Part 1), and then spent some time working through duration conversions using duration functions. Lastly, we talked about components again, showing which ones we could use based on the duration category (months, days, seconds).</p></div><div class=paragraph><p>In our <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part1/ target=_blank rel=noopener>Part 4</a> post, we saw how to combine duration functions and components in order to translate durations in one component category to another one. Then, we put our skills to the test with a couple of date puzzles.</p></div><div class=paragraph><p>In this post (Part 5!), we circled back to APOC for a step-by-step review of each date and temporal function in the library, making note of which ones are obsolete with functionality provided in Cypher or which are still valuable.</p></div><div class=paragraph><p>I hope this series has helped you understand Cypher temporals as much as it has for me. I’ve learned so much and asked so many questions. Thank you for taking this journey with me and happy coding!</p></div></div></div><div class=sect1><h2 id=_resources>Resources</h2><div class=sectionbody><div class=ulist><ul><li><p>Cypher Sleuthing: <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part1/ target=_blank rel=noopener>Part 1</a></p></li><li><p>Cypher Sleuthing: <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part2/ target=_blank rel=noopener>Part 2</a></p></li><li><p>Cypher Sleuthing: <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part3/ target=_blank rel=noopener>Part 3</a></p></li><li><p>Cypher Sleuthing: <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part4/ target=_blank rel=noopener>Part 4</a></p></li><li><p>APOC docs: <a href=https://neo4j.com/labs/apoc/4.1/temporal/ target=_blank rel=noopener>Temporal overview</a></p></li><li><p>APOC docs: <a href=https://neo4j.com/labs/apoc/4.1/overview/apoc.date/ target=_blank rel=noopener>Date functions</a></p></li><li><p>APOC docs: <a href=https://neo4j.com/labs/apoc/4.1/overview/apoc.temporal/ target=_blank rel=noopener>Temporal functions</a></p></li></ul></div></div></div><ul class=pa0><li class="list di"><a href=/tags/cypher class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">cypher</a></li><li class="list di"><a href=/tags/query-language class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">query language</a></li><li class="list di"><a href=/tags/dates class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">dates</a></li><li class="list di"><a href=/tags/temporal class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">temporal</a></li><li class="list di"><a href=/tags/programming class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">programming</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/blog/cypher-sleuthing-dates-part4/>Cypher Sleuthing: Dealing with Dates, Part 4</a></li><li class=mb2><a href=/blog/cypher-sleuthing-dates-part3/>Cypher Sleuthing: Dealing with Dates, Part 3</a></li><li class=mb2><a href=/blog/cypher-sleuthing-dates-part2/>Cypher Sleuthing: Dealing with Dates, Part 2</a></li><li class=mb2><a href=/blog/cypher-sleuthing-dates-part1/>Cypher Sleuthing: Dealing with Dates, Part 1</a></li><li class=mb2><a href=/blog/cypher-sleuthing-case-statement/>Cypher Sleuthing: the CASE statement</a></li><li class=mb2><a href=/blog/cypher-sleuthing-eager-operator/>Cypher Sleuthing: the EAGER operator</a></li><li class=mb2><a href=/blog/create-data-marvel-sdn/>Create a Data Marvel with Spring Data Neo4j</a></li><li class=mb2><a href=/blog/java-holds-its-own/>In the Language Wars, Java Holds Its Own</a></li></ul></div></aside></article></main><footer class="bg-dark-green bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://jmhreif.com/>&copy; Jennifer Reif 2022</a><div><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>