<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Cypher Sleuthing: Dealing with Dates, Part 1 | Jennifer Reif</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="No matter what database, programming language, or webpage you might be using, dates always seem to cause headaches. Different date formats require calculations between application date pickers in user-friendly formats and system dates in backend devices and data sources. Then, programming languages each have their own libraries and structures for dealing with dates, too.
This concept in the Neo4j ecosystem isn’t any less complex with Cypher (a graph query language) date formats, the APOC library date functions/procedures, and countless possible integration tools/APIs for data import and export."><meta name=generator content="Hugo 0.119.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><link rel=canonical href=https://jmhreif.com/blog/20210409-cypher-sleuthing-dates-part1/><meta property="og:title" content="Cypher Sleuthing: Dealing with Dates, Part 1"><meta property="og:description" content="No matter what database, programming language, or webpage you might be using, dates always seem to cause headaches. Different date formats require calculations between application date pickers in user-friendly formats and system dates in backend devices and data sources. Then, programming languages each have their own libraries and structures for dealing with dates, too.
This concept in the Neo4j ecosystem isn’t any less complex with Cypher (a graph query language) date formats, the APOC library date functions/procedures, and countless possible integration tools/APIs for data import and export."><meta property="og:type" content="article"><meta property="og:url" content="https://jmhreif.com/blog/20210409-cypher-sleuthing-dates-part1/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-04-09T12:00:00-06:00"><meta property="article:modified_time" content="2021-04-09T12:00:00-06:00"><meta itemprop=name content="Cypher Sleuthing: Dealing with Dates, Part 1"><meta itemprop=description content="No matter what database, programming language, or webpage you might be using, dates always seem to cause headaches. Different date formats require calculations between application date pickers in user-friendly formats and system dates in backend devices and data sources. Then, programming languages each have their own libraries and structures for dealing with dates, too.
This concept in the Neo4j ecosystem isn’t any less complex with Cypher (a graph query language) date formats, the APOC library date functions/procedures, and countless possible integration tools/APIs for data import and export."><meta itemprop=datePublished content="2021-04-09T12:00:00-06:00"><meta itemprop=dateModified content="2021-04-09T12:00:00-06:00"><meta itemprop=wordCount content="1788"><meta itemprop=keywords content="cypher,query language,dates,temporal,programming,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Cypher Sleuthing: Dealing with Dates, Part 1"><meta name=twitter:description content="No matter what database, programming language, or webpage you might be using, dates always seem to cause headaches. Different date formats require calculations between application date pickers in user-friendly formats and system dates in backend devices and data sources. Then, programming languages each have their own libraries and structures for dealing with dates, too.
This concept in the Neo4j ecosystem isn’t any less complex with Cypher (a graph query language) date formats, the APOC library date functions/procedures, and countless possible integration tools/APIs for data import and export."></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://jmhreif.com/img/date-part-1/laptop_spyglass.jpeg)><div class=bg-black-60><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Jennifer Reif</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/ title="Home page">Home</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blog/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/abstracts/ title="Abstracts page">Abstracts</a></li></ul><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank rel=noopener class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank rel=noopener class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank rel=noopener class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank rel=noopener class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.podbean.com/ target=_blank rel=noopener class="podcast ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="podcast link" aria-label="follow on podcast——Opens in a new window">podcast
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked ttu">Blog</aside><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/intent/tweet?url=https://jmhreif.com/blog/20210409-cypher-sleuthing-dates-part1/&amp;text=Cypher%20Sleuthing:%20Dealing%20with%20Dates,%20Part%201" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://jmhreif.com/blog/20210409-cypher-sleuthing-dates-part1/&amp;title=Cypher%20Sleuthing:%20Dealing%20with%20Dates,%20Part%201" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div><h1 class="f1 athelas mt3 mb1">Cypher Sleuthing: Dealing with Dates, Part 1</h1><time class="f6 mv4 dib tracked" datetime=2021-04-09T12:00:00-06:00>April 9, 2021</time>
<span class="f6 mv4 dib tracked">- 9 minutes read</span>
<span class="f6 mv4 dib tracked">- 1788 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><div class=paragraph><p>No matter what database, programming language, or webpage you might be using, dates always seem to cause headaches. Different date formats require calculations between application date pickers in user-friendly formats and system dates in backend devices and data sources. Then, programming languages each have their own libraries and structures for dealing with dates, too.</p></div><div class=paragraph><p>This concept in the Neo4j ecosystem isn’t any less complex with <a href=https://neo4j.com/developer/cypher/ target=_blank rel=noopener>Cypher</a> (a graph query language) date formats, the <a href=https://neo4j.com/labs/apoc/ target=_blank rel=noopener>APOC library</a> date functions/procedures, and countless possible integration tools/APIs for data import and export. I feel like I’m always looking at documentation and dealing with lots of trial and error in order to format the date just right. You may have heard about <a href=https://www.oreilly.com/library/view/spring-boot-up/9781492076971/ch01.html target=_blank rel=noopener>"dependency whack-a-mole"</a>, but dates are another aspect of programming that seems to use whack-a-mole, too.</p></div><div class=paragraph><p>In this post, I will do my best to provide you with the tools for less random whacking and more accurate decision making when it comes to formatting dates with Cypher. Let’s dive in!</p></div><div class=sect1><h2 id=_time_conundrum>Time conundrum</h2><div class=sectionbody><div class=paragraph><p>The general concept of time is rather confusing, and one that I did not realize was quite so complex. There have been quite a number of humorous and eye-opening content around time being the programmer’s nightmare. Why is that?</p></div><div class=paragraph><p>First, standard measures of time aren’t always true. The number of hours in a day can vary depending on daylight savings time (and geographies changing at different points during the year), days in a month can vary by month and due to leap years, and weeks in a year can vary depending on the day of the week Jan 1st falls on. Time zones are another matter entirely. Countries change time zones somewhat frequently and different eras in the past had entirely different calendars and time zone structures.</p></div><div class=paragraph><p>There is a humorous and sobering comprehensive list of <a href=https://gist.github.com/timvisee/fcda9bbdff88d45cc9061606b4b923ca target=_blank rel=noopener>one programmer’s experiences</a> of time variance, as well as an entertaining video on <a href="https://www.youtube.com/watch?v=-5wpm-gesOY" target=_blank rel=noopener>time zones from a programmer’s point of view</a>. It was very valuable and educational for me to see how much time can morph, making it exceptionally complicated to calculate and present a consistently accurate measure of time. Also, thank you to my colleagues <a href=https://twitter.com/rotnroll666 target=_blank rel=noopener>@rotnroll666</a> and <a href=https://twitter.com/mdavidallen target=_blank rel=noopener>@mdavidallen</a> for those links. :)</p></div></div></div><div class=sect1><h2 id=_cypher_dates>Cypher dates</h2><div class=sectionbody><div class=paragraph><p>Let’s start at the base with Cypher date formats. For this, we can go to the <a href=https://neo4j.com/docs/cypher-manual/current/ target=_blank rel=noopener>official Cypher manual</a> and take a look at the two different sections that cover dates. The first section is for the <a href=https://neo4j.com/docs/cypher-manual/current/syntax/temporal/ target=_blank rel=noopener>date and temporal data types</a> themselves. The second section is for <a href=https://neo4j.com/docs/cypher-manual/current/functions/temporal/ target=_blank rel=noopener>instant</a> and <a href=https://neo4j.com/docs/cypher-manual/current/functions/temporal/duration/ target=_blank rel=noopener>duration</a> calculations using functions. We’ll stick with just the instants today and worry about durations and date truncations in another post.</p></div><div class=paragraph><p>The date and temporal data types in Cypher are based on the <a href=https://en.wikipedia.org/wiki/ISO_8601 target=_blank rel=noopener>ISO 8601</a> date format. It supports 3 different categories of time - date, time, and timezone. Within those 3 categories are the instant types <code>Date</code>, <code>Time</code>, <code>Datetime</code>, <code>LocalTime</code>, and <code>LocalDatetime</code>. There are also 3 ways to specify timezone - 1) with the number of hours offset from UTC (e.g. -06:00), 2) with a <a href=https://en.wikipedia.org/wiki/List_of_tz_database_time_zones target=_blank rel=noopener>named timezone</a> (e.g. <code>[America/Chicago]</code>), 3) with the offset and name (e.g. <code>-0600[America/Chicago]</code>).</p></div><div class=paragraph><p>For this blog post, we won’t explore the <code>LocalTime</code> and <code>LocalDatetime</code> types. These types are the exception to most rules and are very rarely required because they leave valuable timezone information out of the temporal value.</p></div><div class=paragraph><p>Alright, let’s stop discussing concepts and see Cypher temporal types in action. We will create a few different dates using the instant types, then handle some timezone examples.</p></div><div class=paragraph><p>Example 1: Setting a node property to current datetime</p></div><div class=listingblock><div class=content><pre class=highlight><code>MERGE (b:BlogPost)
  SET b.publishedDatetime = datetime()
RETURN b.publishedDatetime;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-1/sleuth_date_part1_1.png alt="sleuth date part1 1"></div></div><div class=paragraph><p><em>NOTE: You might notice that there is a literal <code>'T'</code> between the date and time values. This vital little connector is easily forgotten and something we’ll need to keep in mind when we start doing translations and conversions with other formats!</em></p></div><div class=paragraph><p>Example 2: Setting a relationship property where date value equals a specific string</p></div><div class=listingblock><div class=content><pre class=highlight><code>MERGE (e:Employee)-[rel:ASSIGNED]-&gt;(p:Project)
  SET rel.startDate = date(&#39;2021-02-15&#39;)
RETURN rel.startDate;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-1/sleuth_date_part1_2.png alt="sleuth date part1 2"></div></div><div class=paragraph><p>Example 3: Setting a node property to time with time zone</p></div><div class=listingblock><div class=content><pre class=highlight><code>MERGE (s:Speaker {username: &#39;jmhreif&#39;})-[rel:PRESENTS]-&gt;(p:Presentation)
  SET p.time = time(&#39;09:30:00-06:00&#39;)
RETURN p.time;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-1/sleuth_date_part1_3.png alt="sleuth date part1 3"></div></div><div class=paragraph><p>Example 4: Setting a node property to full date time (with time zone)</p></div><div class=listingblock><div class=content><pre class=highlight><code>MERGE (c:Conference)
  SET c.startDatetime = datetime(&#39;2021-03-01T08:00:00-05:00&#39;)
RETURN c.startDatetime;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-1/sleuth_date_part1_4.png alt="sleuth date part1 4"></div></div><div class=paragraph><p>To round out our instant types section, you can specify the date as parameters to the instant, and you can also access individual pieces of the instant. I haven’t run across cases where the parameter-like definition of the date is required, but it is available nonetheless.</p></div><div class=paragraph><p>Here are a couple of examples.</p></div><div class=paragraph><p>Example 5: Setting date property using parameter-style format</p></div><div class=listingblock><div class=content><pre class=highlight><code>MERGE (p:Project)
  SET p.expectedEndDate = date({year: 2021, month: 9, day: 30})
RETURN p.expectedEndDate;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-1/sleuth_date_part1_5.png alt="sleuth date part1 5"></div></div><div class=paragraph><p>Example 6: Setting date using date component</p></div><div class=listingblock><div class=content><pre class=highlight><code>MERGE (c:Conference)
  SET c.year = date().year
RETURN c.year</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-1/sleuth_date_part1_6.png alt="sleuth date part1 6"></div></div><div class=paragraph><p>Example 7: Find blog posts published in March</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (b:BlogPost)
WHERE b.publishedDatetime.month = 3
RETURN b.publishedDatetime;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-1/sleuth_date_part1_7.png alt="sleuth date part1 7"></div></div><div class=paragraph><p>Example 8: Return date component (dayOfWeek) of created node</p></div><div class=listingblock><div class=content><pre class=highlight><code>MERGE (b:BlogPost)
  SET b.publishedDatetime = datetime()
RETURN b.publishedDatetime.dayOfWeek;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-1/sleuth_date_part1_8.png alt="sleuth date part1 8"></div></div><div class=paragraph><p><em>NOTE: <code>dayOfWeek</code> has Monday as the start of the week. Since I’m writing this on Tuesday, these results are accurate. :)</em></p></div></div></div><div class=sect1><h2 id=_getting_to_neo4j_supported_date_formats>Getting to Neo4j-supported date formats</h2><div class=sectionbody><div class=paragraph><p>Now, these are great if you have a date/time value that is already formatted for ISO 8601. But what happens when you don’t? How do you translate a date into something Cypher will understand and Neo4j will store?</p></div><div class=paragraph><p>In this post, we will stick to what is probably the common temporal measurements - i.e. using year, month, day, hour, minute, second. For weeks, quarters, milliseconds, and so on, check out the <a href=https://neo4j.com/docs/cypher-manual/current/syntax/temporal/#cypher-temporal-specify-date target=_blank rel=noopener>docs</a>. Also, recall that a literal <code>T</code> character is required between date and time in a combined value, so we’ll have to keep that in mind.</p></div><div class=paragraph><p>We will look at the following scenarios to get the dates converted to values Neo4j and Cypher can read:</p></div><div class="olist arabic"><ol class=arabic><li><p>Epoch time (value formatted as seconds or milliseconds)</p></li><li><p>Other date string formats (<code>yyyy-mm-dd hh:mm:ss</code> and similar)</p></li><li><p>Multi-conversions (to string, then to Neo4j date in one line)</p></li></ol></div><div class=sect2><h3 id=_epoch_time>Epoch time</h3><div class=paragraph><p>The website <a href=https://www.epochconverter.com/ target=_blank rel=noopener>epochconverter.com</a> defines epoch time as follows:</p></div><div class=quoteblock><blockquote><div class=paragraph><p><em>“the Unix epoch (or Unix time or POSIX time or Unix timestamp) is the number of seconds that have elapsed since January 1, 1970 (midnight UTC/GMT), not counting leap seconds (in ISO 8601: 1970-01-01T00:00:00Z)”.</em></p></div></blockquote></div><div class=paragraph><p>This website is really easy to use, and I visit it quite frequently for adhoc conversions or example dates to use.</p></div><div class=paragraph><p>As an example of epoch time and other date formats, here is the same date in three formats.</p></div><div class=ulist><ul><li><p>Human-readable: <code>Monday, March 1, 2021 12:00:00 AM</code></p></li><li><p>ISO 8601: <code>2021-03-01T00:00:00Z</code></p></li><li><p>Epoch time (seconds): <code>1614556800</code></p></li></ul></div><div class=paragraph><p>Cypher does have the capability to convert epoch values for certain cases, though the syntax is a bit different than the conventions we’ve seen thus far. For other types of formats, we will go to the <a href=https://neo4j.com/labs/apoc/ target=_blank rel=noopener>APOC library</a>, which is a very popular extension for Neo4j containing procedures and functions for many different utilities.</p></div><div class=paragraph><p>Ok, let’s see some examples of how to programmatically convert epoch time. We will use our example epoch time from above (<code>1614556800</code>, which is <code>March 1, 2021 12:00:00 AM</code>), just to keep things simple and consistent. We will show the results of the converted value, as well as the final converted Neo4j temporal value next to it.</p></div><div class=paragraph><p>Example 1: Epoch to datetime using Cypher</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH 1614556800 as epochTime
RETURN datetime({epochSeconds: epochTime});</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-1/sleuth_date_part1_9.png alt="sleuth date part1 9"></div></div><div class=paragraph><p>Example 2: Epoch to date string using apoc.date.format()</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH apoc.date.format(1614556800, &#34;s&#34;, &#34;yyyy-MM-dd&#34;) as converted
RETURN converted, date(converted);</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-1/sleuth_date_part1_10.png alt="sleuth date part1 10"></div></div><div class=paragraph><p>Now, because epoch time is a date and time in a seconds format (time-based), we are unable to convert straight from epoch time to a date. However, we could either store as a datetime and return date portions for queries….or we could use APOC to get our date!</p></div><div class=paragraph><p>Note, also, that we have included a literal <code>T</code> between the date and time values for the third parameter in the query above. To put the single quotes in the middle of that string for the <code>T</code>, we have to use double quotes around the entire format string (<code>“yyyy-MM-dd’T’HH:mm:ss”</code>).</p></div><div class=paragraph><p>Example 3: Epoch to ISO 8601 format using apoc.date.toISO8601()</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH apoc.date.toISO8601(1614556800,&#39;s&#39;) as converted
RETURN converted, datetime(converted);</code></pre></div></div><div class=paragraph><p><span class=image><img src=/img/date-part-1/sleuth_date_part1_11.png alt="sleuth date part1 11"></span></p></div></div><div class=sect2><h3 id=_other_date_string_formats>Other date string formats</h3><div class=paragraph><p>Now we know how to convert Unix-based epoch time, but what about strings in all different kinds of formats? How do we translate them to something Cypher will read? Cypher does accept strings and can convert strings in the ISO 8601 format to a temporal value, so we just need to convert a variety of string values to an <code>ISO 8601</code> string format. We can do that using <code>apoc.date.convertFormat()</code>.</p></div><div class=paragraph><p>All of the possible formats in the procedure’s third parameter below are listed <a href=https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/format/DateTimeFormatter.html target=_blank rel=noopener>here</a>.</p></div><div class=paragraph><p>Example 4: Similar date format to ISO 8601 string</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH apoc.date.convertFormat(&#39;2021-03-01 00:00:00&#39;, &#39;yyyy-MM-dd HH:mm:ss&#39;, &#39;iso_date_time&#39;) as converted
RETURN converted, datetime(converted);</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-1/sleuth_date_part1_12.png alt="sleuth date part1 12"></div></div><div class=paragraph><p>Example 5: American date format to ISO 8601 string</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH apoc.date.convertFormat(&#39;03/01/2021&#39;, &#39;MM/dd/yyyy&#39;, &#39;iso_date&#39;) as converted
RETURN converted, date(converted);</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-1/sleuth_date_part1_13.png alt="sleuth date part1 13"></div></div><div class=paragraph><p>Finally, there are a few APOC procedures that deal directly with temporal values. Only one goes to a Neo4j date format, though, and it transforms a string to a temporal.</p></div><div class=paragraph><p>Example 6: Datetime string to Neo4j datetime</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH apoc.temporal.toZonedTemporal(&#39;2021-03-01 00:00:00&#39;, &#39;yyyy-MM-dd HH:mm:ss&#39;) as converted
RETURN converted, datetime(converted);</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-1/sleuth_date_part1_14.png alt="sleuth date part1 14"></div></div><div class=paragraph><p>Notice that both the results are the same, showing that the <code>apoc.temporal.toZonedTemporal</code> function transforms to the same value as using a Cypher <code>datetime()</code> function.</p></div></div><div class=sect2><h3 id=_multi_conversions>Multi-conversions</h3><div class=paragraph><p>Ok, so we have done several conversions that translate strings or epoch times to strings, but that doesn’t always get us to the Neo4j date. In order to do that, we can wrap our converted value in another conversion function. This isn’t really different from what we’ve seen before, but they can get convoluted and you might think "you can do that?". Yes, yes, you can. :)</p></div><div class=paragraph><p>Let’s take a look!</p></div><div class=paragraph><p>Example 7 (from Example 1 above): Convert epoch time to string and then to datetime</p></div><div class=listingblock><div class=content><pre class=highlight><code>RETURN datetime(apoc.date.format(1614556800, &#34;s&#34;, &#34;yyyy-MM-dd&#39;T&#39;HH:mm:ss&#34;));</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-1/sleuth_date_part1_15.png alt="sleuth date part1 15"></div></div><div class=paragraph><p>Example 8: Convert date from Twitter API to Neo4j datetime</p></div><div class=listingblock><div class=content><pre class=highlight><code>RETURN datetime(apoc.date.convertFormat(&#39;Mon Mar 01 00:00:00 -0000 2021&#39;, &#39;EEE LLL dd HH:mm:ss Z yyyy&#39;, &#39;iso_date_time&#39;));</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-1/sleuth_date_part1_16.png alt="sleuth date part1 16"></div></div><div class=paragraph><p>For a reference to the letters in that date format, the documentation is <a href=https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/format/DateTimeFormatter.html target=_blank rel=noopener>here</a> (under Patterns for formatting and parsing).</p></div></div></div></div><div class=sect1><h2 id=_wrapping_up>Wrapping up</h2><div class=sectionbody><div class=paragraph><p>In this post, we covered most of the Neo4j-supported temporal instant types - <code>date()</code>, <code>datetime()</code>, <code>time()</code> - for creating the values either from a current instant or from an ISO8601-formatted string. We then saw how to use the utility functions in the APOC library to transform epoch Unix time values and strings in non-ISO8601 formats into strings or temporal values Cypher can work with.</p></div><div class=paragraph><p>There is so much more to explore on the topic of Neo4j dates. Next time, we will discuss Cypher durations for calculating the time between two instants or for adding/subtracting dates and amounts from temporal values.</p></div><div class=paragraph><p>Until then, happy coding!</p></div></div></div><div class=sect1><h2 id=_resources>Resources</h2><div class=sectionbody><div class=paragraph><p>Cypher manual: <a href=https://neo4j.com/docs/cypher-manual/current/syntax/temporal/ target=_blank rel=noopener>Temporal instants</a>
APOC documentation: <a href=https://neo4j.com/labs/apoc/4.2/temporal/datetime-conversions/ target=_blank rel=noopener>Datetime conversions</a></p></div></div></div><ul class=pa0><li class="list di"><a href=/tags/cypher/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">cypher</a></li><li class="list di"><a href=/tags/query-language/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">query language</a></li><li class="list di"><a href=/tags/dates/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">dates</a></li><li class="list di"><a href=/tags/temporal/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">temporal</a></li><li class="list di"><a href=/tags/programming/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">programming</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/blog/cypher-sleuthing-dates-part1/>Cypher Sleuthing: Dealing with Dates, Part 1</a></li><li class=mb2><a href=/blog/20190724-cypher-sleuthing-case-statement/>Cypher Sleuthing: the CASE statement</a></li><li class=mb2><a href=/blog/cypher-sleuthing-case-statement/>Cypher Sleuthing: the CASE statement</a></li><li class=mb2><a href=/blog/20190724-cypher-sleuthing-eager-operator/>Cypher Sleuthing: the EAGER operator</a></li><li class=mb2><a href=/blog/cypher-sleuthing-eager-operator/>Cypher Sleuthing: the EAGER operator</a></li><li class=mb2><a href=/blog/java-holds-its-own/>In the Language Wars, Java Holds Its Own</a></li></ul></div></aside></article></main><footer class="bg-dark-green bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://jmhreif.com/>&copy; Jennifer Reif 2024</a><div><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank rel=noopener class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank rel=noopener class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank rel=noopener class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank rel=noopener class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.podbean.com/ target=_blank rel=noopener class="podcast ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="podcast link" aria-label="follow on podcast——Opens in a new window">podcast
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>