<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Cypher Sleuthing: Dealing with Dates, Part 4 | Jennifer Reif</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Photo credit *Updated Dec 15, 2021
My previous part 1, part 2, and part 3 posts on this topic introduced Cypher dates, translated formats to the Cypher-supported ISO 8601 format, calculated durations, accessed components, and translated durations to certain values.
If you read those, then this post is the next post showing how to convert durations across component categories. If you haven’t read the previous posts leading up to this one, feel free to catch up (recommend at least Part 3 as this post’s prequel) - though it isn’t required."><meta name=generator content="Hugo 0.119.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><link rel=canonical href=https://jmhreif.com/blog/20210727-cypher-sleuthing-dates-part4/><meta property="og:title" content="Cypher Sleuthing: Dealing with Dates, Part 4"><meta property="og:description" content="Photo credit *Updated Dec 15, 2021
My previous part 1, part 2, and part 3 posts on this topic introduced Cypher dates, translated formats to the Cypher-supported ISO 8601 format, calculated durations, accessed components, and translated durations to certain values.
If you read those, then this post is the next post showing how to convert durations across component categories. If you haven’t read the previous posts leading up to this one, feel free to catch up (recommend at least Part 3 as this post’s prequel) - though it isn’t required."><meta property="og:type" content="article"><meta property="og:url" content="https://jmhreif.com/blog/20210727-cypher-sleuthing-dates-part4/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-07-27T12:00:00-06:00"><meta property="article:modified_time" content="2021-07-27T12:00:00-06:00"><meta itemprop=name content="Cypher Sleuthing: Dealing with Dates, Part 4"><meta itemprop=description content="Photo credit *Updated Dec 15, 2021
My previous part 1, part 2, and part 3 posts on this topic introduced Cypher dates, translated formats to the Cypher-supported ISO 8601 format, calculated durations, accessed components, and translated durations to certain values.
If you read those, then this post is the next post showing how to convert durations across component categories. If you haven’t read the previous posts leading up to this one, feel free to catch up (recommend at least Part 3 as this post’s prequel) - though it isn’t required."><meta itemprop=datePublished content="2021-07-27T12:00:00-06:00"><meta itemprop=dateModified content="2021-07-27T12:00:00-06:00"><meta itemprop=wordCount content="2120"><meta itemprop=keywords content="cypher,query language,dates,temporal,programming,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Cypher Sleuthing: Dealing with Dates, Part 4"><meta name=twitter:description content="Photo credit *Updated Dec 15, 2021
My previous part 1, part 2, and part 3 posts on this topic introduced Cypher dates, translated formats to the Cypher-supported ISO 8601 format, calculated durations, accessed components, and translated durations to certain values.
If you read those, then this post is the next post showing how to convert durations across component categories. If you haven’t read the previous posts leading up to this one, feel free to catch up (recommend at least Part 3 as this post’s prequel) - though it isn’t required."></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://jmhreif.com/img/date-part-4/code-dream-reality.jpeg)><div class=bg-black-60><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Jennifer Reif</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/ title="Home page">Home</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blog/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/abstracts/ title="Abstracts page">Abstracts</a></li></ul><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank rel=noopener class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank rel=noopener class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank rel=noopener class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank rel=noopener class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked ttu">Blog</aside><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/intent/tweet?url=https://jmhreif.com/blog/20210727-cypher-sleuthing-dates-part4/&amp;text=Cypher%20Sleuthing:%20Dealing%20with%20Dates,%20Part%204" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://jmhreif.com/blog/20210727-cypher-sleuthing-dates-part4/&amp;title=Cypher%20Sleuthing:%20Dealing%20with%20Dates,%20Part%204" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div><h1 class="f1 athelas mt3 mb1">Cypher Sleuthing: Dealing with Dates, Part 4</h1><time class="f6 mv4 dib tracked" datetime=2021-07-27T12:00:00-06:00>July 27, 2021</time>
<span class="f6 mv4 dib tracked">- 10 minutes read</span>
<span class="f6 mv4 dib tracked">- 2120 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><div class=paragraph><small><i><a href="https://unsplash.com/photos/mo4UZiHy_KU?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditShareLink">Photo credit</a></i></small></div><div class=paragraph><p><em>*Updated Dec 15, 2021</em></p></div><div class=paragraph><p>My previous <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part1/ target=_blank rel=noopener>part 1</a>, <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part2/ target=_blank rel=noopener>part 2</a>, and <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part3/ target=_blank rel=noopener>part 3</a> posts on this topic introduced Cypher dates, translated formats to the Cypher-supported ISO 8601 format, calculated durations, accessed components, and translated durations to certain values.</p></div><div class=paragraph><p>If you read those, then this post is the next post showing how to convert durations across component categories. If you haven’t read the previous posts leading up to this one, feel free to catch up (recommend at least Part 3 as this post’s prequel) - though it isn’t required. 🙂</p></div><div class=paragraph><p>In our <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part3/ target=_blank rel=noopener>Part 3</a> post, we covered three duration categories (and related functions) for converting duration values to whole values - Months, Days, Seconds. We also looked at components and how to use them to access other values outside of those months, days, and seconds. In this post, we will combine the three duration functions along with various components to translate values from a unit in one category to a unit in another category. Then, we will take a look at a couple of fun puzzles having to do with Cypher and dates to close up the post.</p></div><div class=sect1><h2 id=_rewind_quick_catchup>Rewind: Quick catchup</h2><div class=sectionbody><div class=paragraph><p>Let’s review a couple of principles on duration categories and components from our last post before we dive into using them together. There are 3 component groups (shown again in the screenshot below), and these form the foundation for duration units and conversions.</p></div><div class=imageblock><div class=content><img src=/img/date-part-4/sleuth_date_part4_1.png alt="sleuth date part4 1"></div></div><div class=paragraph><p>Table can be found in the <a href=https://neo4j.com/docs/cypher-manual/current/syntax/temporal/#cypher-temporal-accessing-components-durations target=_blank rel=noopener>Cypher manual section</a>.</p></div><div class=paragraph><p>As a reminder: the column on the right is the key - values in one column can be converted to any other unit in that same cell, but not another row. For instance, I could convert a duration from days to weeks, but not to months or minutes. Notice, also, that these categories correspond to our duration functions of <code>inMonths()</code>, <code>inDays()</code>, and <code>inSeconds()</code>, which we will discuss in this post! Finally, here are the rules I discovered for the Cypher component groups.</p></div><div class="olist arabic"><ol class=arabic><li><p>You can only convert among units in a component grouping, not across groups.</p></li><li><p>There must be whole values to convert to larger units. Components do not mix whole and fraction values (i.e. <code>36 hours</code> → <code>1.5 days</code>). There are specific components that handle whole values of the unit, and there are separate components that handle only fractions of the unit.</p></li></ol></div><div class=imageblock><div class=content><img src=/img/date-part-4/sleuth_date_part4_clocks.jpeg alt="sleuth date part4 clocks"></div></div><div class=paragraph><small><i><a href="https://unsplash.com/photos/mo4UZiHy_KU?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditShareLink">Photo credit</a></i></small></div><div class=paragraph><p>Now, per our rules, we are limited in expressing certain durations as numbers that aren’t easy to understand or read. For instance, saying that my flight leaves in <code>28 hours</code> (while precise) probably triggers a mental calculation to <code>1 day 4 hours</code>. Because our brains are used to allocating resources into the largest buckets first, then remainders into smaller categories, our perception of time and planning seems to operate better in these formats.</p></div><div class=paragraph><p>As another example, most things operate on a 12-hour clock (3:00pm), except for where precision matters. In those cases, you will see a 24-hour clock (15:00). But telling a random person on the street that the time is <code>fifteen hundred</code> will most likely return confused looks. Think smaller numbers, larger units (1 day vs 24 hours, 2 months vs 60 days, etc).</p></div><div class=paragraph><p>Ok, so how can we translate some of these larger-number-smaller-unit values into something more easily understood by others? Earlier, I mentioned that the duration categories (Months, Days, Seconds) align with the duration functions (<code>inMonths()</code>, <code>inDays()</code>, <code>inSeconds()</code>). This is to allow conversions across component groups!</p></div></div></div><div class=sect1><h2 id=_combining_duration_functions_and_components>Combining Duration functions and components</h2><div class=sectionbody><div class=paragraph><p>Using durations functions with components means we can convert our duration values from one component category into another, and then translate among the components within that group.</p></div><div class=imageblock><div class=content><img src=/img/date-part-4/sleuth_date_part4_groups.png alt="sleuth date part4 groups"></div></div><div class=paragraph><p>Note that precision may not always be 100% accurate, as days in a month or hours in a day are not consistent throughout the year. However, the conversions use general standards (30 days in a month, 24 hours in a day).</p></div><div class=paragraph><p>Let’s expand the power of converting durations across categories by combining functions and components!</p></div><div class=paragraph><p>Example 1: Translate duration from months/days to weeks/days</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (v:Vacation)
RETURN
duration.between(date(),v.startDate) as preciseDuration,
duration.inDays(date(),v.startDate).weeks as weeks,
duration.inDays(date(),v.startDate).daysOfWeek as daysOfWeek;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-4/sleuth_date_part4_2.png alt="sleuth date part4 2"></div></div><div class=paragraph><p>In our example above, we are translating a duration in months and days into days and weeks. First, we need to calculate the entire value into days using the <code>duration.inDays()</code> method. Then, we can access the weeks and days components from that.</p></div><div class=paragraph><p>Note that, depending on the input dates (and year), the results can vary - i.e. durations with those same dates but in a leap year or from June 30-Sept 1 that includes two consecutive months with 31 days each.</p></div><div class=paragraph><p>Let’s take another example!</p></div><div class=paragraph><p>Example 2: Calculate projected hours a resource works on a project</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (:Employee)-[rel:ASSIGNED]-(p:Project)
RETURN duration.between(rel.startDate, p.expectedEndDate) as lengthAssigned,
 duration.inSeconds(rel.startDate, p.expectedEndDate).hours as lengthInHours;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-4/sleuth_date_part4_3.png alt="sleuth date part4 3"></div></div><div class=paragraph><p>You might respond that this assumes an employee spent 24 hours per day and 7 days per week on a project, right? You would be correct! Let’s correct this, since our <code>lengthInHours</code> value is now just a number and not a duration value.</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (:Employee)-[rel:ASSIGNED]-(p:Project)
RETURN duration.between(rel.startDate, p.expectedEndDate) as lengthAssigned,
 duration.inDays(rel.startDate, p.expectedEndDate).weeks as lengthInWeeks,
 duration.inDays(rel.startDate, p.expectedEndDate).weeks * 40 as projectHours;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-4/sleuth_date_part4_4.png alt="sleuth date part4 4"></div></div><div class=paragraph><p>Notice that in order to get the project hours, I took the approach to find the total number of weeks for the project, then calculate the number of hours per week worked (assuming a 40hr work week and 100% allocation of the resource). Now, this number may not be the actual total of the completed project, but would definitely be a good estimate number.</p></div><div class=paragraph><p>Switching gears just a bit, infant age is always confusing to me because some people go by weeks, months, or years (e.g. baby is 14 months old…cue math calculation in brain). Let’s let Cypher do the work.</p></div><div class=paragraph><p>Example 2: Calculate age of infant</p></div><div class=listingblock><div class=content><pre class=highlight><code>MERGE (b:Baby)
SET b.dateOfBirth = date(&#39;2021-02-28&#39;)
RETURN b.dateOfBirth,
 duration.between(b.dateOfBirth, date()) as age,
 duration.inMonths(b.dateOfBirth, date()).months as months,
 duration.inDays(date(&#39;2021-02-28&#39;),date()).weeks as weeks;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-4/sleuth_date_part4_5.png alt="sleuth date part4 5"></div></div><div class=paragraph><p>In the code above, we set the baby’s birthdate as <code>February 28, 2021</code>, then in the return statement, calculate the baby’s age by precise duration, months, and weeks. In order to get months, we calculate the duration directly to months with the <code>inMonths()</code> function. Then, to get weeks, we first need to convert to the days/weeks category using the <code>inDays()</code> function, then grab the component for weeks. No more mental calculation!</p></div><div class=paragraph><p>We could be even more specific with the components to preserve remainder values.</p></div><div class=paragraph><p>Example 3: Calculate age of infant with remainder units</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (b:Baby)
RETURN b.dateOfBirth,
 duration.between(b.dateOfBirth, date()) as age,
 duration.inDays(b.dateOfBirth,date()).weeks as weeks,
 duration.inDays(b.dateOfBirth,date()).daysOfWeek as daysOfWeek;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-4/sleuth_date_part4_6.png alt="sleuth date part4 6"></div></div><div class=paragraph><p>We could use this in a baby tracker app to tell us that a baby is exactly <code>41 weeks and 3 days old</code>. This could also be used for more precision on a product/application being live, amount of time without incidents, or many other use cases!</p></div></div></div><div class=sect1><h2 id=_cypher_puzzles>Cypher puzzles</h2><div class=sectionbody><div class=paragraph><p>In the past couple of weeks, I have come across a couple of fun puzzles with Cypher dates that I’d like to share with you. I will include answers, but I’ll post those at the bottom, so that those who want to challenge themself without peeking first can solve the puzzles.</p></div><div class=sect2><h3 id=_postgres_sql_ranges>Postgres SQL ranges</h3><div class=paragraph><p>The first challenge is a calendar appointment query. Postgres received an update, which improves queries in SQL for range data. This gives us a fun opportunity to see what Cypher’s version of this looks like. Let’s take a look at the question.</p></div><div class=ulist><ul><li><p>Available dates in the next month (<a href=https://twitter.com/craigkerstiens/status/1402688838124802054 class=bare>https://twitter.com/craigkerstiens/status/1402688838124802054</a>)</p></li></ul></div><div class=paragraph><p>Updated SQL solution:</p></div><div class=listingblock><div class=content><pre class=highlight><code>SELECT datemultirange(daterange(&#39;2021-06-01&#39;, &#39;2021-06-30&#39;, &#39;[]&#39;)) -
  range_agg(appointment_dates) AS availability
FROM appointments
WHERE appointment_dates &amp;&amp; daterange(&#39;2021-06-01&#39;, &#39;2021-06-30&#39;, &#39;[]&#39;);</code></pre></div></div><div class=paragraph><p>Solve away! Answer will be posted at the bottom of this post.</p></div></div><div class=sect2><h3 id=_weekly_progress_of_year>Weekly progress of year</h3><div class=paragraph><p>Our second challenge is to write a Cypher query that visualizes progress through the year on a weekly basis. We will stick to using regular characters to visualize the progress, so it won’t be anything fancy and no extra tools will be needed. Let’s see our task.</p></div><div class=ulist><ul><li><p>Create a progress bar for how many weeks of the year have passed (include percentage, too)</p></li></ul></div><div class=paragraph><p>Example characters for progress visualization:</p></div><div class=listingblock><div class=content><pre class=highlight><code>28*&#39;#&#39; + 22*&#39;-&#39;</code></pre></div></div><div class=paragraph><p>Have at it! Answer will be posted at the bottom of this post.</p></div></div><div class=sect2><h3 id=_kudos>Kudos</h3><div class=paragraph><p>Quick shout-out to my colleague <a href=https://twitter.com/mesirii target=_blank rel=noopener>Michael Hunger</a> who suggested both of these challenges and provided far cleaner and efficient solutions than those I was able to draft. 😁 Michael is widely revered as the founder of the <a href=https://neo4j.com/labs/apoc/ target=_blank rel=noopener>APOC library</a>, contributor of many other core aspects of Neo4j, and guru on Cypher. He may very well be the cornerstone of Neo4j developers and maintains an impressive presence on all content platforms, so if you have needed help on anything Neo4j-related over the years, there’s a high probability that you have run into him.</p></div></div><div class=sect2><h3 id=_solution_postgres_sql_ranges>Solution: Postgres SQL ranges</h3><div class=paragraph><p>There are several ways you can write this query, and even more when you start considering different data models. However, we will see two solutions that work, then I’ll include a brief explanation of the logic.</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH date(&#39;2021-06-01&#39;) as start, date(&#39;2021-06-30&#39;) as end
UNWIND [days IN range(0,duration.between(start,end).days) | start + duration({days:days})] as day
OPTIONAL MATCH (a:Appointment {date:day}) WITH * WHERE a IS NULL
RETURN day;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-4/sleuth_date_part4_7.png alt="sleuth date part4 7"></div></div><div class=listingblock><div class=content><pre class=highlight><code>WITH date(&#39;2021-06-01&#39;) as start, date(&#39;2021-06-30&#39;) as end
UNWIND [days IN range(0,duration.between(start,end).days) | start + duration({days:days})] as day
WITH * WHERE NOT EXISTS { (:Appointment {date:day}) }
RETURN day;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-4/sleuth_date_part4_8.png alt="sleuth date part4 8"></div></div><div class=paragraph><p>In both of our solutions, we are first setting a start and end date of the month (you could choose any, but we just picked last month) and unwinding the days between those two dates (from start to end of the duration between) as each day. Then, we take all those <code>days</code> and see if there is an appointment that already exists on any of them and return only the remaining days.</p></div></div><div class=sect2><h3 id=_solution_weekly_progress_of_year>Solution: Weekly progress of year</h3><div class=paragraph><p>Just as with the first challenge’s solution, there are some different ways to tackle this one. You could use a variety of characters and tools to create something intriguing, but we are keeping it simple, clean, and efficient.</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH datetime().week as week, 52 as weeks
RETURN reduce(r=&#39;&#39;,w in range(1,weeks) | r + CASE WHEN w &lt; week THEN &#39;#&#39; ELSE &#39;-&#39; END) + &#39; &#39; + (100*week/weeks) +&#39;%&#39; as progress;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-4/sleuth_date_part4_9.png alt="sleuth date part4 9"></div></div><div class=listingblock><div class=content><pre class=highlight><code>WITH datetime().week as week, 52 as weeks
RETURN reduce(r=&#39;&#39;,w in range(1,weeks) | r + CASE WHEN w &lt; week THEN &#39;&gt;&#39; WHEN w=week THEN &#39;8&#39; ELSE &#39;&lt;&#39; END) + &#39; &#39; + (100*week/weeks) +&#39;%&#39; as progress;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-4/sleuth_date_part4_10.png alt="sleuth date part4 10"></div></div><div class=paragraph><p>The solutions to this problem might appear a bit more complicated, but we can break them down into manageable pieces. First, we need to find out what week of the year is the current week and note the total weeks in the year as our starting and end points. The next line returns the calculation using a <a href=https://neo4j.com/docs/cypher-manual/current/functions/list/#functions-reduce target=_blank rel=noopener><code>reduce()</code> function</a>, which hops through a list of items and aggregates the current item to the current sum of all previous items. For example, if I had a list of <code>1,2,3</code>, then reduce would have final results of <code>6</code> (1+2+3).</p></div><div class=paragraph><p>Inside <code>reduce()</code>, we establish a result variable, and loop through each week in the number of weeks in the year (<code>range(1,weeks)</code>). On the right side of the pipe character, we then have our expression to aggregate our variable at each item in the list. We evaluate <code>r</code> - when the week number from our loop is less than the current week (in the past), we use one character; (solution 2) when the week is current week, we use another character; and when the week is greater than current week (yet-to-come), then we use a different character. Finally, we attach a percentage to the end of the output by calculating the current week number divided by total weeks (28/52) and multiplying the resulting fraction by 100 for the result.</p></div></div></div></div><div class=sect1><h2 id=_wrapping_up>Wrapping up!</h2><div class=sectionbody><div class=paragraph><p>In this post (Part 4!), we have seen how to combine duration functions and components in order to translate durations in one component category to another one. Then, we put our new skills to the test with a couple of Cypher date challenges, stating the problems to solve, and then walking through some solutions and their logic.</p></div><div class=paragraph><p>If you’d like to see some more Cypher sleuthing, I presented a session at <a href=https://neo4j.brand.live/c/2021nodes-homepage target=_blank rel=noopener>NODES</a> (Neo4j’s online developer conference) that covered a high-level overview of these date concepts and other gotchas. The recording is now <a href="https://www.youtube.com/watch?v=btTlBg45GDM&amp;list=PL9Hl4pk2FsvXfH-q5aghB2g7AlIztqoaf&amp;index=9" target=_blank rel=noopener>available on YouTube</a>, so feel free to check it out!</p></div><div class=paragraph><p>Next post, we will step through the date procedures/functions that the APOC library offers and discuss which ones are replaceable with built-in Cypher functionality or still required to accomplish specific tasks related to temporal data.</p></div><div class=paragraph><p>Until next time, happy coding!</p></div></div></div><div class=sect1><h2 id=_resources>Resources</h2><div class=sectionbody><div class=ulist><ul><li><p>Cypher Sleuthing: <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part1/ target=_blank rel=noopener>Part 1</a></p></li><li><p>Cypher Sleuthing: <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part2/ target=_blank rel=noopener>Part 2</a></p></li><li><p>Cypher Sleuthing: <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part3/ target=_blank rel=noopener>Part 3</a></p></li><li><p>Cypher Manual: <a href=https://neo4j.com/docs/cypher-manual/current/functions/temporal/duration/#functions-duration-computing target=_blank rel=noopener>Duration functions</a></p></li><li><p>Cypher Manual: <a href=https://neo4j.com/docs/cypher-manual/current/syntax/temporal/#cypher-temporal-accessing-components-durations target=_blank rel=noopener>Duration Components</a></p></li><li><p>Cypher Manual: <a href=https://neo4j.com/docs/cypher-manual/current/functions/list/#functions-reduce target=_blank rel=noopener>Reduce function</a></p></li><li><p>Cypher Manual: <a href=https://neo4j.com/docs/cypher-manual/current/functions/list/#functions-range target=_blank rel=noopener>Range function</a></p></li><li><p>NODES 2021: <a href="https://www.youtube.com/watch?v=btTlBg45GDM&amp;list=PL9Hl4pk2FsvXfH-q5aghB2g7AlIztqoaf&amp;index=9" target=_blank rel=noopener>Cypher Sleuthing presentation</a></p></li></ul></div></div></div><ul class=pa0><li class="list di"><a href=/tags/cypher/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">cypher</a></li><li class="list di"><a href=/tags/query-language/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">query language</a></li><li class="list di"><a href=/tags/dates/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">dates</a></li><li class="list di"><a href=/tags/temporal/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">temporal</a></li><li class="list di"><a href=/tags/programming/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">programming</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/blog/cypher-sleuthing-dates-part4/>Cypher Sleuthing: Dealing with Dates, Part 4</a></li><li class=mb2><a href=/blog/cypher-sleuthing-dates-part3/>Cypher Sleuthing: Dealing with Dates, Part 3</a></li><li class=mb2><a href=/blog/20210701-cypher-sleuthing-dates-part3/>Cypher Sleuthing: Dealing with Dates, Part 3</a></li><li class=mb2><a href=/blog/20210426-cypher-sleuthing-dates-part2/>Cypher Sleuthing: Dealing with Dates, Part 2</a></li><li class=mb2><a href=/blog/cypher-sleuthing-dates-part2/>Cypher Sleuthing: Dealing with Dates, Part 2</a></li><li class=mb2><a href=/blog/20210409-cypher-sleuthing-dates-part1/>Cypher Sleuthing: Dealing with Dates, Part 1</a></li><li class=mb2><a href=/blog/cypher-sleuthing-dates-part1/>Cypher Sleuthing: Dealing with Dates, Part 1</a></li><li class=mb2><a href=/blog/20190724-cypher-sleuthing-case-statement/>Cypher Sleuthing: the CASE statement</a></li><li class=mb2><a href=/blog/cypher-sleuthing-case-statement/>Cypher Sleuthing: the CASE statement</a></li><li class=mb2><a href=/blog/cypher-sleuthing-eager-operator/>Cypher Sleuthing: the EAGER operator</a></li><li class=mb2><a href=/blog/20190724-cypher-sleuthing-eager-operator/>Cypher Sleuthing: the EAGER operator</a></li><li class=mb2><a href=/blog/java-holds-its-own/>In the Language Wars, Java Holds Its Own</a></li></ul></div></aside></article></main><footer class="bg-dark-green bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://jmhreif.com/>&copy; Jennifer Reif 2024</a><div><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank rel=noopener class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank rel=noopener class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank rel=noopener class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank rel=noopener class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>