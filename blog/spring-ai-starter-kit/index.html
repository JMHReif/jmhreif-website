<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>GenAI Starter Kit: Everything You Need to Build an Application with Spring AI in Java | Jennifer Reif</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Photo credit There are so many options when it comes to languages, frameworks, and tools for building generative AI (GenAI) applications. When you are just getting started, these decisions and figuring out how to integrate everything can be overwhelming.
My team has been working on some pre-packaged solutions to make this process easier by providing starter kit projects with a few key technologies. One of those is the topic of today’s post - building a GenAI application with Spring AI in Java."><meta name=generator content="Hugo 0.119.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="GenAI Starter Kit: Everything You Need to Build an Application with Spring AI in Java"><meta property="og:description" content="Photo credit There are so many options when it comes to languages, frameworks, and tools for building generative AI (GenAI) applications. When you are just getting started, these decisions and figuring out how to integrate everything can be overwhelming.
My team has been working on some pre-packaged solutions to make this process easier by providing starter kit projects with a few key technologies. One of those is the topic of today’s post - building a GenAI application with Spring AI in Java."><meta property="og:type" content="article"><meta property="og:url" content="https://jmhreif.com/blog/spring-ai-starter-kit/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-05-23T09:00:00-06:00"><meta property="article:modified_time" content="2024-05-23T09:00:00-06:00"><meta itemprop=name content="GenAI Starter Kit: Everything You Need to Build an Application with Spring AI in Java"><meta itemprop=description content="Photo credit There are so many options when it comes to languages, frameworks, and tools for building generative AI (GenAI) applications. When you are just getting started, these decisions and figuring out how to integrate everything can be overwhelming.
My team has been working on some pre-packaged solutions to make this process easier by providing starter kit projects with a few key technologies. One of those is the topic of today’s post - building a GenAI application with Spring AI in Java."><meta itemprop=datePublished content="2024-05-23T09:00:00-06:00"><meta itemprop=dateModified content="2024-05-23T09:00:00-06:00"><meta itemprop=wordCount content="1616"><meta itemprop=keywords content="genai,rag,spring-ai,neo4j,vector,"><meta name=twitter:card content="summary"><meta name=twitter:title content="GenAI Starter Kit: Everything You Need to Build an Application with Spring AI in Java"><meta name=twitter:description content="Photo credit There are so many options when it comes to languages, frameworks, and tools for building generative AI (GenAI) applications. When you are just getting started, these decisions and figuring out how to integrate everything can be overwhelming.
My team has been working on some pre-packaged solutions to make this process easier by providing starter kit projects with a few key technologies. One of those is the topic of today’s post - building a GenAI application with Spring AI in Java."></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://jmhreif.com/img/unsplash-ai-brain.jpg)><div class="pb3-m pb6-l bg-black-60"><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Jennifer Reif</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/ title="Home page">Home</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blog/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/abstracts/ title="Abstracts page">Abstracts</a></li></ul><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">BLOG</aside><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/share?url=https://jmhreif.com/blog/spring-ai-starter-kit/&amp;text=GenAI%20Starter%20Kit:%20Everything%20You%20Need%20to%20Build%20an%20Application%20with%20Spring%20AI%20in%20Java" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://jmhreif.com/blog/spring-ai-starter-kit/&amp;title=GenAI%20Starter%20Kit:%20Everything%20You%20Need%20to%20Build%20an%20Application%20with%20Spring%20AI%20in%20Java" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div><h1 class="f1 athelas mt3 mb1">GenAI Starter Kit: Everything You Need to Build an Application with Spring AI in Java</h1><time class="f6 mv4 dib tracked" datetime=2024-05-23T09:00:00-06:00>May 23, 2024</time>
<span class="f6 mv4 dib tracked">- 8 minutes read</span>
<span class="f6 mv4 dib tracked">- 1616 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><div class=paragraph><small><i><a href="https://unsplash.com/photos/an-abstract-image-of-a-sphere-with-dots-and-lines-nGoCBxiaRO0?utm_content=creditShareLink&amp;utm_medium=referral&amp;utm_source=unsplash">Photo credit</a></i></small></div><div class=paragraph><p>There are so many options when it comes to languages, frameworks, and tools for building generative AI (GenAI) applications. When you are just getting started, these decisions and figuring out how to integrate everything can be overwhelming.</p></div><div class=paragraph><p>My team has been working on some pre-packaged solutions to make this process easier by providing starter kit projects with a few key technologies. One of those is the topic of today’s post - building a GenAI application with Spring AI in Java.</p></div><div class=paragraph><p>Let’s get started!</p></div><div class=sect1><h2 id=_what_is_spring_ai>What is Spring AI?</h2><div class=sectionbody><div class=paragraph><p>Spring AI is a framework for building generative AI applications. It provides a set of tools and utilities for working with generative AI models and architectures, such as large language models (LLMs) and retrieval augmented generation (RAG). There are also other options for GenAI in Java, but Spring AI is one of a handful of Neo4j’s initial integrations across various communities.</p></div></div></div><div class=sect1><h2 id=_whats_in_this_project>What’s in this project?</h2><div class=sectionbody><div class=paragraph><p>All of the code and background information is available in the <a href=https://github.com/neo4j-examples/spring-ai-starter-kit/tree/main/src/main/java/com/neo4j/springaistarterkit target=_blank rel=noopener><code>spring-ai-starter-kit</code> Github repository</a>. We will be walking through some of the code in this post, but you can always refer back to the repository.</p></div><div class=paragraph><p>We will use Neo4j to store structured data (such as entities and relationships), as well as the unstructured text data with the related vector embeddings. We can execute similarity searches on the vectors, then run retrieval queries to pull additional related entities. For today, we’ll pick the OpenAI model, but you can swap that out for any of the other <a href=https://docs.spring.io/spring-ai/reference/api/chatclient.html#_available_implementations target=_blank rel=noopener>Spring AI-supported LLMs</a>.</p></div><div class=paragraph><p>If you take a look at the project’s <code>pom.xml</code> file, you will see the four dependencies we have included for this project:</p></div><div class=ulist><ul><li><p>Spring Web (for creating a REST API)</p></li><li><p>OpenAI (or other LLM model, such as Mistral, Ollama, etc.)</p></li><li><p>Neo4j Vector Database (for storing and querying vectors)</p></li><li><p>Spring Data Neo4j (for working with Neo4j in Spring applications)</p></li></ul></div></div></div><div class=sect1><h2 id=_data_set>Data set</h2><div class=sectionbody><div class=paragraph><p>The data set we are using is the <a href=https://www.sec.gov/edgar/about target=_blank rel=noopener>SEC filings provided by EDGAR</a>. It contains a collection of documents for company and individual filings. The documents are in plain text and contain financial information about various companies. Our teams have curated this data into a knowledge graph with information on companies, financial forms, and managers. It includes the following forms:</p></div><div class="olist arabic"><ol class=arabic><li><p>Form 10-K: the annual report that publicly traded companies must file with the SEC. It provides a comprehensive summary of a company’s financial performance.</p></li><li><p>Form 13: filed by institutional managers who manage $100 million or more in assets.</p></li></ol></div><div class=paragraph><p>The starter kit application defaults to using a pre-loaded version of the data set in a public <a href=https://dev.neo4j.com/aura-java target=_blank rel=noopener>Neo4j Aura cloud database</a>. This removes the headaches of data import and formatting and such. As an alternative, you can load your own knowledge graph from scratch or find out more about the data set by looking at our <a href=https://github.com/neo4j-examples/sec-edgar-notebooks/blob/main/README.md target=_blank rel=noopener><code>sec-edgar-notebooks</code> repository</a>.</p></div><div class=paragraph><p>With all of the background information out of the way, let’s check out the code!</p></div></div></div><div class=sect1><h2 id=_project_setup>Project setup</h2><div class=sectionbody><div class=paragraph><p>Go ahead and clone the project repository, and then open it in your favorite IDE. Looking at the <code>pom.xml</code> file, you should see that the milestone repository is included, along with our four dependencies from earlier. Since Spring AI is not a general-availability release yet, the milestone repository is included.</p></div><div class=paragraph><p>To use OpenAI’s LLM, you will need to request an API key by signing up at <a href=https://platform.openai.com/signup target=_blank rel=noopener>OpenAI</a>. Once you have that (plus your database, if you created your own), you can set up the config in the <code>application.properties</code> file. Here’s an example of what that might look like:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-properties data-lang=properties>spring.ai.openai.api-key=&lt;YOUR API KEY HERE&gt;
spring.neo4j.uri=neo4j+s://9fcf58c6.databases.neo4j.io
spring.neo4j.authentication.username=public
spring.neo4j.authentication.password=read_only
spring.data.neo4j.database=neo4j</code></pre></div></div><div class=paragraph><p>The database credentials are for the default, pre-loaded instance. So, if you are using your own database, you will need to update the <code>.uri</code>, <code>.username</code>, and <code>.password</code> properties to match yours.</p></div><div class=paragraph><p>Next, let’s review the code for our application!</p></div></div></div><div class=sect1><h2 id=_embedding_and_vector_store_setup>Embedding and vector store setup</h2><div class=sectionbody><div class=paragraph><p>In the <code>SpringAiApplication</code> class, we’ll need to set up a couple of Spring Beans for the OpenAI client and the Neo4j vector store that will allow us to access necessary components wherever we need them in our application.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@Bean
public EmbeddingClient embeddingClient() {
	return new OpenAiEmbeddingClient(new OpenAiApi(System.getenv(&#34;SPRING_AI_OPENAI_API_KEY&#34;)));
}

@Bean
public Neo4jVectorStore vectorStore(Driver driver, EmbeddingClient embeddingClient) {
	return new Neo4jVectorStore(driver, embeddingClient,
		Neo4jVectorStore.Neo4jVectorStoreConfig.builder()
			.withIndexName(&#34;form_10k_chunks&#34;)
			.withLabel(&#34;Chunk&#34;)
			.withEmbeddingProperty(&#34;textEmbedding&#34;)
			.build());
}</code></pre></div></div><div class=paragraph><p>The <code>EmbeddingClient</code> bean creates a client for the OpenAI API and passes in our API key from the properties file. Then, the <code>Neo4jVectorStore</code> bean configures Neo4j as the store for embeddings (vectors). It pulls in the driver, which is autoconfigured from our database credentials, as well as the embedding client. The vector store configuration needs customized to specify our vector index name (the Spring AI default is <code>spring-ai-document-index</code>), the label for the nodes that will store the embeddings (default looks for <code>Document</code> entities), and the name of property containing the embedding (default is <code>embedding</code>).</p></div></div></div><div class=sect1><h2 id=_application_model>Application model</h2><div class=sectionbody><div class=paragraph><p>Next, we have some standard domain classes that map the application entities to our database model. There is a <code>Chunk</code> class that represents a document chunk node, and also classes for <code>Form</code>, <code>Company</code>, and <code>Manager</code> that represent the corresponding entities in the database. The <code>Chunk</code> entity has the embedding (vector) associated with it, which we’ll use for similarity searches.</p></div><div class=paragraph><p>These entities are standard Spring Data Neo4j code, so I won’t show the code here. However, full code for each class is available in the <a href=https://github.com/neo4j-examples/spring-ai-starter-kit/tree/main/src/main/java/com/neo4j/springaistarterkit target=_blank rel=noopener>project’s Github repository</a>.</p></div><div class=paragraph><p>The project’s <a href=https://github.com/neo4j-examples/spring-ai-starter-kit/blob/main/src/main/java/com/neo4j/springaistarterkit/ChunkRepository.java target=_blank rel=noopener>repository interface</a> allows the application to interact with the database. There is one defined query method that finds related entities (Form, Company, Manager) for the similar chunks.</p></div><div class=paragraph><p>Next, the controller class is where all the pieces come together to handle user requests and generate responses. This class will contain the logic for taking a question from the user and calling the <code>Neo4jVectorStore</code> to calculate and return the most similar documents. We can then pass those similar chunks into a Neo4j query to retrieve connected entities, providing additional context in the prompt for the LLM. It will use all the information provided to respond with a more detailed answer.</p></div></div></div><div class=sect1><h2 id=_controller>Controller</h2><div class=sectionbody><div class=paragraph><p>Our controller class needs to inject the <code>Neo4jVectorStore</code> bean, <code>OpenAiChatClient</code> bean, and <code>ChunkRepository</code> interface to run similarity search, call the LLM, and query the database, respectively.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@RestController
@RequestMapping(&#34;/api&#34;)
public class ChunkController {
    private final OpenAiChatClient client;
    private final Neo4jVectorStore vectorStore;
    private final ChunkRepository repo;

	@GetMapping(&#34;/chat&#34;)
    String getGeneratedResponse(@RequestParam String question) {
        List&lt;Document&gt; results = vectorStore.similaritySearch(SearchRequest.query(question));

        List&lt;Chunk&gt; docList = repo.getRelatedEntitiesForSimilarChunks(results.stream()
                .map(Document::getId)
                .collect(Collectors.toList()));

        var template = new PromptTemplate(&#34;&#34;&#34;
                You are a helpful question-answering agent. Your task is to analyze
                and synthesize information from the top result from a similarity search
                and relevant data from a graph database.
                Given the user&#39;s query: {question}, provide a meaningful and efficient answer based
                on the insights derived from the following data:

                {graph_result}
                &#34;&#34;&#34;,
                Map.of(&#34;question&#34;, question,
                        &#34;graph_result&#34;, docList.stream().map(chunk -&gt; chunk.toString()).collect(Collectors.joining(&#34;\n&#34;))));
        System.out.println(&#34;----- PROMPT -----&#34;);
        System.out.println(template.render());

        return client.call(template.create().getContents());
    }
}</code></pre></div></div><div class=paragraph><p>The last piece is to define a method that will be called when a user makes a GET request to the <code>/chat</code> endpoint. This method will take a question as a query parameter and pass that to the vector store’s <code>similaritySearch()</code> method to find similar document chunks.</p></div><div class=paragraph><p>Then, the similar <code>Chunk</code> nodes are mapped to <code>Document</code> entities because Spring AI expects a general document type. The <code>Neo4jVectorStore</code> class contains methods to convert <code>Document</code> to a custom record, as well as the reverse for record to <code>Document</code> conversion.</p></div><div class=paragraph><p>Back in our controller method, we now have similar document chunks, but chunks of text may not give enough detail for a helpful answer. So now we need to run the repository query in Neo4j to retrieve the related forms, companies, and managers for those chunks. This is the retrieval augmented generation (RAG) piece of the application.</p></div><div class=paragraph><p>After the similarity search returns similar document chunks, we call the <code>getRelatedEntitiesForSimilarChunks()</code> method in the repository (passing in the list of similar document ids) to find the related entities for those chunks.</p></div><div class=paragraph><p>The next block of code is the prompt template with the text to send to the LLM, along with the user’s question and graph results containing related entities. Finally, we call the template’s <code>create()</code> method to generate the response from the LLM and return the <code>contents</code> key for the response string.</p></div><div class=paragraph><p>Let’s test it out!</p></div></div></div><div class=sect1><h2 id=_running_the_application>Running the application</h2><div class=sectionbody><div class=paragraph><p>To run our starter kit application, you can use the <code>./mvnw spring-boot:run</code> command in the terminal. Once the application is running, you can make a GET request to the <code>/api/chat</code> endpoint with a question about the EDGAR data as a query parameter. A couple of examples are included next.</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>curl &#34;http://localhost:8080/api/chat?question=How%20many%20forms%20are%20there%3F&#34;
curl &#34;http://localhost:8080/api/chat?question=Which%20companies%20are%20in%20healthcare%3F&#34;
curl &#34;http://localhost:8080/api/chat?question=Which%20managers%20own%20stock%20in%20more%20than%20one%20company%3F&#34;</code></pre></div></div><div class=paragraph><p>Feel free to play around with some SEC-related questions or tweak the application or code to see how it responds. You can also check the console output to see the data being passed back and forth between the application and the LLM.</p></div></div></div><div class=sect1><h2 id=_wrapping_up>Wrapping Up!</h2><div class=sectionbody><div class=paragraph><p>In today’s post, we checked out the Spring AI Neo4j starter kit to help you get started building GenAI applications in Java. We used Spring AI to extend the richness of the well-established Spring ecosystem, giving us the ability to write a GenAI app in a JVM language (Java, for this post).</p></div><div class=paragraph><p>While Spring AI supports a variety of LLM models and vector stores, we chose the OpenAI model and Neo4j database. Neo4j provides the ability to store relationships and standard structured data alongside the unstructured text data and vector embeddings. We used the OpenAI model to generate responses to user questions based on the similarity search results and related entities from the database.</p></div><div class=paragraph><p>I hope this post helps to get you started with GenAI and beyond. Happy coding!</p></div></div></div><div class=sect1><h2 id=_resources>Resources</h2><div class=sectionbody><div class=ulist><ul><li><p>Code (Github repository): <a href=https://github.com/neo4j-examples/spring-ai-starter-kit target=_blank rel=noopener>Spring AI Starter Kit</a></p></li><li><p>Free online courses: <a href=https://graphacademy.neo4j.com/categories/llms/ target=_blank rel=noopener>Learn about Neo4j+LLMs with GraphAcademy</a></p></li><li><p>Documentation: <a href=https://docs.spring.io/spring-ai/reference/index.html target=_blank rel=noopener>Spring AI</a></p></li><li><p>Webpage: <a href=https://spring.io/projects/spring-ai target=_blank rel=noopener>Spring AI project</a></p></li><li><p>Documentation: <a href=https://docs.spring.io/spring-ai/reference/api/vectordbs/neo4j.html target=_blank rel=noopener>Spring AI Vector Databases - Neo4j</a></p></li></ul></div></div></div><ul class=pa0><li class="list di"><a href=/tags/genai class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">genai</a></li><li class="list di"><a href=/tags/rag class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">rag</a></li><li class="list di"><a href=/tags/spring-ai class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">spring-ai</a></li><li class="list di"><a href=/tags/neo4j class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">neo4j</a></li><li class="list di"><a href=/tags/vector class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">vector</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/blog/spring-ai-app/>Spring AI: How to Write GenAI Applications with Java</a></li><li class=mb2><a href=/blog/rag-demo-retrieval/>Implementing RAG: How to write a graph retrieval query in LangChain</a></li><li class=mb2><a href=/blog/cypher-property-data-types/>Cypher Sleuthing: How to Get Data Types of Properties in Neo4j</a></li><li class=mb2><a href=/blog/docker-container-upgrade/>Container Upgrade - Experiences Updating Three Databases</a></li><li class=mb2><a href=/blog/migrate-sdn-part3/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 3</a></li><li class=mb2><a href=/blog/java17-graph-explore/>Java 17: Explore the newly-released Java version in a graph database!</a></li><li class=mb2><a href=/blog/migrate-sdn-part2/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 2</a></li><li class=mb2><a href=/blog/migrate-sdn-part1/>Winter to Spring: Migrating from Spring Data Neo4j 5 to 6, Part 1</a></li><li class=mb2><a href=/blog/create-data-marvel-sdn/>Create a Data Marvel with Spring Data Neo4j</a></li></ul></div></aside></article></main><footer class="bg-dark-green bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://jmhreif.com/>&copy; Jennifer Reif 2024</a><div><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>