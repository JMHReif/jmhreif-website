<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Cypher Sleuthing: Dealing with Dates, Part 3 | Jennifer Reif</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="*Updated Dec 9, 2021
 My previous part 1 and part 2 posts on this topic introduced Cypher dates, translated formats to the Cypher-supported ISO 8601 format, calculated durations, and measured lengths of time. If you read those, then this post is the next step with Cypher dates on date components, component translations, and duration conversions. If you haven’t read parts 1 or 2, feel free to catch up - though this post doesn’t require the previous ones."><meta name=generator content="Hugo 0.85.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="Cypher Sleuthing: Dealing with Dates, Part 3"><meta property="og:description" content="*Updated Dec 9, 2021
 My previous part 1 and part 2 posts on this topic introduced Cypher dates, translated formats to the Cypher-supported ISO 8601 format, calculated durations, and measured lengths of time. If you read those, then this post is the next step with Cypher dates on date components, component translations, and duration conversions. If you haven’t read parts 1 or 2, feel free to catch up - though this post doesn’t require the previous ones."><meta property="og:type" content="article"><meta property="og:url" content="https://jmhreif.com/blog/cypher-sleuthing-dates-part3/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-07-01T12:00:00-06:00"><meta property="article:modified_time" content="2021-07-01T12:00:00-06:00"><meta itemprop=name content="Cypher Sleuthing: Dealing with Dates, Part 3"><meta itemprop=description content="*Updated Dec 9, 2021
 My previous part 1 and part 2 posts on this topic introduced Cypher dates, translated formats to the Cypher-supported ISO 8601 format, calculated durations, and measured lengths of time. If you read those, then this post is the next step with Cypher dates on date components, component translations, and duration conversions. If you haven’t read parts 1 or 2, feel free to catch up - though this post doesn’t require the previous ones."><meta itemprop=datePublished content="2021-07-01T12:00:00-06:00"><meta itemprop=dateModified content="2021-07-01T12:00:00-06:00"><meta itemprop=wordCount content="2149"><meta itemprop=keywords content="cypher,query language,dates,temporal,programming,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Cypher Sleuthing: Dealing with Dates, Part 3"><meta name=twitter:description content="*Updated Dec 9, 2021
 My previous part 1 and part 2 posts on this topic introduced Cypher dates, translated formats to the Cypher-supported ISO 8601 format, calculated durations, and measured lengths of time. If you read those, then this post is the next step with Cypher dates on date components, component translations, and duration conversions. If you haven’t read parts 1 or 2, feel free to catch up - though this post doesn’t require the previous ones."></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://jmhreif.com/img/date-part-3/investigating_spyglass.jpeg)><div class="pb3-m pb6-l bg-black-60"><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Jennifer Reif</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/ title="Home page">Home</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blog/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/abstracts/ title="Abstracts page">Abstracts</a></li></ul><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">BLOG</aside><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/share?url=https://jmhreif.com/blog/cypher-sleuthing-dates-part3/&text=Cypher%20Sleuthing:%20Dealing%20with%20Dates,%20Part%203" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://jmhreif.com/blog/cypher-sleuthing-dates-part3/&title=Cypher%20Sleuthing:%20Dealing%20with%20Dates,%20Part%203" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div><h1 class="f1 athelas mt3 mb1">Cypher Sleuthing: Dealing with Dates, Part 3</h1><time class="f6 mv4 dib tracked" datetime=2021-07-01T12:00:00-06:00>July 1, 2021</time>
<span class="f6 mv4 dib tracked">- 11 minutes read</span>
<span class="f6 mv4 dib tracked">- 2149 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><div class=paragraph><p><em>*Updated Dec 9, 2021</em></p></div><div class=paragraph><p>My previous <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part1/ target=_blank rel=noopener>part 1</a> and <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part2/ target=_blank rel=noopener>part 2</a> posts on this topic introduced Cypher dates, translated formats to the Cypher-supported ISO 8601 format, calculated durations, and measured lengths of time. If you read those, then this post is the next step with Cypher dates on date components, component translations, and duration conversions. If you haven’t read parts 1 or 2, feel free to catch up - though this post doesn’t require the previous ones. :)</p></div><div class=paragraph><p>We will take a brief detour back to components of temporal instants to see some additional use cases. Then, for the bulk of this post, we will cover translating duration values into specific measurements (converting months to weeks and more).</p></div><div class=sect1><h2 id=_accessing_date_and_time_components>Accessing Date and Time Components</h2><div class=sectionbody><div class=paragraph><p>We briefly mentioned temporal components in <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part1/ target=_blank rel=noopener>Part 1 of this series</a> (Examples 6, 7, and 8), but I wanted to come back and add a couple more use cases that came to mind.</p></div><div class=paragraph><p>In the Part 1 post examples, we used date components as a way to set a property to a specific piece of a date (year of current date stamp), do a general search (blog posts for month of March), and return a specific piece of a longer date (day of the week). Accessing parts of a full date or time could also be helpful for searches that aren’t a good fit for date ranges or extracting part of a value for UIs. We can see some examples below.</p></div><div class=paragraph><p>Dataset:</p></div><div class=listingblock><div class=content><pre class=highlight><code>MERGE (o:Order {orderId: 8272629462, orderDate: date(&#39;2020-05-27&#39;)})
MERGE (o2:Order {orderId: 8197274027, orderDate: date(&#39;2021-05-09&#39;)})
MERGE (o3:Order {orderId: 1749174018, orderDate: date(&#39;2020-06-01&#39;)})
MERGE (o4:Order {orderId: 6193472917, orderDate: date(&#39;2019-10-16&#39;)})
MERGE (o5:Order {orderId: 8174937104, orderDate: date(&#39;2019-05-27&#39;)})
MERGE (o6:Order {orderId: 3921746719, orderDate: date(&#39;2020-05-04&#39;)})
MERGE (o7:Order {orderId: 3918375629, orderDate: date(&#39;2021-05-27&#39;)})
MERGE (o8:Order {orderId: 2847209447, orderDate: date(&#39;2019-05-13&#39;)})
MERGE (o9:Order {orderId: 2846203472, orderDate: date(&#39;2020-05-01&#39;)})
MERGE (o10:Order {orderId: 6481749274, orderDate: date(&#39;2019-05-17&#39;)});</code></pre></div></div><div class=paragraph><p>Example 1: Find sales in a certain month</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (o:Order)
WHERE o.orderDate.month = 5
RETURN o.orderDate;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-3/sleuth_date_part3_1.png alt="sleuth date part3 1"></div></div><div class=paragraph><p><em>Note: I switched to the text view (tab on left of the result pane) so I could see all the values without scrolling. :)</em></p></div><div class=paragraph><p>The example above works well for finding dates in any year and on any day, but within a certain month. This type of search wouldn’t work so well if you were trying to use ranges. With date ranges, you would end up with a query something like this:</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (o:Order)
WHERE date(&#39;2019-05-01&#39;) &lt; o.orderDate &gt; date(&#39;2019-05-30&#39;)
OR date(&#39;2020-05-01&#39;) &lt; o.orderDate &gt; date(&#39;2020-05-30&#39;)
OR date(&#39;2021-05-01&#39;) &lt; o.orderDate &gt; date(&#39;2021-05-30&#39;)
RETURN o.orderDate;</code></pre></div></div><div class=paragraph><p>Now, there may be better ways to write the ugly query above, but a Cypher truncate wouldn’t work in this case, since it defaults only to smaller values where we couldn’t default the year without defaulting the month and day as well.</p></div><div class=paragraph><p>Let’s continue with our example above to see which purchases were made on a specific day of the month or day of the week.</p></div><div class=paragraph><p>Example 2: Orders for a particular day of the month</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (o:Order)
WHERE o.orderDate.day = 27
RETURN o.orderDate;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-3/sleuth_date_part3_2.png alt="sleuth date part3 2"></div></div><div class=paragraph><p>Example 3: Find most popular day of the week for orders</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (o:Order)
RETURN o.orderDate.dayOfWeek as dayOfWeek,
 count(o.orderDate) as orderCount,
 collect(o.orderDate) as dates
ORDER BY orderCount DESC;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-3/sleuth_date_part3_3.png alt="sleuth date part3 3"></div></div><div class=paragraph><p>According to our results above, the first day of the week is the most popular, which is Monday for the ISO8601 standard. This could help us determine when to run social campaign, publish content around products, or maybe when to run promotions or deals.</p></div><div class=paragraph><p>Now that we have seen some extra examples of how we could use component values of temporal instants, we can dig into converting durations from one measurement to another.</p></div></div></div><div class=sect1><h2 id=_translating_duration_values_to_different_precisions>Translating Duration Values to Different Precisions</h2><div class=sectionbody><div class=paragraph><p>In the <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part2/ target=_blank rel=noopener>previous blog post in this series</a>, we saw how to specify and calculate a variety of durations with Cypher. Many of the durations returned values in various time buckets (months, days, hours, etc), but we might want to convert those mixed values into a single unit (e.g. all in hours).</p></div><div class=paragraph><p>Before we jump into examples, however, there are a couple of steps we need to take in order to get there. First, we can calculate durations with the default process (largest unit and cascade remainders into smaller units), or we can specify a certain unit to convert the value. Here are the options we can have Cypher use:</p></div><div class=ulist><ul><li><p>inMonths(a, b)</p></li><li><p>inDays(a, b)</p></li><li><p>inSeconds(a, b)</p></li></ul></div><div class=paragraph><p>These units will calculate into whole values only, and remainders will be truncated. For instance, a duration calculation like below simply discards anything less than a whole month.</p></div><div class=paragraph><p>Example 4: Translate duration to months</p></div><div class=listingblock><div class=content><pre class=highlight><code>RETURN duration.between(date(&#39;2021-05-01&#39;),date(&#39;2021-06-08&#39;)) as preciseDuration,
 duration.inMonths(date(&#39;2021-05-01&#39;),date(&#39;2021-06-08&#39;)) as monthsDuration;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-3/sleuth_date_part3_4.png alt="sleuth date part3 4"></div></div><div class=paragraph><p>Note that our first calculation preserves the full value at <code>1 month, 7 days</code>, while the second calculation only shows <code>1 month</code> because it takes complete months and discards the remaining days.</p></div><div class=paragraph><p>With that, let’s dive into a couple of use case examples.</p></div><div class=paragraph><p>Example 5: Calculate the number of days a blog post has been published</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (b:BlogPost)
RETURN duration.between(b.publishedDatetime, datetime()) as publishedDuration,
 duration.inDays(b.publishedDatetime, datetime()) as publishedDays;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-3/sleuth_date_part3_5.png alt="sleuth date part3 5"></div></div><div class=paragraph><p>Above, we can determine how long a blog post has been live (published). On the left, we see the precise duration calculation (2 months, 15 days, plus thousands of seconds). On the right, we see that duration translated to days (260). With some other information, we could use the 260 days to tell us an average of how much traffic per day we have seen or compare against other posts to track trends over time.</p></div><div class=paragraph><p><em>Note: There is currently a bug in Browser that is rendering the <code>.inDays()</code> to months+days. This will hopefully be resolved soon, but running the same query via cypher-shell (shown in screenshot above) or a language driver should correctly display the 260 days.</em></p></div><div class=paragraph><p>Example 6: Translate time until vacation starts :)</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (v:Vacation)
SET v.startDate = date(&#39;2022-05-01&#39;)
RETURN duration.between(date(),v.startDate) as preciseDuration,
 duration.inMonths(date(),v.startDate) as months;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-3/sleuth_date_part3_6.png alt="sleuth date part3 6"></div></div><div class=paragraph><p>This could help us plan for when we should book reservations for lodging and activities or set a goal for content published or inches lost from the waistline by that point in time. :) We could also change the month calculation to <code>inDays</code> for a countdown.</p></div></div></div><div class=sect1><h2 id=_using_duration_components>Using Duration Components</h2><div class=sectionbody><div class=paragraph><p>Just like with temporal instant types, we can also access components (or parts) of the duration amount. There are a couple of rules I have discovered to help me avoid some pitfalls.</p></div><div class=paragraph><p>You can only convert among units in a component grouping, not across groups. (explanation coming)
Reminder: there must be whole values in order to convert to larger values. It will not retain partial or fractions of larger units (i.e. <code>12 hours</code> → <code>0.5 days</code>).</p></div><div class=paragraph><p>We have already discussed the second item above, but it’s one I have to constantly remember when writing queries. So, let’s dive into the first item above a bit more. I’ve discovered that if I have a duration that certain components don’t return and others do. It took me some time, but I have figured out that there are component groupings, and components don’t convert across them. Here are the component groups, as shown in the <a href=https://neo4j.com/docs/cypher-manual/current/syntax/temporal/#cypher-temporal-accessing-components-durations target=_blank rel=noopener>Cypher manual section</a>:</p></div><div class=imageblock><div class=content><img src=/img/date-part-3/cypher_component_groups.png alt="cypher component groups"></div></div><div class=paragraph><p>The column on the right is the key - values within one column can be converted to any other unit in that same cell, but not one in another cell. For instance, I can convert a duration in quarters to years and months, but not to weeks or hours. Also, I could convert a duration in days to weeks, but not to months or minutes. Notice, also, that these categories correspond to our duration functions of <code>inMonths()</code>, <code>inDays()</code>, and <code>inSeconds()</code>. That is for a specific purpose that we’ll cover in just a bit.</p></div><div class=paragraph><p>Example 7: Access components of multi-group duration</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (c:Conference)
RETURN c.length, c.length.minutes, c.length.hours, c.length.days;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-3/sleuth_date_part3_7.png alt="sleuth date part3 7"></div></div><div class=paragraph><p>In the example above, I have a duration of <code>1 day, 6 hours</code>, which spans multiple duration groups in our table (days and seconds). When I access the components, I can easily convert that duration to minutes and hours, but I cannot convert to days, even though <code>30 hours</code> is well above <code>1 day</code> (30 > 24 hours).</p></div><div class=paragraph><p><em>Note: I cannot go up to the <code>.weeks</code> component for 2 reasons - cannot go to the next category (<code>Days</code> row in the table), and I do not have a whole week in hours (168hrs = 1week). Even if you put in 168+ hours for the duration, we cannot convert to weeks because it’s in another conversion category.</em></p></div><div class=paragraph><p>Let’s look at another example.</p></div><div class=paragraph><p>Example 8: Access components of duration in days</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (v:Vacation)
RETURN v.length, v.length.weeks, v.length.days, v.length.hours;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-3/sleuth_date_part3_8.png alt="sleuth date part3 8"></div></div><div class=paragraph><p>Only one of my conversions worked here. Why is that? For both of our rules - 1) we do not have a whole week (only 5 days), 2) we cannot convert to values outside our category (hours).</p></div><div class=paragraph><p>That leaves us stuck with our lonely 5 days. So is it possible to convert to something in another category? YES! We can do this by combining our duration functions (<code>inMonths</code>, <code>inDays</code>, <code>inSeconds</code>), and then using components to get to the desired conversion. A couple more examples, and we will jump into that.</p></div><div class=paragraph><p>Remember our medicine dose example from Part 2 of this blog series? Let’s look at that conversion!</p></div><div class=paragraph><p>Example 9: Convert medicine dose seconds to hours</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (d:Dose)
RETURN d.frequency, d.frequency.hours;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-3/sleuth_date_part3_9.png alt="sleuth date part3 9"></div></div><div class=paragraph><p>Ok, here we have converted the whole duration format into a single value (<code>4 hours</code>). Now, what about getting individual components of our dose times? In our last post, we left them as durations (<code>09:30:00</code> as <code>PT9H30M</code> and <code>13:30:00</code> as <code>PT13H30M</code>), which are not very pretty to read or understand. While the simpler (and probably more logical) method would be to store the dose times as temporal instants and calculate the time by adding the temporal value with the frequency duration, I’ll show how we can take our existing durations and calculate them back into readable durations.</p></div><div class=paragraph><p>I mentioned above that the components would only convert to whole values, but there are a few components where you can display remainders in smaller units (i.e. <code>9 hours, 30 minutes</code>). I’ll show a screenshot of the <a href=https://neo4j.com/docs/cypher-manual/current/syntax/temporal/#cypher-temporal-accessing-components-durations target=_blank rel=noopener>section in the documentation</a> of those below.</p></div><div class=imageblock><div class=content><img src=/img/date-part-3/sleuth_date_part3_10.png alt="sleuth date part3 10"></div></div><div class=paragraph><p>Let’s use our dose time example to demonstrate this!</p></div><div class=paragraph><p>Example 10: Format dose time into hours/minutes components</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (d:Dose)
RETURN d.dose1Time, d.dose1Time.hours, d.dose1Time.minutesOfHour;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-3/sleuth_date_part3_11.png alt="sleuth date part3 11"></div></div><div class=paragraph><p>If we simply format the duration <code>PT9H30M</code> with the <code>.minutes</code> component, we get 570 minutes, which is the entire duration (9.5hrs) converted to minutes. However, if we use the <code>.minutesOfHour</code> component, it preserves the partial hour and displays the remainder after we remove whole hours (9) from the amount.</p></div><div class=paragraph><p>We could do the same with the <code>dose2Time</code>, but I’ll let you tackle that on your own. Next example!</p></div><div class=paragraph><p>Example 11: Conversions with values in multiple categories</p></div><div class=listingblock><div class=content><pre class=highlight><code>MATCH (:Employee)-[rel:ASSIGNED]-(p:Project)
WITH duration.between(rel.startDate, date()) as currentLength
RETURN currentLength, currentLength.quarters, currentLength.months,
 currentLength.weeks, currentLength.days, currentLength.hours;</code></pre></div></div><div class=imageblock><div class=content><img src=/img/date-part-3/sleuth_date_part3_12.png alt="sleuth date part3 12"></div></div><div class=paragraph><p>This query is a bit more complicated because we now have duration amounts in different categories we can convert, but it helps us understand our rules even better. Here, we have measured how long someone has been on a project by calculating the duration between the date an employee was assigned to the current date, which returns <code>P3M25DT0S</code>.</p></div><div class=paragraph><p>Our result means that the 3 months can be converted to years, months, and quarters, and the 25 days can be converted to weeks. Since we don’t have any amount in the time category, we cannot use any components for hours, seconds, etc. And this is what we see - 3 months converted to quarters (<code>1</code>), 25 days converted to weeks (<code>3</code>), and no hours.</p></div><div class=paragraph><p>If you’d like to try a couple more examples to help solidify this information, let me leave you with a couple more examples to play with on these duration components.</p></div><div class=paragraph><p>Example 12: Variety of durations to test with components</p></div><div class=listingblock><div class=content><pre class=highlight><code>WITH duration(&#39;P3D&#39;) as duration
RETURN duration.weeks, duration.days, duration.hours, duration.minutes, duration.seconds;

WITH duration(&#39;PT95M&#39;) as duration
RETURN duration.days, duration.hours, duration.minutes, duration.seconds;

WITH duration(&#39;PT95M&#39;) as duration
RETURN duration.hours, duration.minutesOfHour;

WITH duration(&#39;PT42H&#39;) as duration
RETURN duration.days, duration.hours, duration.minutes, duration.seconds;</code></pre></div></div></div></div><div class=sect1><h2 id=_wrapping_up>Wrapping up!</h2><div class=sectionbody><div class=paragraph><p>In this third post, we took a deep dive into durations with components and duration functions. We saw how to convert durations to different values by understanding the categories into which duration values are divided (months, days, seconds). With that understanding, we could then convert our durations into other temporal units within the same category or translate across categories and select desired units.</p></div><div class=paragraph><p>To wrap up our series on Cypher dates and times, we would be remiss not to mention APOC. Our next (and final) post in this series will take a brief look at some procedures and functions in the APOC library that might provide extra flexibility or that may be obsolete with the Cypher functionality. Tune in next time and happy coding!</p></div></div></div><div class=sect1><h2 id=_resources>Resources</h2><div class=sectionbody><div class=ulist><ul><li><p>Cypher manual: <a href=https://neo4j.com/docs/cypher-manual/current/syntax/temporal/#cypher-temporal-accessing-components-temporal-instants target=_blank rel=noopener>Components of Temporal Instants</a></p></li><li><p>Cypher manual: <a href=https://neo4j.com/docs/cypher-manual/current/functions/temporal/#functions-temporal-truncate-overview target=_blank rel=noopener>Truncating Temporal Values</a></p></li><li><p>Cypher manual: <a href=https://neo4j.com/docs/cypher-manual/current/functions/temporal/duration/#functions-duration-computing target=_blank rel=noopener>Duration Functions</a></p></li><li><p>Cypher manual: <a href=https://neo4j.com/docs/cypher-manual/current/syntax/temporal/#cypher-temporal-accessing-components-durations target=_blank rel=noopener>Duration Components</a></p></li><li><p>Blog post: <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part1 target=_blank rel=noopener>Part 1 of Cypher Sleuthing with Dates</a></p></li><li><p>Blog post: <a href=https://jmhreif.com/blog/cypher-sleuthing-dates-part2 target=_blank rel=noopener>Part 2 of Cypher Sleuthing with Dates</a></p></li></ul></div></div></div><ul class=pa0><li class="list di"><a href=/tags/cypher class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">cypher</a></li><li class="list di"><a href=/tags/query-language class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">query language</a></li><li class="list di"><a href=/tags/dates class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">dates</a></li><li class="list di"><a href=/tags/temporal class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">temporal</a></li><li class="list di"><a href=/tags/programming class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">programming</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/blog/cypher-sleuthing-dates-part2/>Cypher Sleuthing: Dealing with Dates, Part 2</a></li><li class=mb2><a href=/blog/cypher-sleuthing-dates-part1/>Cypher Sleuthing: Dealing with Dates, Part 1</a></li><li class=mb2><a href=/blog/cypher-sleuthing-case-statement/>Cypher Sleuthing: the CASE statement</a></li><li class=mb2><a href=/blog/cypher-sleuthing-eager-operator/>Cypher Sleuthing: the EAGER operator</a></li><li class=mb2><a href=/blog/java-holds-its-own/>In the Language Wars, Java Holds Its Own</a></li></ul></div></aside></article></main><footer class="bg-dark-green bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://jmhreif.com/>&copy; Jennifer Reif 2023</a><div><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>