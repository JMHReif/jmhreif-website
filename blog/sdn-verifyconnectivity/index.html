<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Verify Connectivity: How to Check the Neo4j Connection from a Spring Boot Application | Jennifer Reif</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Photo credit  I have recently been working on a self-paced learning course for Spring Data Neo4j and wanted users to be able to test the database connection. Typically, in a Spring Boot application with Spring Data, you set the database credentials as properties in the application.properties file. You can run the application with just these details, but it only fails when the database URI has improper syntax. The application does not actually test the connection to see if it is valid and successfully connects."><meta name=generator content="Hugo 0.85.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="Verify Connectivity: How to Check the Neo4j Connection from a Spring Boot Application"><meta property="og:description" content="Photo credit  I have recently been working on a self-paced learning course for Spring Data Neo4j and wanted users to be able to test the database connection. Typically, in a Spring Boot application with Spring Data, you set the database credentials as properties in the application.properties file. You can run the application with just these details, but it only fails when the database URI has improper syntax. The application does not actually test the connection to see if it is valid and successfully connects."><meta property="og:type" content="article"><meta property="og:url" content="https://jmhreif.com/blog/sdn-verifyconnectivity/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-09-08T09:00:00-06:00"><meta property="article:modified_time" content="2023-09-08T09:00:00-06:00"><meta itemprop=name content="Verify Connectivity: How to Check the Neo4j Connection from a Spring Boot Application"><meta itemprop=description content="Photo credit  I have recently been working on a self-paced learning course for Spring Data Neo4j and wanted users to be able to test the database connection. Typically, in a Spring Boot application with Spring Data, you set the database credentials as properties in the application.properties file. You can run the application with just these details, but it only fails when the database URI has improper syntax. The application does not actually test the connection to see if it is valid and successfully connects."><meta itemprop=datePublished content="2023-09-08T09:00:00-06:00"><meta itemprop=dateModified content="2023-09-08T09:00:00-06:00"><meta itemprop=wordCount content="1503"><meta itemprop=keywords content="java,spring-data-neo4j,database,spring-boot,database connection,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Verify Connectivity: How to Check the Neo4j Connection from a Spring Boot Application"><meta name=twitter:description content="Photo credit  I have recently been working on a self-paced learning course for Spring Data Neo4j and wanted users to be able to test the database connection. Typically, in a Spring Boot application with Spring Data, you set the database credentials as properties in the application.properties file. You can run the application with just these details, but it only fails when the database URI has improper syntax. The application does not actually test the connection to see if it is valid and successfully connects."></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://jmhreif.com/img/sdn-verifyConnectivity/unsplash-connection.jpg)><div class="pb3-m pb6-l bg-black-60"><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Jennifer Reif</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/ title="Home page">Home</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blog/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/abstracts/ title="Abstracts page">Abstracts</a></li></ul><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">BLOG</aside><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/share?url=https://jmhreif.com/blog/sdn-verifyconnectivity/&text=Verify%20Connectivity:%20How%20to%20Check%20the%20Neo4j%20Connection%20from%20a%20Spring%20Boot%20Application" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://jmhreif.com/blog/sdn-verifyconnectivity/&title=Verify%20Connectivity:%20How%20to%20Check%20the%20Neo4j%20Connection%20from%20a%20Spring%20Boot%20Application" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div><h1 class="f1 athelas mt3 mb1">Verify Connectivity: How to Check the Neo4j Connection from a Spring Boot Application</h1><time class="f6 mv4 dib tracked" datetime=2023-09-08T09:00:00-06:00>September 8, 2023</time>
<span class="f6 mv4 dib tracked">- 8 minutes read</span>
<span class="f6 mv4 dib tracked">- 1503 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><div class=paragraph><small><i><a href="https://unsplash.com/photos/f-gxmsZlj9c?utm_source=unsplash&utm_medium=referral&utm_content=creditShareLink">Photo credit</a></i></small></div><div class=paragraph><p>I have recently been working on a self-paced learning course for Spring Data Neo4j and wanted users to be able to test the database connection. Typically, in a Spring Boot application with Spring Data, you set the database credentials as properties in the <code>application.properties</code> file. You can run the application with just these details, but it only fails when the database URI has improper syntax. The application does not actually test the connection to see if it is valid and successfully connects.</p></div><div class=paragraph><p>In this blog post, I will show you how to test the connection to a Neo4j database from a Spring Boot application using the <code>verifyConnectivity()</code> method from the <code>Driver</code> class.</p></div><div class=sect1><h2 id=_ways_to_test_the_connection>Ways to Test the Connection</h2><div class=sectionbody><div class=paragraph><p>You might ask, "why doesn’t the application test the connection?" This is because it isn’t a config property, so we have to test it at runtime. There are a few different ways to go about this.</p></div><div class="olist arabic"><ol class=arabic><li><p>Use a CommandLineRunner with the driver and use the <code>verifyConnectivity()</code> method.</p></li><li><p>Move the CommandLineRunner to its own config class (cleaner).</p></li><li><p>Write a test for that uses the <code>verifyConnectivity()</code> method.</p></li><li><p>Write application functionality (domain, repository, controller classes) that utilize the connection.</p></li></ol></div><div class=paragraph><p>The last option has been what I have done in the past because I haven’t focused on only the connectivity step. However, it is not ideal for testing the connection because it requires you to write a lot of code that you don’t need. If the connection is wrong, then we have to troubleshoot a lot more code when something else might actually be causing the problem. We want to only deal with the database connection.</p></div><div class=paragraph><p>All three of the other options utilize the driver’s <code>verifyConnectivity()</code> method, but apply it in different places in the application. The first and second options were my next approach and are pretty good options, but require you to run the whole application. Once you have the test method, it either gets run along with the app every time, or you have to comment out/remove that piece of code.</p></div><div class=paragraph><p>The third option is the best because it is a test that you can run at any time. It doesn’t increase the overhead of the actual application, and you can run individual tests only when desired. This will be our goal, but I will show you how to write the first and second options, as well.</p></div></div></div><div class=sect1><h2 id=_the_verifyconnectivity_method>The <code>verifyConnectivity()</code> Method</h2><div class=sectionbody><div class=paragraph><p>First, let’s look at the <code>verifyConnectivity()</code> method. I didn’t realize this existed until now, so I had to do a bit of research. The info in the <a href=https://neo4j.com/docs/api/java-driver/current/org.neo4j.driver/org/neo4j/driver/Driver.html#verifyConnectivity() target=_blank rel=noopener>Java API docs</a> says that it verifies the driver can connect to the database and throws an exception if it fails to connect. This is exactly what we want!</p></div><div class=paragraph><p>The method is part of the <code>Driver</code> class, which is part of the Neo4j Java Driver. So, in order to execute the <code>verifyConnectivity()</code> method, we will need to create a driver object.</p></div></div></div><div class=sect1><h2 id=_setup_create_a_spring_boot_project>Setup: Create a Spring Boot Project</h2><div class=sectionbody><div class=paragraph><p>Let’s start by creating a Spring Boot project. I like to do this through the <a href=https://start.spring.io/ target=_blank rel=noopener>Spring Initializr</a> site. I will use the following settings:</p></div><div class=ulist><ul><li><p>Project: Maven Project</p></li><li><p>Language: Java</p></li><li><p>Spring Boot: Latest stable release (currently 3.1.3)</p></li><li><p>Project Metadata:</p><div class=ulist><ul><li><p>Group: com.jmhreif</p></li><li><p>Artifact: verify-connectivity</p></li></ul></div></li><li><p>Dependencies:</p><div class=ulist><ul><li><p>Spring Data Neo4j</p></li></ul></div></li></ul></div><div class=imageblock><div class=content><img src=/img/sdn-verifyConnectivity/initializr.png alt="Spring Initializr settings"></div></div><div class=paragraph><p>Once you have downloaded the project, open it in your preferred IDE. The first thing we will need to do is to set the database credentials in the <code>application.properties</code> file. This will give us something to test.</p></div><div class=paragraph><p>If you don’t already have an instance of Neo4j running, you can spin up a free cloud instance of Neo4j Aura in a few minutes. <a href=https://dev.neo4j.com/aura-java target=_blank rel=noopener>Neo4j Aura</a> is a fully managed cloud database service. Once you have an instance, you can get the connection URI from the <a href=https://dev.neo4j.com/aura-login target=_blank rel=noopener>Aura console</a>.</p></div><div class=paragraph><p>Next, open the <code>application.properties</code> file and add the following properties:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-properties data-lang=properties>spring.neo4j.uri=neo4j+s://dbhash.databases.neo4j.io
spring.neo4j.authentication.username=neo4j
spring.neo4j.authentication.password=test
spring.data.neo4j.database=neo4j</code></pre></div></div><div class=paragraph><p>Note that you will need to update at least the URI and password fields to match your instance (the username and database fields are defaulted unless you customize them later). Now, we can create a <code>CommandLineRunner</code> class to test the connection.</p></div><div class=paragraph><p>Each of the options we will cover in this post is in a separate branch in the accompanying <a href=https://github.com/JMHReif/verify-connectivity target=_blank rel=noopener>Github project</a>. You can follow along by checking out the branch for the option as we walk through each one. The <code>main</code> branch is the preferred solution using a test in the test class.</p></div><div class=ulist><ul><li><p><a href=https://github.com/JMHReif/verify-connectivity/tree/option1 target=_blank rel=noopener>Option 1</a>: Method in main application class</p></li><li><p><a href=https://github.com/JMHReif/verify-connectivity/tree/option2 target=_blank rel=noopener>Option 2</a>: Method in config class</p></li><li><p><a href=https://github.com/JMHReif/verify-connectivity target=_blank rel=noopener>Option 3 (main)</a>: Test in test class</p></li></ul></div></div></div><div class=sect1><h2 id=_option_1_use_commandlinerunner>Option 1: Use CommandLineRunner</h2><div class=sectionbody><div class=paragraph><p>With our project ready, we can start adding code to test the database connection. Open the main application class (<code>VerifyConnectivityApplication.java</code> here) and add code so it matches the class below:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@SpringBootApplication
public class VerifyConnectivityApplication implements CommandLineRunner {

	public static void main(String[] args) {
		SpringApplication.run(VerifyConnectivityApplication.class, args);
	}

	final Driver driver;

	public VerifyConnectivityApplication(@Autowired Driver driver) {
		this.driver = driver;
	}

	public final void run(String... args) {
		driver.verifyConnectivity();
	}
}</code></pre></div></div><div class=paragraph><p>We have our class implement the <a href=https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/CommandLineRunner.html target=_blank rel=noopener><code>CommandLineRunner</code> interface</a> so that the bean we create to test our connection is run on application startup. Next, we inject the driver on <a href=https://github.com/JMHReif/verify-connectivity/blob/option1/src/main/java/com/jmhreif/verifyconnectivity/VerifyConnectivityApplication.java#L17C22-L17C22 target=_blank rel=noopener>line 17</a> and create a constructor that uses the driver on <a href=https://github.com/JMHReif/verify-connectivity/blob/option1/src/main/java/com/jmhreif/verifyconnectivity/VerifyConnectivityApplication.java#L19 target=_blank rel=noopener>line 19</a>.</p></div><div class=paragraph><p><a href=https://github.com/JMHReif/verify-connectivity/blob/option1/src/main/java/com/jmhreif/verifyconnectivity/VerifyConnectivityApplication.java#L23 target=_blank rel=noopener>Line 23</a> is where we actually test the connection. We implement the <code>run()</code> method, which uses the <code>Driver</code> object to call its <code>verifyConnectivity()</code> method. If the connection is successful, then we get a <code>0</code> success status code. If the connection fails, then the method will throw an exception and the application will exit.</p></div><div class=paragraph><p>We can test this by running the application. If the output returns the <code>0</code> status code, then it works as it’s supposed to. You can also test to make sure it fails by putting some bad data into the database properties in the <code>application.properties</code> file and running the app again.</p></div><div class=paragraph><p>Testing the connection in the main application class isn’t the best solution because we have cluttered up our main class with the test code. We can make this a bit cleaner by moving this code to its own config class.</p></div></div></div><div class=sect1><h2 id=_option_2_set_up_a_config_class>Option 2: Set Up a Config Class</h2><div class=sectionbody><div class=paragraph><p>We are not really changing any functionality with this option, but are rather moving the configuration code to a separate class. This will allow us to keep our main application class focused on the application’s main functionality.</p></div><div class=paragraph><p>First, we need to create a new Java class. You can name it anything you like, but I called it <code>Config.java</code>. Open the class and copy/paste the code from the main application class so that your config class looks like the following:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@Configuration
public class Config implements CommandLineRunner {
    final Driver driver;

    public Config(@Autowired Driver driver) {
        this.driver = driver;
    }

    public final void run(String... args) {
        driver.verifyConnectivity();
    }
}</code></pre></div></div><div class=paragraph><p>Ensure you remove the copied code from the main class, and then test the application again. It should still work the same as before where a <code>0</code> status code means success, but now we have put the connection test code into a configuration part of the application.</p></div><div class=paragraph><p>This solution also isn’t ideal because we still have to run the whole application to test the connection. We can do better by writing a test in the test class so that it only runs when we need to check that piece.</p></div></div></div><div class=sect1><h2 id=_option_3_write_a_test>Option 3: Write a Test</h2><div class=sectionbody><div class=paragraph><p>The third option is the best one. It doesn’t increase the overhead of the application, and we can run an individual test as needed. To do this, we need to open the <code>VerifyConnectivityApplicationTests.java</code> file and match following code:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@SpringBootTest
class VerifyConnectivityApplicationTests {
    final Driver driver;
	public VerifyConnectivityApplicationTests(@Autowired Driver driver) {
		this.driver = driver;
	}

	@Test
	final void testConnection() {
		driver.verifyConnectivity();
	}
}</code></pre></div></div><div class=paragraph><p>You will also need to remove the <code>Config.java</code> class, as we don’t need it anymore. Now, we can run the test, and it will verify the connection. If the connection is successful, then the test will pass. If the connection fails, then the test will fail. You can alter the values in the <code>application.properties</code> to verify results for both success and failure.</p></div><div class=paragraph><p>This version of the code is much cleaner, and since we want to <strong>test</strong> a connection, it makes sense to use the test class. For more comprehensive application testing, we could use a test suite such as Neo4j harness or Testcontainers, but that is out of scope for this post. In this case, it is sufficient to create a plain test that verifies our application can connect to the database.</p></div></div></div><div class=sect1><h2 id=_wrap_up>Wrap Up!</h2><div class=sectionbody><div class=paragraph><p>In today’s post, we saw how to use the <code>verifyConnectivity()</code> method to test the connection to a Neo4j database from a Spring Boot application. We saw three different ways to do this, and the pros and cons of each. We also discussed why the best option is to utilize the test class and write a test. If the connection succeeds, the test passes. If the connection fails, the test fails, and we can troubleshoot connection details.</p></div><div class=paragraph><p>Happy debugging!</p></div></div></div><div class=sect1><h2 id=_resources>Resources</h2><div class=sectionbody><div class=ulist><ul><li><p>Github repository: <a href=https://github.com/JMHReif/verify-connectivity target=_blank rel=noopener>Accompanying code for this blog post</a></p></li><li><p>Documentation: <a href=https://neo4j.com/docs/api/java-driver/current/org.neo4j.driver/org/neo4j/driver/Driver.html#verifyConnectivity() target=_blank rel=noopener>Java API <code>verifyConnectivity()</code> method</a></p></li></ul></div></div></div><ul class=pa0><li class="list di"><a href=/tags/java class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">java</a></li><li class="list di"><a href=/tags/spring-data-neo4j class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">spring-data-neo4j</a></li><li class="list di"><a href=/tags/database class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">database</a></li><li class="list di"><a href=/tags/spring-boot class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">spring-boot</a></li><li class="list di"><a href=/tags/database-connection class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">database connection</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/blog/sdn-service-unavailable-exception/>ServiceUnavailableException: Connection to the database terminated.</a></li><li class=mb2><a href=/blog/evernote-api-app/>How to Create a Spring Boot Application to Retrieve Data from Evernote</a></li><li class=mb2><a href=/blog/sdn-cypher-update-entity/>Spring Data Neo4j: How to update an entity</a></li><li class=mb2><a href=/blog/no-such-bean-definition-exception/>NoSuchBeanDefinitionException: No matching TransactionManager bean found for qualifier 'reactiveTransactionManager'</a></li><li class=mb2><a href=/blog/microservices-level10/>Journeys in Java, Level 10: Service Discovery with Eureka</a></li><li class=mb2><a href=/blog/microservices-level9/>Journeys in Java, Level 9: Docker compose all the things</a></li><li class=mb2><a href=/blog/microservices-level8/>Journeys in Java, Level 8: Add MongoDB to Spring Cloud Config</a></li><li class=mb2><a href=/blog/microservices-level7/>Journeys in Java, Level 7: Externalize Microservice Configuration</a></li><li class=mb2><a href=/blog/microservices-level6/>Journeys in Java, Level 6: Build a Microservice with Neo4j</a></li><li class=mb2><a href=/blog/microservices-level5/>Journeys in Java, Level 5: Manage Microservices with Docker Compose</a></li><li class=mb2><a href=/blog/microservices-level4/>Journeys in Java, Level 4: Building an Empire of Microservices</a></li><li class=mb2><a href=/blog/microservices-level3/>Journeys in Java, Level 3: Building an Empire of Microservices</a></li><li class=mb2><a href=/blog/microservices-level2/>Journeys in Java, Level 2: Building an Empire of Microservices</a></li><li class=mb2><a href=/blog/microservices-level1/>Journeys in Java, Level 1: Building an Empire of Microservices</a></li><li class=mb2><a href=/blog/java17-graph-explore/>Java 17: Explore the newly-released Java version in a graph database!</a></li></ul></div></aside></article></main><footer class="bg-dark-green bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://jmhreif.com/>&copy; Jennifer Reif 2023</a><div><div class=ananke-socials><a href=https://twitter.com/JMHReif target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/JMHReif target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jmhreif/ target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://jmhreif.com/index.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>